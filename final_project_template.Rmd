---
title: "BMIN503/EPID600 Final Project"
author: "Srinath Adusumalli"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  

```{r eval = FALSE}
library(icd)
library(magrittr)
library(dplyr)
library(lubridate)
library(stringr)
library(tidyverse)
library(ggplot2)
library(readr)
library(knitr)
library(MASS)
library(readr)
library(naniar)

n_distinct(consults_teams$Pat_Enc_CSN_ID)

```

***
### Overview
My project aims to examine patterns of consultation of the cardiovascular medicine consult service since the implementation of the PennChart EHR in March 2017.  The purpose of doing this is to inform staffing for this service, particularly with an advanced practice provider, going forward as we move into HUP East/New Patient Pavilion (new patient hospital).

The data being used to complete the project are exclusively extracted from the Penn Medicine Epic/PennChart Clarity enterprise data warehouse.  We queried a number of tables throughout Clarity including those holding information on patient demographics, hospitalizations, medical history, problem list, visit/encounter diagnoses, inpatient consultation/procedure orders, and primary/secondary teams following patients during thier hospitalization.  We have data on patients admitted to the Hospital of the University of Pennsylvania from March 4th, 2017 (date of inpatient go-live) through November 2019.  

Additionally, these data are supplemented by queries from the Epic/PennChart tool SlicerDicer which draws information from the Caboodle data warehouse.

I spoke to the following individuals about my project:
- Srinivas Denduluri, PhD (senior clinical informaticist from the Division of Cardiovascular Medicine): Working with him and the Penn Medicine Data Analytic Center (analyst there is Erik Hossein), we were able to determine the location of patient care team information within Clarity tables.  This is surprisingly hard to to find and took some work to identify the appropriate tables.  I worked with Dr. Denduluri to ultimately write SQL queries to extract relevant data from Clarity and Caboodle.

- Monika Sanghavi, MD (consultative cardiology attending from the Division of Cardiovascular Medicine): Dr. Sanghavi is the director of the inpatient cardiovascular medicine consult service at the Hospital of the University Pennsylvania and is the physician who initially requested data on cardiology consultation.  Speaking with her helped to inform the queries we were conducting and the information we were searching for.

- Frank Silvestry, MD/Daniel Kolansky, MD (echocardiography and interventional cardiology attendings from the Divsion of Cardiovascular Medicine):  Drs. Silvestry and Kolansky are the associate chiefs of the Division and are also stakeholders in the project we are conducting.  Dr. Silvestry is also the director of the Cardiovascular Disease fellowship training program which staffs the consult service with fellows.  From them, I have learned we are hiring an advanced practice provider to supplement the fellows on service, so data on consult service volume will be of use to help inform how we staff that additional provider.

Final GitHub repository: https://github.com/sri-adu/BMIN503_Final_Project

### Introduction 
Introduction:  Cardiovascular disease is the leading cause of mortality and morbidity in the United States and beyond.  As such, it is one of the most common presenting complaints at the Hospital of the University of Pennsylvania, a busy quarternary care academic medical center.  The cardiovascular medicine consult service is one of the most busy (if not the busiest) consult services in the hospital.  Despite this, we have little data on which to base the operations of our service.  This is critical both for current operational needs as well as the future as we think about how to staff the new HUP East/New Patient Pavilion.  My aim is to examine patterns of consultation of the cardiovascular disease consult service since the implementation of an inpatient EHR in March 2017.  As a clinical informatician, I helped to build the informatics infrastucture for using the EHR to answer these questions and now would like to use it 

The problem of how to staff the cardiovascular medicine consult service is multidisciplinary as our service interacts with all types of providers from all specialities (ranging from MDs, to RNs, to physical therapists, and beyond).  Additionally, I am working with our division senior clinical informatician (different discipline than my primary one) as well as a cardiovascular medicine colleague on this project.  In talking with my background sources, I have discovered data needed to address my question is stored in a complex format in PennChart and Clarity.  Even a seemingly simple task such as determining what sequence of teams cared for a particular patient is not so simple through PennChart.  Despite this, we have now developed a dataset of patients seen by the cardiovascular medicine service as well as their background characteristics and teams from which consults came from which we will use to answer my question.

### Methods
In the first paragraph, describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

The data set used to address the question above is from the Epic Clarity dataset.  Code to acquire the dataset from Clarity included.

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

There are 12,097 unique patients with cardiology consults.
