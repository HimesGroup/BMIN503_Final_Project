---
title: "BMIN503/EPID600 Project Template"
author: "Your Name"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

```{r eval = FALSE}
This is a template.
```

### Overview
The goal of this project is to use a randomized phase III trial study CALGB 50303 , "Rituximab and Combination Chemotherapy in Treating Patients With Diffuse Large B-Cell Non-Hodgkin's Lymphoma",  to compare the efficacy of rituximab when given together with the two conventional chemotherapy regimens in treating stage II to IV DLBCL patients. 

### Introduction 
Diffuse large B-cell lymphomas (DLBCLs), accounting for 30% to 40% of adult non-Hodgkin lymphomas (NHLs), are the most common histologic subtype of lymphoid neoplasms in the United States. Conventional chemotherapy regimens for DLBCL include CHOP (cyclophosphamide, doxorubicine, vincristine, prednisone) and EPOCH (etoposide, prednisone, vincristine, cyclophosphamide, doxorubicin), but the complete response rates are not satisfactory. To further improve the efficacy of these combination chemotherapies, rituximab has been introduced additionally in frontline therapies, since its monoclonal antibody properties allows it to prevent cancer cell proliferation in many different ways. The goal of this project is to compare the two modified treatments, EPOCH-R and R-CHOP, in terms of efficacy and toxicity. 

To address this problem, an interdisciplinary approach might be required. Understanding the actual pharmaceutical mechanism of rituximab, as well as the pathophysiology of DLBCL, will help to predict outcomes of these two chemotherapies, while having knowledge in demographics might allow delicate comparisons of the two treatments within certain patient subgroups. Statistics, in addition, will guide the entire analysis. 

### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

```{r, eval = TRUE}
NHL <- read_excel("ODR1819_101_Cancer_Registration_Epidemiology_of_Non_Hodgkin.xlsx", sheet = "Data Table") #import data
``` 

```{r, eval = TRUE}
NHL.clean <- NHL %>%
  rename(ID = PSEUDO_TUMOURID, age = AGE_3GROUPS, sex = SEX, ethnicity = ETHNICITY_GROUPED, year = DIAGYEAR_GROUPED, qunit = QUNIT_12_to_16 ) %>% #rename data
  dplyr::select(ID, age, sex, ethnicity, year, STAGE_BEST, GRADE) #select data to display
NHL.clean
```

```{r, eval = TRUE}
# summary of patient backgrounds
# compare the sex distribution for each age category
library(ggplot2)
# Proportions of each "sex" category within each age category:
ggplot(data = NHL.clean, aes(x = age, fill = sex)) +
    geom_bar(position = "fill")
```
```{r, eval = TRUE}
# filter data with desired STAGE_BEST
NHL.stage <- NHL.clean  %>%
  filter(STAGE_BEST %in% c(1,2,3,4,5,6)) %>%
  select(ID, year, STAGE_BEST)
NHL.stage

# unifying labels in GRADE
for (i in 1:nrow(NHL.clean))
  if (!is.na(NHL.clean[i,]$GRADE))
    if (NHL.clean[i,]$GRADE == "1"){
      NHL.clean[i,]$GRADE = "G1"
    }else if (NHL.clean[i,]$GRADE == "3"){
       NHL.clean[i,]$GRADE = "G3"
    }else if (NHL.clean[i,]$GRADE == "4"){
       NHL.clean[i,]$GRADE = "G4"
    }else next

# filter data with desired GRADE
NHL.grade <- NHL.clean  %>%
  filter(GRADE %in% c("G1","G2","G3","G4","G5", "G6","G7","GX")) %>%
  select(ID, GRADE)

# create a new dataframe containing STAGE_BEST and GRADE
NHL.join <- inner_join(NHL.stage, NHL.grade, by = "ID")
NHL.join
```

```{r, eval = TRUE}
# bar plot the relationship between STAGE_BEST and GRADE
ggplot(data = NHL.join, aes(x = factor(STAGE_BEST), fill = GRADE)) +
    geom_bar(position = "fill")
```

```{r, eval = TRUE}
# bar plot the relationship between STAGE_BEST and year
ggplot(data = NHL.join, aes(x = factor(year), fill = STAGE_BEST)) +
    geom_bar(position = "fill")
```
### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
