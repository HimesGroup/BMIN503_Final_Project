---
title: "Food Insecurity in the United States"
author: "Nawar Naseer"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***

### Overview
Food insecurity, or a "lack of consistent access to enough food for an active, healthy life", is a major public health issue in the United States, where approximately 11% of households experienced food insecurity in 2018 (1). The United States Department of Agriculture (USDA) publishes a Food Environment Atlas, which contains data on over 275 variables with respect to food insecurity, including access to food retail, use of government food assistance programs, health and socioeconomic indicators, etc. These data are collected from various sources, span several years and geographic levels, and have been made publicly available. The goal of this project is to assess how the food retail environment varies across time and space, and to test for associations between access to food and the development of adverse health outcomes. In addition, the effect of other variables such as socioeconomic indicators and the use of government assistance programs such as SNAP will be incorporated into the analyses. Geospatial differences will be analyzed, with a specific focus on Philadelphia in comparision to 1) other counties in Pennslyvania, and 2) other large cities in the United States. 

[Github Repository](https://github.com/naseernawar/BMIN503_Final_Project)

### Introduction
In the United States, approximately 11% of households were food insecure in 2018 (1). In Philadelphia, this rate is nearly double the national average at 18.3%, and more than one out of every five Philadelphian struggles with basic food access (2). Food insecurity contributes to the development of chronic diseases such as heart disease and diabetes, both of which are two of the United State’s top ten leading causes of death (3). Additionally, food insecurity affects children’s cognitive development, and their ability to excel in school (4). Thus, food insecurity has long-lasting impacts on the productivity of a population, and understanding the regional factors that contribute to food insecurity and adverse health outcomes is vital for creating effective local and national interventions. 

A food secure environment provides both physical and financial access to nutritious food. By analyzing the food retail environment in context of socioeconmic factors and government assistance programs, this project spans the disciplines of sociology, economics, geography, public policy, and public health. Based on consulting with Dr. Alyson Karpyn, an analysis on a vulnerable but previously under-researched population, senior citizens, has also been incorporated. Another consultant, Moriah Hall, suggested doing a comparison of Philadelphia, PA to Baltimore, MD, a peer urban county. This project thus aims to use a multidisciplinary approach to understanding factors influencing food insecurity, and in doing so, may provide critical insight on how to tackle food insecurity in the United States.

### Methods
In the first paragraph, describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

#### Downloading data and necessary packages
The main data set used for this project was obtained from the USDA's publicly available data on the [Food Environment Atlas](https://www.ers.usda.gov/data-products/food-environment-atlas/data-access-and-documentation-downloads/). The downloaded Excel file contained several sheets pertinent to this project and have been loaded into R as a list of dataframes called "mysheets". These dataframes contain county-specific information on access and proximity to food retail providers (grocery stores, convenience stores, farmers' markets, etc), food assistance usage, food insecurity rates, diabetes and obesity rates, and socioeconomic indicators including race, age, income, etc. 

To create maps, the counties polygon dataset from BMIN503 Assignment 5 has been downloaded and used.

All necessary packages will be installed and loaded first.
```{r, eval=FALSE}
#Installations
install.packages("readxl")
```

```{r, eval=FALSE}
#Load libraries
library(readxl)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(RColorBrewer)
library(leaflet)
```

The data downloaded has been saved into the working directory and is loaded into R. Note that names of some of the sheets were slightly modified in Excel to exclude spaces and make them R-compatible.
```{r, eval=FALSE}
#Load in data
#The following function allows one to read in multiple sheets from one Excel file into a list, with each sheet representing a separate dataframe within the list.
read_excel_allsheets <- function(filename, tibble = TRUE) {
    sheets <- readxl::excel_sheets(filename)
    x <- lapply(sheets, function(X) readxl::read_excel(filename, sheet = X))
    if(!tibble) x <- lapply(x, as.data.frame)
    names(x) <- sheets
    x
}
mysheets <- read_excel_allsheets("USDAFoodEnvironmentAtlasMarch2018.xls")
head(mysheets$ACCESS) #to check that data has been loaded properly
```

Load in the counties polygon dataset to use for creating maps.
```{r, eval=FALSE}
counties <- readRDS(gzcon(url("https://raw.githubusercontent.com/HimesGroup/BMIN503/master/DataFiles/uscounties_2010.rds")))
```

The following themes will be used throughout the report for generating maps. 
```{r, eval=FALSE}
#For static maps:
myPalette <- colorRampPalette(brewer.pal(9, "YlOrRd"))

my_theme <- function() {
  theme_minimal() +                                  
  theme(axis.line = element_blank(),                 
        axis.text = element_blank(),                 
        axis.title = element_blank(),
        panel.grid = element_line(color = "white"),  
        legend.key.size = unit(0.8, "cm"),          
        legend.text = element_text(size = 12),       
        legend.title = element_text(size = 12),
        plot.title = element_text(size = 12))      
}

#For interactive maps:
# Select a color palette with which to run the palette function
pal_fun2 <- colorNumeric("YlOrRd", NULL)    # Yellow-Orange-Red from RColorBrewer
```

#### Cleaning data

The next step is to clean the data using the dplyr and tidyverse packages. Each dataframe will be updated to only include variables that will be analyzed in this project. 
```{r, eval=TRUE}
Access <- mysheets$ACCESS %>%
  select("FIPS",	"State",	"County", "PCH_LACCESS_POP_10_15",
"PCT_LACCESS_POP10",
"PCT_LACCESS_POP15", "PCH_LACCESS_LOWI_10_15",
"PCT_LACCESS_LOWI10",
"PCT_LACCESS_LOWI15", "PCH_LACCESS_HHNV_10_15",
"PCT_LACCESS_HHNV10",
"PCT_LACCESS_HHNV15", "PCT_LACCESS_SNAP15",
"PCT_LACCESS_CHILD10",
"PCT_LACCESS_CHILD15", 
PCH_LACCESS_SENIORS_10_15,
PCT_LACCESS_SENIORS10,
PCT_LACCESS_SENIORS15,
"PCT_LACCESS_WHITE15",
"PCT_LACCESS_BLACK15",
"PCT_LACCESS_HISP15",
"PCT_LACCESS_NHASIAN15",
"PCT_LACCESS_NHNA15",
"PCT_LACCESS_NHPI15",
"PCT_LACCESS_MULTIR15")
  
Stores <- mysheets$STORES %>% #Turns out I don't need to add "" for the column names!
  select(FIPS,	State,	County, GROCPTH09,
GROCPTH14,
PCH_GROCPTH_09_14,
SUPERCPTH09,
SUPERCPTH14,
PCH_SUPERCPTH_09_14,
CONVSPTH09,
CONVSPTH14,
PCH_CONVSPTH_09_14,
SPECSPTH09,
SPECSPTH14,
PCH_SPECSPTH_09_14,
SNAPSPTH12,
SNAPSPTH16,
PCH_SNAPSPTH_12_16,
WICSPTH08,
WICSPTH12,
PCH_WICSPTH_08_12)

Restaurants <- mysheets$RESTAURANTS %>% 
  select(FIPS,	State,	County,
  FFRPTH09,
FFRPTH14,
PCH_FFRPTH_09_14,
FSRPTH09,
FSRPTH14,
PCH_FSRPTH_09_14)

Assistance <- mysheets$ASSISTANCE %>% 
  select(FIPS,	State,	County,
  REDEMP_SNAPS12,
REDEMP_SNAPS16,
PCH_REDEMP_SNAPS_12_16,
PCT_SNAP12,
PCT_SNAP16,
PCH_SNAP_12_16,
SNAP_PART_RATE08,
SNAP_PART_RATE13,
PCT_NSLP09,
PCT_NSLP15,
PCH_NSLP_09_15,
PCT_FREE_LUNCH09,
PCT_FREE_LUNCH14,
PCT_REDUCED_LUNCH09,
PCT_REDUCED_LUNCH14,
PCT_SBP09,
PCT_SBP15,
PCH_SBP_09_15,
PCT_SFSP09,
PCT_SFSP15,
PCH_SFSP_09_15,
REDEMP_WICS08,
REDEMP_WICS12,
PCH_REDEMP_WICS_08_12,
PCT_WIC09,
PCT_WIC15,
PCH_WIC_09_15,
PCT_CACFP09,
PCT_CACFP15,
PCH_CACFP_09_15)

Insecurity <- mysheets$INSECURITY

Local <- mysheets$LOCAL %>% 
  select(FIPS,	State,	County,
  FMRKTPTH09,
FMRKTPTH16,
PCH_FMRKTPTH_09_16,
PCT_FMRKT_SNAP16,
PCT_FMRKT_WIC16,
PCT_FMRKT_WICCASH16,
PCT_FMRKT_SFMNP16)

Health <- mysheets$HEALTH %>% 
  select(FIPS,	State,	County,
  PCT_DIABETES_ADULTS08,
PCT_DIABETES_ADULTS13,
PCT_OBESE_ADULTS08,
PCT_OBESE_ADULTS13)

SE <- mysheets$SOCIOECONOMIC %>% 
  select(FIPS,	State,	County,
  PCT_NHWHITE10,
PCT_NHBLACK10,
PCT_HISP10,
PCT_NHASIAN10,
PCT_NHNA10,
PCT_NHPI10,
PCT_65OLDER10,
PCT_18YOUNGER10,
MEDHHINC15,
POVRATE15,
PERPOV10,
CHILDPOVRATE15,
PERCHLDPOV10)
```

#### Access

##### Indicator: Low Access to Stores
Create a map of percent population with low access to stores in 2015. 
```{r, eval=TRUE}
#Create new dataframe with variables of interest
LA2015 <- Access %>%
  select(FIPS, PCT_LACCESS_POP15)
LA2015$GEO_ID <- paste0("0500000US", LA2015$FIPS)
LA2015map <- inner_join(counties, LA2015, by="GEO_ID")

ggplot() +
  geom_sf(data = LA2015map) + 
  geom_sf(data = LA2015map, aes(fill = PCT_LACCESS_POP15), lwd = 0) +
  my_theme() +
  ggtitle("County-Level Percent Population with Low Access to Stores in the US in 2015") +
  scale_fill_gradientn(name = "Percent Population", colours = myPalette(100), limit=range(0, 100))
```

Create a map of percent population with low access to stores that also had low income in 2015.
```{r, eval=TRUE}
#Create new dataframe with variables of interest
LAI2015 <- Access %>%
  select(FIPS, PCT_LACCESS_LOWI15)
LAI2015$GEO_ID <- paste0("0500000US", LAI2015$FIPS)
LAI2015map <- inner_join(counties, LAI2015, by="GEO_ID")

ggplot() +
  geom_sf(data = LAI2015map) + 
  geom_sf(data = LAI2015map, aes(fill = PCT_LACCESS_LOWI15), lwd = 0) +
  my_theme() +
  ggtitle("County-Level Percent Population with Low Income and Low Access to Stores in the US in 2015") +
  scale_fill_gradientn(name = "Percent Population", colours = myPalette(100), limit=range(0, 100))
```

##### Low Access and Age: Philadephia, PA versus Baltimore, MD
Is there an association between age and access to stores? Comparison between Philadelphia, PA and Baltimore, MD
```{r, eval=TRUE}
#Create dataframe of interested variables
Access_age_PHLBAL <- Access %>%
  select(FIPS, County, PCT_LACCESS_POP15,
PCT_LACCESS_CHILD15,
PCT_LACCESS_SENIORS15) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(Overall = PCT_LACCESS_POP15, Children = PCT_LACCESS_CHILD15, Seniors = PCT_LACCESS_SENIORS15) %>%
  select(-FIPS)

AAPB <- data.frame(county = rep(c("Baltimore", "Philadelphia"), each=3),
                   Age = rep(c("Overall", "Child", "Senior"), 2),
                   Percent = c(17.5, 3.98, 2.52, 1.21, 0.158, 0.221))

#Create a bar graph to visualize
ggplot(data = AAPB, aes(x=Age, y=Percent, fill = county)) + #Load data, specify variables
    geom_bar(stat="identity", position = "dodge") + #Add a visual layer that is a barplot
  scale_x_discrete(limits=c("Overall", "Child", "Senior")) + #To manually adjust the order of the bars on the graph
  labs(title="Relationship Between Age and Access to Stores in Philadelphia and Baltimore 2015") + labs(x="Age Group", y="Percent (%) Population with Low Access to Stores")
```
To test association: chi-squared test?

##### Low Access: PA counties
Consider changing to interactive map
```{r, eval=TRUE}
#Create dataframe of interested variables
Access_PA2015 <- Access %>%
  select(FIPS, State, County, PCT_LACCESS_POP15) %>%
  filter(State=="PA")
Access_PA2015$GEO_ID <- paste0("0500000US", Access_PA2015$FIPS)
Access_PA2015map <- inner_join(counties, Access_PA2015, by="GEO_ID")

ggplot() +
  geom_sf(data = Access_PA2015map) + 
  geom_sf(data = Access_PA2015map, aes(fill = PCT_LACCESS_POP15), lwd = 0) +
  my_theme() +
  ggtitle("County-Level Percent Population with Low Access to Stores in Pennsylvania in 2015") +
  scale_fill_gradientn(name = "Percent Population", colours = myPalette(100), limit=range(0, 100))
```
I'm surpised to see that relative to other counties in PA, Philadelphia rate is pretty low. In fact the immediate counties surrounding Philly have higher rates.

##### Low Access and Race: Philadephia, PA versus Baltimore, MD
Is there an association between age and access to stores? Comparison between Philadelphia, PA and Baltimore, MD
```{r, eval=TRUE}
#Create dataframe of interested variables
Access_race_PHLBAL <- Access %>%
  select(FIPS, County, PCT_LACCESS_POP15, PCT_LACCESS_WHITE15,
PCT_LACCESS_BLACK15,
PCT_LACCESS_HISP15,
PCT_LACCESS_NHASIAN15,
PCT_LACCESS_NHNA15,
PCT_LACCESS_NHPI15,
PCT_LACCESS_MULTIR15) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(Overall = PCT_LACCESS_POP15, White = PCT_LACCESS_WHITE15, Black = PCT_LACCESS_BLACK15, Hispanic = PCT_LACCESS_HISP15,
Asian = PCT_LACCESS_NHASIAN15,
American_Indian_Alaskan = PCT_LACCESS_NHNA15,
Hawaiian_Pacific_Islander = PCT_LACCESS_NHPI15,
Multiracial = PCT_LACCESS_MULTIR15) %>%
  select(-FIPS)

ARPB <- data.frame(county = rep(c("Baltimore", "Philadelphia"), 8),
                   Race = rep(c("Overall", "White", "Black", "Hispanic", "Asian", "American_Indian_Alaskan", "Hawaiian_Pacific_Islander", "Multiracial"), each=2),
                   Percent = c(Access_race_PHLBAL$Overall, Access_race_PHLBAL$White, Access_race_PHLBAL$Black, Access_race_PHLBAL$Hispanic, Access_race_PHLBAL$Asian, Access_race_PHLBAL$American_Indian_Alaskan, Access_race_PHLBAL$Hawaiian_Pacific_Islander, Access_race_PHLBAL$Multiracial))

#Create a bar graph to visualize
ggplot(data = ARPB, aes(x=Race, y=Percent, fill = county)) + #Load data, specify variables
    geom_bar(stat="identity", position = "dodge") + #Add a visual layer that is a barplot
  scale_x_discrete(limits=c("Overall", "White", "Black", "Hispanic", "Asian", "American_Indian_Alaskan", "Hawaiian_Pacific_Islander", "Multiracial")) + #To manually adjust the order of the bars on the graph
  labs(title="Relationship Between Race and Access to Stores in Philadelphia and Baltimore 2015") + labs(x="Race", y="Percent (%) Population with Low Access to Stores")
```
Would've expeted the rate to be higher in minority populations like Blacks and Hispanics. Not white. 

##### Insecurity
Household insecurity 3 year avg 2013-2015
```{r, eval=TRUE}
#Create new dataframe with variables of interest
Insec1315 <- Insecurity %>%
  select(FIPS, State, County, FOODINSEC_13_15)
Insec1315$GEO_ID <- paste0("0500000US", Insec1315$FIPS)
Insec1315map <- inner_join(counties, Insec1315, by="GEO_ID")



# Pop-up message
pu_Insec1315 <- paste0(Insec1315map$State,  # paste0 to append tract name with other relevant text 
                     "<br>Food Insecurity, Three Year Average (2013 - 2015): ", round(Insec1315map$FOODINSEC_13_15, 1))

# Basic leaflet map
leaflet(Insec1315map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(FOODINSEC_13_15), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_Insec1315) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~FOODINSEC_13_15,                 # variable to be passed to palette function
            title = 'Food Insecurity, Three Year Average (2013 - 2015)',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Limitation: state level data

PA vs MD insecurity
```{r, eval=TRUE}
#Create dataframe of interested variables
Insec1315_PM <- Insec1315 %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(Insecurity = FOODINSEC_13_15) %>%
  select(-FIPS)

#Create a bar graph to visualize
ggplot(data = Insec1315_PM, aes(x=County, y=Insecurity)) + #Load data, specify variables
    geom_bar(stat="identity") + #Add a visual layer that is a barplot
  labs(title="Food Insecurity, Three Year Average (2013 - 2015)") + labs(x="County", y="Household food insecurity (%) 3 year average (2013 - 2015)")
```
(Not actually county level data - actually state level so should be PA versus MD)

#### Food Retail Environment

##### SNAP and WIC authorized stores
Nation-wide
```{r, eval=TRUE}
#Create new dataframe with variables of interest
SNAP2016 <- Stores %>%
  select(FIPS, State, County, SNAPSPTH16)
SNAP2016$GEO_ID <- paste0("0500000US", SNAP2016$FIPS)
SNAP2016map <- inner_join(counties, SNAP2016, by="GEO_ID")

# Pop-up message
pu_SNAP2016 <- paste0(SNAP2016map$County, ",", " ", SNAP2016map$State,  # paste0 to append tract name with other relevant text 
                     "<br>SNAP-authorized stores/1,000 population, 2016: ", round(SNAP2016map$SNAPSPTH16, 1))

# Basic leaflet map
leaflet(SNAP2016map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(SNAPSPTH16), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_SNAP2016) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~SNAPSPTH16,                 # variable to be passed to palette function
            title = 'SNAP-authorized stores/1,000 population, 2016',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```

Highest density of stores in Philadelphia!

Nation-wide
```{r, eval=TRUE}
#Create new dataframe with variables of interest
WIC2012 <- Stores %>%
  select(FIPS, State, County, WICSPTH12)
WIC2012$GEO_ID <- paste0("0500000US", WIC2012$FIPS)
WIC2012map <- inner_join(counties, WIC2012, by="GEO_ID")

# Pop-up message
pu_WIC2012 <- paste0(WIC2012map$County, ",", " ", WIC2012map$State,  # paste0 to append tract name with other relevant text 
                     "<br>WIC-authorized stores/1,000 population, 2012: ", round(WIC2012map$WICSPTH12, 1))

# Basic leaflet map
leaflet(WIC2012map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(WICSPTH12), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_WIC2012) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~WICSPTH12,                 # variable to be passed to palette function
            title = 'WIC-authorized stores/1,000 population, 2012',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```

##### Grocery stores
Nationwide
```{r, eval=TRUE}
#Create new dataframe with variables of interest
Grocery2014 <- Stores %>%
  select(FIPS, State, County, GROCPTH14)
Grocery2014$GEO_ID <- paste0("0500000US", Grocery2014$FIPS)
Grocery2014map <- inner_join(counties, Grocery2014, by="GEO_ID")

# Pop-up message
pu_Grocery2014 <- paste0(Grocery2014map$County, ",", " ", Grocery2014map$State,  # paste0 to append tract name with other relevant text 
                     "<br>Grocery stores/1,000 population, 2014: ", round(Grocery2014map$GROCPTH14, 1))

# Basic leaflet map
leaflet(Grocery2014map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(GROCPTH14), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_Grocery2014) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~GROCPTH14,                 # variable to be passed to palette function
            title = 'Grocery stores/1,000 population, 2014',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```



Philadelphia versus Baltimore comparison of food retail environment
```{r, eval=TRUE}
#Create dataframe of interested variables
Retail_PHLBAL <- Stores %>%
  select(FIPS, County, GROCPTH14, SUPERCPTH14, CONVSPTH14, SPECSPTH14) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(Grocery = GROCPTH14, Supercenter = SUPERCPTH14, Convenience = CONVSPTH14, Specialized = SPECSPTH14) %>%
  select(-FIPS)

RPB <- data.frame(county = rep(c("Baltimore", "Philadelphia"), 2),
                   Type = rep(c("Grocery", "Supercenter", "Convenience", "Specialized"), each=2),
                   Number = c(Retail_PHLBAL$Grocery, Retail_PHLBAL$Supercenter, Retail_PHLBAL$Convenience, Retail_PHLBAL$Specialized))

#Create a bar graph to visualize
ggplot(data = RPB, aes(x=Type, y=Number, fill = county)) + #Load data, specify variables
    geom_bar(stat="identity", position = "dodge") + #Add a visual layer that is a barplot
  labs(title="Presence of Stores in Philadelphia and Baltimore 2014") + labs(x="Store Type", y="Number of stores per 1000 of population")
```
The fact that Philly has more grocery stores is in line with it having more access (or less low access).

```{r, eval=TRUE}
#Create dataframe of interested variables
SNAPWIC_PHLBAL <- Stores %>%
  select(FIPS, County, SNAPSPTH12, WICSPTH12) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(SNAP = SNAPSPTH12, WIC = WICSPTH12) %>%
  select(-FIPS)

SWPB <- data.frame(county = rep(c("Baltimore", "Philadelphia"), 2),
                   Type = rep(c("SNAP", "WIC"), each=2),
                   Number = c(SNAPWIC_PHLBAL$SNAP, SNAPWIC_PHLBAL$WIC))

#Create a bar graph to visualize
ggplot(data = SWPB, aes(x=Type, y=Number, fill = county)) + #Load data, specify variables
    geom_bar(stat="identity", position = "dodge") + #Add a visual layer that is a barplot
  labs(title="Presence of SNAP/WIC-authorized Stores in Philadelphia and Baltimore 2012") + labs(x="Type of Assistance", y="Number of authorized stores per 1000 of population")
```


#### Food Assistance

##### SNAP and WIC Redemption
Gives us a sense of use/utilization of SNAP and WIC.
Nation-wide - SNAP
```{r, eval=TRUE}
#Create new dataframe with variables of interest
SNAPRed2016 <- Assistance %>%
  select(FIPS, State, County, REDEMP_SNAPS16)
SNAPRed2016$GEO_ID <- paste0("0500000US", SNAPRed2016$FIPS)
SNAPRed2016map <- inner_join(counties, SNAPRed2016, by="GEO_ID")

# Pop-up message
pu_SNAPRed2016 <- paste0(SNAPRed2016$County, ",", " ", SNAPRed2016$State,  # paste0 to append tract name with other relevant text 
                     "<br>SNAP Redemption/SNAP-authorized stores, 2016: ", round(SNAPRed2016$REDEMP_SNAPS16, 1))

# Basic leaflet map
leaflet(SNAPRed2016map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(REDEMP_SNAPS16), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_SNAPRed2016) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~REDEMP_SNAPS16,                 # variable to be passed to palette function
            title = 'SNAP Redemption/SNAP-authorized stores, 2016',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Highest density of usage in Philadelphia!

Nation-wide WIC
```{r, eval=TRUE}
#Create new dataframe with variables of interest
WICRed2012 <- Assistance %>%
  select(FIPS, State, County, REDEMP_WICS12)
WICRed2012$GEO_ID <- paste0("0500000US", WICRed2012$FIPS)
WICRed2012map <- inner_join(counties, WICRed2012, by="GEO_ID")

# Pop-up message
pu_WICRed2012 <- paste0(WICRed2012map$County, ",", " ", WICRed2012map$State,  # paste0 to append tract name with other relevant text 
                     "<br>WIC Redemption/WIC-authorized stores, 2012: ", round(WICRed2012map$REDEMP_WICS12, 1))

# Basic leaflet map
leaflet(WICRed2012map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(REDEMP_WICS12), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_WICRed2012) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~REDEMP_WICS12,                 # variable to be passed to palette function
            title = 'WIC Redemption/WIC-authorized stores, 2012',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Highest density of stores in Philadelphia!

SNAP Participants
```{r, eval=TRUE}
#Create new dataframe with variables of interest
SNAPPar2016 <- Assistance %>%
  select(FIPS, State, County, PCT_SNAP16)
SNAPPar2016$GEO_ID <- paste0("0500000US", SNAPPar2016$FIPS)
SNAPPar2016map <- inner_join(counties, SNAPPar2016, by="GEO_ID")

# Pop-up message
pu_SNAPPar2016 <- paste0(SNAPPar2016map$County, ",", " ", SNAPPar2016map$State,  # paste0 to append tract name with other relevant text 
                     "<br>SNAP Participants (% of Population), 2016: ", round(SNAPPar2016map$PCT_SNAP16, 1))

# Basic leaflet map
leaflet(SNAPPar2016map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(PCT_SNAP16), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_SNAPPar2016) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~PCT_SNAP16,                 # variable to be passed to palette function
            title = 'SNAP Participants (% of Population), 2016',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Note that this is state level data. Interesting that NM stands out. Is there some policy that makes it so? How does this compare to insecurity levels and SNAP-authorized stores? Redemption?

WIC Participants
```{r, eval=TRUE}
#Create new dataframe with variables of interest
WICPar2015 <- Assistance %>%
  select(FIPS, State, County, PCT_WIC15)
WICPar2015$GEO_ID <- paste0("0500000US", WICPar2015$FIPS)
WICPar2015map <- inner_join(counties, WICPar2015, by="GEO_ID")

# Pop-up message
pu_WICPar2015 <- paste0(WICPar2015map$County, ",", " ", WICPar2015map$State,  # paste0 to append tract name with other relevant text 
                     "<br>WIC Participants (% of Population), 2015: ", round(WICPar2015map$PCT_WIC15, 1))

# Basic leaflet map
leaflet(WICPar2015map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(PCT_WIC15), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_WICPar2015) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~PCT_WIC15,                 # variable to be passed to palette function
            title = 'WIC Participants (% of Population), 2015',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```

Note that this is state level data. Interesting that NM stands out. Is there some policy that makes it so? How does this compare to insecurity levels and SNAP-authorized stores? Redemption?

PHL vs BALT SNAP Participants comparison
```{r, eval=TRUE}
#Create dataframe of interested variables
SNAPPar2016_PHLBAL <- Assistance %>%
  select(FIPS, County, PCT_SNAP16) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(SNAP = PCT_SNAP16) %>%
  select(-FIPS)

#Create a bar graph to visualize
ggplot(data = SNAPPar2016_PHLBAL, aes(x=County, y=SNAP)) + #Load data, specify variables
    geom_bar(stat="identity") + #Add a visual layer that is a barplot
  labs(title="SNAP Participants (% of Population) in Philadelphia and Baltimore 2016") + labs(x="County", y="SNAP Participants (% of Population)")
```

PHL vs BALT WIC Participants comparison
```{r, eval=TRUE}
#Create dataframe of interested variables
WICPar2015_PB <- WICPar2015 %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(WIC = PCT_WIC15) %>%
  select(-FIPS)

#Create a bar graph to visualize
ggplot(data = WICPar2015_PB, aes(x=County, y=WIC)) + #Load data, specify variables
    geom_bar(stat="identity") + #Add a visual layer that is a barplot
  labs(title="WIC Participants (% of Population) in Philadelphia and Baltimore 2016") + labs(x="County", y="WIC Participants (% of Population)")
```
Perhaps a table format would be more meaningful for SNAP and WIC particpants in each city.

SNAPRed2016
PHL vs BALT SNAP Redemption comparison
```{r, eval=TRUE}
#Create dataframe of interested variables
SNAPRed2016PB <- SNAPRed2016 %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(SNAP = REDEMP_SNAPS16) %>%
  select(-FIPS)

#Create a bar graph to visualize
ggplot(data = SNAPRed2016PB, aes(x=County, y=SNAP)) + #Load data, specify variables
    geom_bar(stat="identity") + #Add a visual layer that is a barplot
  labs(title="SNAP Redemption as Proportion of SNAP-authorized Stores in Philadelphia and Baltimore 2016") + labs(x="County", y="SNAP Redemption / SNAP-authorized Stores)")
```

WIC Red PHL BALT comparison
```{r, eval=TRUE}
#Create dataframe of interested variables
WICRed2012_PB <- WICRed2012 %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(WIC = REDEMP_WICS12) %>%
  select(-FIPS)

#Create a bar graph to visualize
ggplot(data = WICRed2012_PB, aes(x=County, y=WIC)) + #Load data, specify variables
    geom_bar(stat="identity") + #Add a visual layer that is a barplot
  labs(title="WIC Redemption as Proportion of WIC-authorized Stores in Philadelphia and Baltimore 2012") + labs(x="County", y="WIC Redemption / WIC-authorized Stores")
```

#### Health outcomes

#### Diabetes
```{r, eval=TRUE}
#Create new dataframe with variables of interest
Diabetes2013 <- Health %>%
  select(FIPS, State, County, PCT_DIABETES_ADULTS13)
Diabetes2013$GEO_ID <- paste0("0500000US", Diabetes2013$FIPS)
Diabetes2013map <- inner_join(counties, Diabetes2013, by="GEO_ID")

# Pop-up message
pu_Diabetes2013 <- paste0(Diabetes2013map$County, ",", " ", Diabetes2013map$State,  # paste0 to append tract name with other relevant text 
                     "<br>Adult Diabetes Rate, 2013: ", round(Diabetes2013map$PCT_DIABETES_ADULTS13, 1))

# Basic leaflet map
leaflet(Diabetes2013map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(PCT_DIABETES_ADULTS13), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_Diabetes2013) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~PCT_DIABETES_ADULTS13,                 # variable to be passed to palette function
            title = 'Adult Diabetes Rate, 2013',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Prevalence of diabetets higher in Philadelphia relative to surrounding counties.

#### Obesity
```{r, eval=TRUE}
#Create new dataframe with variables of interest
Obesity2013 <- Health %>%
  select(FIPS, State, County, PCT_OBESE_ADULTS13)
Obesity2013$GEO_ID <- paste0("0500000US", Obesity2013$FIPS)
Obesity2013map <- inner_join(counties, Obesity2013, by="GEO_ID")

# Pop-up message
pu_Obesity2013 <- paste0(Obesity2013map$County, ",", " ", Obesity2013map$State,  # paste0 to append tract name with other relevant text 
                     "<br>Adult Diabetes Rate, 2013: ", round(Obesity2013map$PCT_OBESE_ADULTS13, 1))

# Basic leaflet map
leaflet(Obesity2013map) %>%
  addPolygons(stroke = FALSE, # remove polygon borders
              fillColor = ~pal_fun2(PCT_OBESE_ADULTS13), # addPolygons requires variable and a pass to a palette function  
              fillOpacity = 0.5, smoothFactor = 0.5, # increase opacity and resolution
              popup = pu_Obesity2013) %>%                # add a popup message
  addTiles() %>%                                         # default basemap
  addLegend("bottomright",                           # location of legend
            pal=pal_fun2,                             # palette function
            values=~PCT_OBESE_ADULTS13,                 # variable to be passed to palette function
            title = 'Adult Obesity Rate, 2013',                  # legend title
            opacity = 1) %>%                         # legend opacity (1 = completely opaque)
  addScaleBar()
```
Prevalence of obesity higher in Philadelphia relative to surrounding counties.

#### Health outcomes PHL vs Baltimore
```{r, eval=TRUE}
#Create dataframe of interested variables
Health_PHLBAL <- Health %>%
  select(FIPS, County, PCT_DIABETES_ADULTS13, PCT_OBESE_ADULTS13) %>%
  filter(FIPS %in% c("42101", "24005")) %>%
  rename(Diabetes = PCT_DIABETES_ADULTS13, Obesity = PCT_OBESE_ADULTS13) %>%
  select(-FIPS)

HPB <- data.frame(county = rep(c("Baltimore", "Philadelphia"), 2),
                   Outcome = rep(c("Diabetes", "Obesity"), each=2),
                   Percent = c(Health_PHLBAL$Diabetes, Health_PHLBAL$Obesity))

#Create a bar graph to visualize
ggplot(data = HPB, aes(x=Outcome, y=Percent, fill = county)) + #Load data, specify variables
    geom_bar(stat="identity", position = "dodge") + #Add a visual layer that is a barplot
  labs(title="Health Outcomes 2013") + labs(x="Health Outcome", y="Percent Rate")
```
Philadelphia faring worse in health outcomes

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

Why is Baltimore faring worse than Philadelphia by most indicators? I.e. fewer stores, less access, less SNAP/WIC. Fewer resources? Fewer non-profits? Less advocacy work?

### References

1. Coleman-Jensen, A., Rabbitt, M. P., Gregory, C. A., & Singh, A. (2019, September). Household Food Security in the United States in 2018. Retrieved November 6, 2019, from https://www.ers.usda.gov/publications/pub-details/?pubid=94848.
2. Hunger Free America. Philadelphia Falling Behind in Freedom to Eat: Greater Philadelphia Hunger Report, 2018.
3. Centers for Disease Control and Prevention, Leading Causes of Death, <https://www.cdc.gov/nchs/fastats/leading-causes-of-death.htm>
4. Feeding America. Help Kids Facing Hunger This School Year, <https://www.feedingamerica.org/hunger-blog/help-kids-facing-hunger-this>
