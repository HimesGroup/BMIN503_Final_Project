---
title: "BMIN503/EPID600 Project Template"
author: "Sally Qian"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.


### Introduction 

Obesity is described as an adverse effect on human health caused by accumulated excess body fat. As one of the major health problems in US, obesity enhances the risk of various severe diseases such as coronary artery disease, high blood pressure, and type 2 diabetes. According to reported data from Centers for Disease Control and Prevention (CDC), the prevalence of obesity increased from 30.5% to 42.4% in the past two decades. Also, the huge medical cost made obesity become a more common and serious disease. Researchers and physicians are always looking for a more effective method to alleviate the problem of obesity. In addition, obesity affects some groups more than others and multiple factors including ethnicity, gender and economic status would have impact on individualsâ€™ vulnerability to obesity. Therefore, this study aims to explore how effective the moderate behavioral weight loss program (intervention group) in overweight and obese adults from the general population, compared with the low-intensity version of the program (control condition). Multiple variables, including clinical site, gender, ethnicity and so on, were recorded and statistically analyzed to determine their impacts on the effectiveness of the moderate behavioral weight loss program.

### Methods
Step 1. I am going to look up the census data to investigate the obesity rate national wide to show how severe the obesity affect people. (KEEP WORKING...)

Step 2. Determine the effectiveness of moderate and low intensity program on patients with obesity by applying multiple statistical analysis. 

```{r}
library(DescTools)
library(readxl)
library(MASS)
library(olsrr)

# Load data
WgtLoss_data <- read_excel("E:/Dropbox/School/Fall 2021/BMIN 503/Final Project/WeightLossData.xlsx")

# 2. Data Description---------------------------------------------
### Find how many data entry are complete (exclude rows with NA)
is_complete <- !is.na(WgtLoss_data$month) & !is.na(WgtLoss_data$wgt_final)
num_complete_data <- sum(is_complete)
print(sprintf("Number of complete data = %d", num_complete_data))
clean_WL_data <- WgtLoss_data[complete.cases(WgtLoss_data),]

# 2.1 Distribution of change in body weight 
### Control group 
ctrl_WL_data <- clean_WL_data[(clean_WL_data$tx == 0),]
ctrl_wgt_loss <- (ctrl_WL_data$wgt_final - ctrl_WL_data$wgt_base)
hist(ctrl_wgt_loss, 
     main = "Distribution of change in body Weight (control)",
     xlab = "Change in body Weight (kg)",
     freq = FALSE,
     breaks = seq(-20, 20, 2))
lines(
  x = density(x = ctrl_wgt_loss),
  col = "red"
)

legend(
  "topleft",
  legend = c(paste("Mean =", round(mean(ctrl_wgt_loss), 2)),
             paste("Standard Deviation =", round(sd(ctrl_wgt_loss), 2))),
  cex = 1, bty = "n"
)


# Intervention group
int_WL_data <- clean_WL_data[(clean_WL_data$tx == 1), ]
int_wgt_loss <- (int_WL_data$wgt_final - int_WL_data$wgt_base)
hist(int_wgt_loss, 
     main = "Distribution of change in body Weight (intervention)",
     xlab = "Change in body Weight (kg)",
     freq = FALSE,
     breaks = seq(-25, 15, 2))
lines(
  x = density(x = int_wgt_loss),
  col = "red"
)
legend(
  "topleft",
  legend = c(paste("Mean =", round(mean(int_wgt_loss), 2)),
             paste("Standard Deviation =", round(sd(int_wgt_loss), 2))),
  cex = 1, bty = "n"
)

### Proportion of subject having reduced at least 5% body-weight after the program
# Percentage change in body weight
WL_percent <- (clean_WL_data$wgt_final - clean_WL_data$wgt_base) / (clean_WL_data$wgt_base)
# control group
p_ctrl <- (sum(WL_percent <= -0.05 & clean_WL_data$tx == 0))/ length(ctrl_wgt_loss)
print(sprintf("Proportion of subjects having reduced at least five-percent body-weight (control) = %f", p_ctrl))
# Intervention group
p_int <- (sum(WL_percent <= -0.05 & clean_WL_data$tx == 1))/ length(int_wgt_loss)
print(sprintf("Proportion of subjects having reduced at least five-percent body-weight (intervention) = %f", p_int))
```



```{r}
library(ggplot2)

### 2.2 Visualize the weight loss data by different covariate groups
## 2.2.1 Catagorical covariates

## Clinical site 
boxplot_ClinicSite <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(site), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Clinical site") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_ClinicSite)
num_s1 <- sum(clean_WL_data$site == 1)
num_s2 <- sum(clean_WL_data$site == 2)
num_s3 <- sum(clean_WL_data$site == 3)
num_s4 <- sum(clean_WL_data$site == 4)
num_s5 <- sum(clean_WL_data$site == 5)
print(sprintf("Number of subjects in clinical site 1 = %d, site 2 = %d, site 3 = %d, site 4 = %d, site 5 = %d", num_s1, num_s2, num_s3, num_s4, num_s5))

## Gender
boxplot_Gender <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(gender), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Gender") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Gender)

num_male <- sum(clean_WL_data$gender == 0)
num_female <- sum(clean_WL_data$gender == 1)
print(sprintf("Number of male subjects = %d, female subjects= %d", num_male, num_female))

## Race
boxplot_Race <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(race), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Race") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Race)

num_As <- sum(clean_WL_data$race == 1)
num_AA <- sum(clean_WL_data$race == 2)
num_HL <- sum(clean_WL_data$race == 3)
num_NHW <- sum(clean_WL_data$race == 4)
print(sprintf("Number of Asian subjects = %d, African American = %d, Hispanic/Latino = %d, Non-Hispanic white = %d", num_As, num_AA, num_HL, num_NHW))

## Education
boxplot_Education <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(education), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Education") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Education)

num_unedu <- sum(clean_WL_data$education == 0)
num_edu <- sum(clean_WL_data$education == 1)
print(sprintf("Number of subjects with education less than 12 yrs. = %d, more than 12 yrs. = %d", num_unedu, num_edu))

## Marital status
boxplot_Marital <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(married), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Marital status") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Marital)

num_unmar <- sum(clean_WL_data$married == 0)
num_mar <- sum(clean_WL_data$married == 1)
print(sprintf("Number of non-married subjects = %d, married subjects = %d", num_unmar, num_mar))

## Tobacco use
boxplot_Tabacco <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(smoker), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Tobacco use") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Tabacco)

num_nonsmo <- sum(clean_WL_data$smoker == 0)
num_smo <- sum(clean_WL_data$smoker == 1)
print(sprintf("Number of non-smoker = %d, smoker = %d", num_nonsmo, num_smo))

## Alcohol use
boxplot_Alcohol <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(drinker), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Alcohol use") +
  ylab("Change of body weight") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Alcohol)

num_nondrk <- sum(clean_WL_data$drinker == 0)
num_drk <- sum(clean_WL_data$drinker == 1)
print(sprintf("Number of non-drinker = %d, drinker = %d", num_nondrk, num_drk))


```

```{r}
## 2.2.2 Continuous Covariates

## Time since randomization to final weight
# Histogram
month <- (clean_WL_data$month)
hist(month, 
     main = "Distribution of treatment time",
     xlab = "Treatment time (months)",
     freq = FALSE,
     breaks = seq(8, 18, 1))
legend(
  "topright",
  legend = c(paste("Mean =", round(mean(month), 2)),
             paste("Standard Deviation =", round(sd(month), 2))),
  cex = 1, bty = "n"
)

# Boxplot
boxplot_Time <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(month), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Time since randomization to final weight (months)") +
  ylab("Change of body weight (kg)") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_Time)

## Height
# Histogram
hgt <- (clean_WL_data$height)
hist(hgt, 
     main = "Distribution of height",
     xlab = "Height (cm)",
     freq = FALSE,
     breaks = seq(145, 190, 3))

lines(
  x = density(x = hgt),
  col = "red"
)

legend(
  "topright",
  legend = c(paste("Mean =", round(mean(hgt), 2)),
             paste("Standard Deviation =", round(sd(hgt), 2))),
  cex = 1, bty = "n"
)

# scatter plot
plot(hgt, (clean_WL_data$wgt_final - clean_WL_data$wgt_base), 
     main = "Scatter plot of change in body weight vs. height",
     xlab = "Height (cm)",
     ylab = "Change in body weight (kg)")


## Age
# Histogram
age <- clean_WL_data$age
hist(age, 
     main = "Distribution of age",
     xlab = "Age (years)",
     freq = FALSE,
     breaks = seq(0, 100, 5))
lines(
  x = density(x = age),
  col = "red"
)

legend(
  "topright",
  legend = c(paste("Mean =", round(mean(age), 2)),
             paste("Standard Deviation =", round(sd(age), 2))),
  cex = 1, bty = "n"
)
# Scatter plot
plot(age, (clean_WL_data$wgt_final - clean_WL_data$wgt_base), 
     main = "Scatter plot of change in body weight vs. age",
     xlab = "Age (years)",
     ylab = "Change in body weight (kg)")

## Number of obesity-related comorbid conditions

# Histogram
cmb <- (clean_WL_data$comorbid)
hist(cmb, 
     main = "Distribution of number of obesity-related comorbid conditions",
     xlab = "Number of condition",
     freq = FALSE,
     breaks = seq(0, 5, 1))

legend(
  "topright",
  legend = c(paste("Mean =", round(mean(cmb), 2)),
             paste("Standard Deviation =", round(sd(cmb), 2))),
  cex = 1, bty = "n"
)

# Boxplot
boxplot_cmb <- ggplot(data = clean_WL_data,
                  mapping = aes (x = as.factor(comorbid), y = (wgt_final - wgt_base), fill = as.factor(tx)))+
  geom_boxplot() +
  xlab("Number of obesity-related comorbid conditions") +
  ylab("Change of body weight (kg)") +
  scale_fill_discrete("Intervention condition")
plot(boxplot_cmb)


```

```{r}
###### 3. Point estimates and confidence intervals------------------------------
#TO BE CONTINUED#
```

```


### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
