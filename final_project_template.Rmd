---
title: "BMIN503/EPID600 Project Template"
author: "Monique Arnold"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

#### Overview:  
The purpose of this project is to investigate the provision of timely and effective outpatient and emergency department care in Pennsylvania. Using CMS “Timely and Effective Care” dataset, the goals of the project are:
* To compare Pennsylvania to other states and national progress on emergency department access and care and display the results using interactive maps.
* To investigate if there are any relationships between demographic variables and TEC using multivariable regressions.
* To approximate service areas for major hospitals in Pennsylvania and determine if timely and effective care is available for for certain domains in emergency care, specifically: pediatrics, stroke, MI/valvular disorders, traumas. 


#### Introduction:  
According to the United Health Care Foundation’s report _America’s Health Rankings_ in 2015, Pennsylvania fell below national averages in rankings of state population health, ranking 29th among the 50 states. Furthermore, according to CDC data published in 2014, measures of health status in Pennsylvania vary by race/ethnicity, and patterns across these measures in Pennsylvania are similar to national data. Moreover, disparities in health and health access exist across the geographic regions of the state, with Pennsylvanians living in rural communities more likely to have unmet heath needs and have poor access to health care than those in urban communities. 

Access to health care means having "the timely use of personal health services to achieve the best health outcomes" (IOM, 1993). Timely and effective ambulatory care is an important cornerstone of healthcare access, and is essential for good patient outcomes and satisfaction. This is especially true in the US, where the cost of healthcare is high and ever increasing, but healthcare outcomes remain poor, especially for a developed nation. It is important that care not only be evidence-based and clinically indicated, but also timely and prompt, with delivery of the “right care at the right time.” 

Ambulatory care includes primary care, outpatient care and emergency room care. Ideally, patients are able to use primary care and outpatient for usual care, and only visit the ED for emergent conditions. Unfortunately, given the cost of healthcare and differential access to quality insurance, many patients use the ED as a ready alternative to their usual source of medical care. Many studies have examined the associations between perceived timely access barriers and reported use of the ED, which have shown that the benefits of usual medical care are often limited by barriers that limit effective and timely access to such care. Addressing these barriers first involves an identification of the ways in which timely and effective care is lacking.

This is an interdisciplinary issue, requiring the input of physicians, public health advocates, epidemiologists, economists, public service advocates, etc. As such, addressing the problem of timely access to care requires a multidisciplinary approach, and aim to employ one in this project to identify region-specific factors influencing access to care, or lack thereof. I thereby hope to provide critical insight into the state of healthcare in Pennsylvania.


#### Methods:
Using the Timely and Effective Care (TEC) data from CMS through 2020, I will compare Pennsylvania to other states and national progress on emergency department access and care. The TEC dataset includes data for measures of cataract surgery outcome, colonoscopy follow-up, heart attack care, emergency department care, preventive care, pregnancy and delivery care, and cancer care. I will focus on some of the most general issues in emergency care -- pediatrics, stroke, MI/valvular disorders, traumas.

First I will generate static/interactive graphs to show general trends of TEC in Pennsylvania to other states. Second, I will merge this data with demographic data available in the US census dataset, and, controlling for certain demographic characteristics, will run multivariable regressions to determine if there are any relationships that can be deduced from the dataset.

Lastly, I will attempt to look at more granular data for Pennsylvania and compare within the state. The TEC dataset contains hospital, state-level and national data but, unfortunately, does not contain county-level data. On the advice of advisors Dr. Gary Weissman, MD, MSHP (Assistant Professor of Medicine and Senior Fellow Leonard Davies Institute) and Dr. John Holmes PhD, FACE, FACMI (Professor of Medical Informatics in Epidemiology, Associate Director of the Institute for Biomedical Informatics), in lieu of county-level data, I will attempt to calculate more granular data using very specific metrics. I will attempt to calculate service areas of emergency departments using ~2 mile radius of the ED hospital data, building in assumptions to build critical diversions and other necessary information.


To create maps, the counties polygon dataset from BMIN503 Assignment 5 has been downloaded and used. I will use CMS data to corrobrate service areas for major hospitals.


Weissman:
- R packages for state map level
- pull demographics/aggregates around hospitals
- ED assumptions of 2 mile radius
- Assumptions to build in for diverting/critical divert
- Specialty care (pediatrics, stroke, MI/valvular disorders, trauma)

Holmes:

https://data.cms.gov/tools/mapping-medicare-disparities-by-hospital
Holmes:
https://data.cms.gov/tools/mapping-medicare-disparities-by-hospital
https://data.cms.gov/provider-summary-by-type-of-service/medicare-inpatient-hospitals/hospital-service-area
To create maps, the United States Census Bureau [TIGER/Line Shapefiles](https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.2020.html) county- and state- level datasets for 2020 were used. 

All necessary packages will be installed and loaded first.

```{r}
require(knitr)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
mydirectory<-"/Users/moniquearnold/Documents/PSOM/BMIN 503/Final Project/BMIN503_Final_Project"
knitr::opts_knit$set(root.dir = mydirectory)

# Clear existing data and graphics
rm(list = ls())
graphics.off()

# Load  library
pacman::p_load(devtools, rmarkdown, tidyverse, readxl, plyr, dplyr, knitr, tableone, data.table, reshape, kableExtra, broom, stringr, rgenoud, Hmisc, ggpubr, survey, lubridate, ggplot2, gridExtra, janitor, modelsummary, mapview, leaflet, ggsn, sf, sp, rgdal)
```

TEC data and county polygon data will be loaded.

```{r inputs, echo=FALSE}

#TEC data
tec_state <- read.csv(file = "/Users/moniquearnold/Documents/PSOM/BMIN 503/Final Project/BMIN503_Final_Project/Data/Timely_and_Effective_Care-State.csv")
#tec_hosp <- read.csv(file = "/Users/moniquearnold/Documents/PSOM/BMIN 503/Final Project/BMIN503_Final_Project/Data/Timely_and_Effective_Care-Hospital.csv")
tec_ntl <- read.csv(file = "/Users/moniquearnold/Documents/PSOM/BMIN 503/Final Project/BMIN503_Final_Project/Data/Timely_and_Effective_Care-National.csv")

#County Data
counties <- readRDS(gzcon(url("https://raw.githubusercontent.com/HimesGroup/BMIN503/master/DataFiles/uscounties_2010.rds"))) 


#Subset to PA
tec_state_pa <- tec_state %>% filter(State=="PA")
#tec_hosp_pa <- tec_hosp %>% filter(State=="PA")
#tec_hosp_pa_fac <- tec_hosp_pa %>% distinct(Facility.Name) %>% arrange(Facility.Name)
counties_pa <- counties %>% filter(STATE==42)

plot(st_geometry(counties_pa))
plot(st_geometry(counties))

```
