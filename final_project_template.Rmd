---
title: "Ultradistal Radius Bone Mineral Density in Children: Results from the Bone Mineral Density in Childhood Study"
author: "Joseph M. Kindler"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***

# 1. Overview

Dual energy X-ray absorptiometry (DXA) is a cornerstone of clinical bone health assessment. The preferred skeletal regions of interest for pediatric patients are the total body and lumbar spine. However, due to a variety of reasons, these two measurements are at times unattainable. Therefore, efforts have been made to develop valid and informative measures of bone density at alternative skeletal regions of interest. The ultradistal radius (i.e., the wrist) is one skeletal site with considerable potential, but this particular measure has yet to be thoroughly characterized in children with respect race and sex differences, changes during growth, tracking throughout childhood and adolescence, the confounding of stature, and it's ability to predict fracture. The goal of this project is to characterize ultradistal radius bone mineral density during childhood with respect to race, sex, age, stature, bone geometry, and fracture history. We will accomplish this study by performing a secondary analysis of the Bone Mineral Density in Childhood Study which includes >2,000 black and non-black males and females ages 5-19 at baseline with over 10,000 measurements collected over a six-year period. Dr. Zemel and Dr. Kalkwarf's background on childhood growth and Dr. McCormack's background in R programming were excellent sources of knowledge for the development of this project, which can be located at the following link: https://github.com/kindlerj/BMIN503_Final_Project. 

# 2. Introduction 

The Bone Mineral Density in Childhood Study (BMDCS) has been instrumental in characterizing bone growth during childhood and identifying the factors that contribute to these complex processes. Several traditional and non-traditional bone phenotypes have been explored using BMDCS data, with the exception of bone mineral density (BMD) at the ultradistal radius (i.e., the forearm). Understanding the factors associated with ultradistal radius BMD during childhood, such as age, sex, race, and bone geometry, will be criticial in developing this specific phenotype for clinical application, as well as understanding fracture etiology during growth since the forearm is the most common fracture site in youth.

Both modifiable and non-modifiable factors are involved in achieving optimal bone health during childhood. The attainment of "peak bone mass" during growth has significant ramifications on the risk for fracture and osteoporosis in adulthood. Bone-augmenting modifiable factors include physical activity, diet, and medications, while non-modifiable factors include genetics, population ancestry, sex, age, and sexual maturation. I am a nutritionist and bone biologist by training and my post-doc mentor, Dr. Babette Zemel, is a biological anthropologist with vast knowledge of human growth. Dr. Zemel was the principal investigator on the BMDCS, which was a prospective multi-site study of greater than 2,000 children funded by the NIH, and has identified maturational, dietary, and genetic determinants of bone health in this cohort. Dr. Kalkwarf is also a nutritionist and bone biologist, and has extensive expertise in childhood growth. Finally, Dr. McCormack is an endocrinologist and is an expert in childhood growth and R programming. Collectively, this collaborative team has aided in developing the study aims, conducting longitudinal statistical analyses in R, and developing a plan of action to further develop this new phenotype (i.e., ultradistal radius BMD) in future studies with respect to understanding the genetic and behavioral factors involved in forearm bone density accrual. Current pediatric recommendations for clincal bone health assessment suggest either the total body or lumbar spine as the two most appropriate skeletal regions for osteoporosis diagnosis. However, developing the ultradistal radius BMD phenotype  will help efforts toward establishing this outcome as an ancillary measure of bone health in instances that a total body or lumbar spine bone density scan is not feasible or appropriate at these skeletal regions of interest. 

# 3. Methods

We used data from the Bone Mineral Density in Childhood Study (BMDCS) to complete this study. The BMDCS was a large, multi-center, multi-ethnic study including 2014 healthy black and non-black children and adolescents that completed approximately 10,000 laboratory visits over a six year period. Areal bone mineral density (aBMD) was assessed at the ultradistal (UD) radius using dual-energy X-ray absorptiometry (DXA), fracture history was assessed via self-report, bone geometry was assessed at the distal radius using peripheral quantitative computed tomography (pQCT), and height was measured using a wall-mounted stadiometer. Sample DXA and pQCT images can be found at the following link: https://github.com/kindlerj/BMIN503_Final_Project/blob/master/Radius%20DXA%20and%20pQCT%20Scan.pdf. Longitudinal mixed regression was used to assess changes in UD radius aBMD during childhood, as well as sex- and race-related differences in these changes. Additionally, tracking of UD radius bone density, as well as relationships between UD radius aBMD and fracture history and bone geometry were assessed using longitudinal mixed regression.

## 3.1. R Code: 

### 3.1.1. Install packages needed for this study.
```{r eval=TRUE}

#install.packages("foreign")
#install.packages("haven")
#install.packages("gamlss")
#install.packages("xlsx")
#install.packages("tidyverse")
#install.packages("powerlmm")
#install.packages("nlme")
#install.packages("lme4")
#install.packages("lm.beta")
#install.packages("plotly")
#install.packages("mass")
#install.packages("ppcor")
#library(dplyr)
#library(ggplot2)
#library(gamlss)
#library(broom)
#library(lm.beta)
#library(reshape2)
#library(plyr)
#library(lme4)
#library(lmerTest)
#install.packages("bbmle")
#library(psych)
```

### 3.1.2. Import data
```{r eval=TRUE}
#Data set containing forearm cortical bone measurements
library(haven)
old_pqct.dta <- read_dta("~/Desktop/BMIN_503/Final_Project/BMDCS Data/old_pqct.dta")
pqct <- subset(old_pqct.dta, select = c(1:54))
head(pqct)

#Data set containing filter variable to exclude necessary measurements due to a variety of reasons (e.g., developed chronic condition, bedrest, unexplained weight loss/gain, initiation of exclusionary medication, etc.)
library(haven)
excl <- read_dta("~/Desktop/BMIN_503/Final_Project/BMDCS Data/old_excluded.dta")
head(excl)

#Data set containing pertinent deomgraphic, anthropometric, and forearm DXA data
library(haven)
old_ultradistal_radius_workfile_2018.09.10.dta <- read_dta("~/Desktop/BMIN_503/Final_Project/BMDCS Data/old_ultradistal_radius_workfile_2018.09.10.dta")
dxa <- subset(old_ultradistal_radius_workfile_2018.09.10.dta, select = c(randid, visit, sex, gender, height, weight, age, black, race, fore_r_ud_bmd_pc, fore_r_ud_bmc_pc, wb_tot_fat, wb_tot_lean, brknbone))
head(dxa)

#Data set containing UD BMD Z scores
ultra_distal_radius_bmd <- read_dta("~/Desktop/BMIN_503/Final_Project/BMDCS Data/ultra_distal_radius_bmd.dta")

#Removing duplicate variables from the Z score data set
ultra_distal_radius_bmd$bid <- NULL
ultra_distal_radius_bmd$age <- NULL
ultra_distal_radius_bmd$gender <- NULL
ultra_distal_radius_bmd$site <-NULL
ultra_distal_radius_bmd$visit_num <-NULL
ultra_distal_radius_bmd$black <-NULL
ultra_distal_radius_bmd$weight <- NULL
ultra_distal_radius_bmd$height <- NULL
#ultra_distal_radius_bmd$waz <- NULL
#ultra_distal_radius_bmd$bmiz <- NULL
#ultra_distal_radius_bmd$haz <- NULL
ultra_distal_radius_bmd$fore_r_ud_bmd_pc <- NULL
ultra_distal_radius_bmd$fore_r_ud_bmd_fulc <- NULL

```

### 3.1.3. Merge the data files (merge on 'randid' and 'visit')
```{r eval=TRUE}
fake <- dplyr::full_join(pqct, dxa, by = c("randid", "visit"))
bmdcs <- dplyr::full_join(fake, excl, by = c("randid", "visit"))
bmdcs <- dplyr::full_join(bmdcs, ultra_distal_radius_bmd, by = c("randid", "visit"))
```

### 3.1.4. Removing necessary measurements/subjects from the dataset
```{r eval=TRUE}
#Create a new variable for the participants that should be deleted. If a person has a number (1-7) (meaning, they need to be deleted), they'll receive a "FALSE", but if they have a "NA", then they'll receive a "TRUE".
bmdcs$exclude.filter <- as.factor(is.na(bmdcs$extype)) 
#Copy the 'extype' variable so it appears next to the newly generated variable from above... scroll through to confirm that this worked properly (all numbers (1 to 7) should have a corresponding "FALSE", and NA's should have a corresponding "TRUE").
bmdcs$dummy <- bmdcs$extype 
#This command uses the "exclude.filter" variable that we created in command 1 to get rid of the "FALSE" rows, thereby deleting the the necessary measures/subjects and retaining our final and valid measurements.
bmdcs <- bmdcs[bmdcs$exclude.filter==TRUE,] 
```

### 3.1.5. Creating new gender variable
```{r eval=TRUE}
bmdcs$gender.2 = as.factor(bmdcs$gender) #gender was numeric in 'bmdcs', so we need it to be a factor
```

### 3.1.6. Creating polynomial terms for age (for regression analyses)
```{r eval=TRUE}
bmdcs$age_squared <- bmdcs$age * bmdcs$age
bmdcs$age_cubed <- bmdcs$age * bmdcs$age * bmdcs$age
bmdcs$age_four <- bmdcs$age * bmdcs$age * bmdcs$age * bmdcs$age
```

### 3.1.7. Creating data frames for males and females, as well as for AA males, AA females, non-AA males, and non-AA females
```{r eval=TRUE}
#Males (includes both AA and non-AA)
bmdcs.male <- bmdcs[bmdcs$gender==1, ] 
#Females (includes both AA and non-AA)
bmdcs.female <- bmdcs[bmdcs$gender==2, ] 
#AA Male
bmdcs.AA.male <- bmdcs[bmdcs$gender==1 & bmdcs$black==1, ] 
#AA Female
bmdcs.AA.female <- bmdcs[bmdcs$gender==2 & bmdcs$black==1, ] 
#non-AA Male
bmdcs.nonAA.male <- bmdcs[bmdcs$gender==1 & bmdcs$black==0, ] 
#non-AA Female
bmdcs.nonAA.female <- bmdcs[bmdcs$gender==2 & bmdcs$black==1, ] 
```

### 3.1.8. Creating interaction terms for regression analyses
```{r eval=TRUE}
#Main BMDCS data set
#Age squared
bmdcs$age_squared_by_black <- bmdcs$age_squared * bmdcs$black
bmdcs$age_squared_by_gender <- bmdcs$age_squared * bmdcs$gender
bmdcs$age_squared_by_gender_by_black <- bmdcs$age_squared * bmdcs$gender * bmdcs$black

#Age cubed
bmdcs$age_cubed_by_black <- bmdcs$age_cubed * bmdcs$black
bmdcs$age_cubed_by_gender <- bmdcs$age_cubed * bmdcs$gender
bmdcs$age_cubed_by_gender_by_black <- bmdcs$age_cubed * bmdcs$gender * bmdcs$black

#Age fourth
bmdcs$age_four_by_black <- bmdcs$age_four * bmdcs$black
bmdcs$age_four_by_gender <- bmdcs$age_four * bmdcs$gender
bmdcs$age_four_by_gender_by_black <- bmdcs$age_four * bmdcs$gender * bmdcs$black

#BMDCS male and female data sets
#Age cubed
bmdcs.male$black_by_age_cubed <- bmdcs.male$age_cubed * bmdcs.male$black
bmdcs.female$black_by_age_cubed <- bmdcs.female$age_cubed * bmdcs.female$black

```

### 3.1.9. New data frames with labels for figures.
```{r eval=TRUE}
#BMDCS
bmdcs.figs <- mutate(bmdcs, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs <- mutate(bmdcs.figs, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

#Female
bmdcs.figs.female <- mutate(bmdcs.female, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.female <- mutate(bmdcs.figs.female, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

#Male
bmdcs.figs.male <- mutate(bmdcs.male, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.male <- mutate(bmdcs.figs.male, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

#AA Female
bmdcs.figs.aa.female <- mutate(bmdcs.AA.female, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.aa.female <- mutate(bmdcs.figs.aa.female, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

##AA Male
bmdcs.figs.aa.male <- mutate(bmdcs.AA.male, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.aa.male <- mutate(bmdcs.figs.aa.male, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

##non-AA Female
bmdcs.figs.non.aa.female <- mutate(bmdcs.nonAA.female, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.non.aa.female <- mutate(bmdcs.figs.non.aa.female, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))

#non-AA Male
bmdcs.figs.non.aa.male <- mutate(bmdcs.nonAA.male, black = factor(black, levels=c(0, 1), labels=c("non-African American", "African American")))
bmdcs.figs.non.aa.male <- mutate(bmdcs.figs.non.aa.male, gender.2 = factor(gender.2, levels=c(1, 2), labels=c("Male", "Female")))
```

### 3.1.10. Baseline data frame
```{r eval=TRUE}
#save a new df
baseline <- bmdcs[bmdcs$visit==0, ] 
```

### 3.1.11. Handling biologically implausible outliers in Tt.Ar
```{r eval=TRUE}
#There is an outlier in Tt.Ar that needs to be removed, so we're going to save new DFs for the Tt.Ar analyses to bypass this biologically implausable value 
new.ttar.df <- bmdcs.figs
new.ttar.df.males <- bmdcs.figs.male
new.ttar.df.females <- bmdcs.figs.female
new.ttar.df.nonAA.male <- bmdcs.figs.non.aa.male

#This df replaces the 'bmdcs' data set
new.ttar.df <- new.ttar.df[new.ttar.df$tot_a_r30>=10, ]

#This df replaces the 'bmdcs.males' data set
new.ttar.df.males <- new.ttar.df.males[new.ttar.df.males$tot_a_r30>=10, ]

#This df replaces the 'bmdcs.females' data set
new.ttar.df.females <- new.ttar.df.females[new.ttar.df.females$tot_a_r30>=10, ]

#This df replaces the 'bmdcs.nonAA.male' data set
new.ttar.df.nonAA.male <- new.ttar.df.nonAA.male[new.ttar.df.nonAA.male$tot_a_r30>=10, ]

```

### 3.1.12. Tracking data frames
```{r eval=TRUE}
#save a new df
bmdcs.tracking <- bmdcs[bmdcs$visit==0 | bmdcs$visit==6, ] 
#save a df with only baseline data
bmdcs.tracking.0 <- bmdcs.tracking[bmdcs.tracking$visit==0, ]
#save a new df with only 6-year data
bmdcs.tracking.6 <- bmdcs.tracking[bmdcs.tracking$visit==6, ]
#merge the baseline and 6-year dfs
final.bmdcs.tracking <- dplyr::full_join(bmdcs.tracking.0, bmdcs.tracking.6, all.x = TRUE, by = c("randid"))
#check that they merged properly ---- good!
head(final.bmdcs.tracking)

final.bmdcs.tracking.male <- final.bmdcs.tracking[final.bmdcs.tracking$gender.x==1, ] #tracking df for males
final.bmdcs.tracking.female <- final.bmdcs.tracking[final.bmdcs.tracking$gender.x==2, ]  #tracking df for females
```

### 3.1.13. Age groups at baseline
```{r eval=TRUE}
#(Young group, < 9 years old) Exclude every row with an age greater than 9.999
track.age.young <- final.bmdcs.tracking[final.bmdcs.tracking$age.x <= 9.999, ]
#summary(track.age.young$age.x)

#(Medium age group, 10-14.9 years old) First exclude everyone with an age less than 10, next exclude eveyone with an age greater than 14.999
track.age.medium <- final.bmdcs.tracking[final.bmdcs.tracking$age.x >= 10, ]
track.age.medium <- track.age.medium[track.age.medium$age.x <= 14.999, ]
#summary(track.age.medium$age.x)

#(Old age group, >10 years old) Exclude every row with an age less than 15
track.age.old <- final.bmdcs.tracking[final.bmdcs.tracking$age.x >= 15, ]
#summary(track.age.old$age.x)
```

### 3.1.14. Fracture data frame
```{r eval=TRUE}
bmdcs.fracture <- bmdcs
bmdcs.fracture$brknbone[bmdcs.fracture$brknbone == 2] <- 0 #for logistic regression, values need to be 0 and 1, so we need to change all 2s to 0s
head(bmdcs.fracture$brknbone, 20) #confirm this transformation worked... successful!
```

# 4. Results

## 4.1. Baseline descriptive characteristics

```{r eval=TRUE}
describe(baseline$age)
describe(baseline$haz)
describe(baseline$waz)
describe(baseline$bmiz)

table(baseline$black)
table(baseline$gender)
```


## 4.2. Characterization of UD radius aBMD during childhood in African American and non-African American Males and Females

### 4.2.1. Figure 1 (A and B). UD radius raw values (A) and Z-scores (B) by race and sex 
```{r eval=TRUE}
#Raw Values
ggplot(data=bmdcs.figs, aes(x=factor(gender.2), fore_r_ud_bmd_pc)) + 
    geom_boxplot(color="black", fill="lightblue") +
    facet_grid(. ~black) +
    labs(title="A) UD Radius BMD in African American and non-African 
    American Males and Females") +
    labs(x="Gender", y="UD Radius BMD (g/cm2)")

#Z Scores
ggplot(data=bmdcs.figs, aes(x=factor(gender.2), ud_radius_bmd_z)) + 
    geom_boxplot(color="black", fill="lightblue") +
    facet_grid(. ~black) +
    labs(title="B) UD Radius BMD in African American and non-African 
    American Males and Females") +
    labs(x="Gender", y="UD Radius BMD (Z-score)")

```

### 4.2.2. Figure 2 (A-D). UD radius by age in AA females (A), AA males (B), non-AA females (C), and non-AA males (D)
```{r eval=TRUE}

ggplot(data=bmdcs.figs.aa.female, aes(age, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="A) AA Female: Age vs. UD Radius BMD") + 
    geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) +
    labs(x="Age (years)", y="UD Radius BMD (g/cm2)")

ggplot(data=bmdcs.figs.aa.male, aes(age, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="B) AA Male: Age vs. UD Radius BMD") + 
    geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) +
    labs(x="Age (years)", y="UD Radius BMD (g/cm2)")
    
ggplot(data=bmdcs.figs.non.aa.female, aes(age, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="C) non-AA Female: Age vs. UD Radius BMD") + 
    geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) +
    labs(x="Age (years)", y="UD Radius BMD (g/cm2)")
    
ggplot(data=bmdcs.figs.non.aa.male, aes(age, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="D) non-AA male: Age vs. UD Radius BMD") + 
    geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) +
    labs(x="Age (years)", y="UD Radius BMD (g/cm2)")
```

### 4.2.3. Changes in UD radius aBMD with age during childhood
```{r eval=TRUE}
ud.radius.model.1.2 = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + gender + scale(age) + scale(age_squared), data = bmdcs)
summary(ud.radius.model.1.2)
#confint(ud.radius.model.1.2)
#nobs(ud.radius.model.1.2)
#extractAIC(ud.radius.model.1.2)
```
Race, gender, age, and age squared were significantly associated with UD radius aBMD. The positive relationship with race indicates greater aBMD in blacks versus non-blacks, and a negative relationship with gender indicates greater aBMD in males versus females. These results pertaining to race and sex differences in UD radius aBMD are supported by Figure 1 above. That the polynomial age term was signicicantly assiated with UD radius aBMD suggest that bone density increases during childhood in a non-linear fashion. These results pertaining to non-linear changes in UD radius aBMD are supported by Figure 2 above. It should be noted that additional polynomial terms (age cubed and age to the fourth power) were also investigated with respect to UD radius aBMD. Age squared was determined to be the most appropriate age term considering the strength of the relationship with the bone density outcome, as well as the best model fit which was assessed by comparing the AIC. For simplicity, only the age squared model is presented in this final report.

### 4.2.4. Changes in UD radius aBMD with age during childhood: race and sex interactions
```{r eval=TRUE}
ud.radius.model.2.c = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + gender + scale(age) + scale(age_squared) + scale(age_squared_by_black) + scale(age_squared_by_gender), data = bmdcs)
summary(ud.radius.model.2.c)
#confint(ud.radius.model.2.c)
#nobs(ud.radius.model.2.c)
#extractAIC(ud.radius.model.2.c)
```
Two-way interactions between age squared with race and sex, with respect to UD radius, were statistically significant. These results are consistent with the data presented in Figure 2. It should be noted that the three way interaction between age squared, race, and sex was also investigated, but was not statistically significant. For simplicity, the most parsimonious model is presented in this final report.


### 4.3. Characterizing the relationship between radius cortical bone and UD radius aBMD during childhood

### 4.3.1. Relationship between radius Ct.vBMD and UD radius aBMD 
```{r eval=TRUE}
ggplot(data=bmdcs.figs.male, aes(crt_den_r30, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="A) Males: Radius Ct.vBMD vs. UD Radius BMD") + 
    #geom_smooth(color = "red") #+ 
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) + 
    labs(x="Radius Ct.vBMD (g/cm3)", y="UD Radius (g/cm2)")


ggplot(data=bmdcs.figs.female, aes(crt_den_r30, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="B) Females: Radius Ct.vBMD vs. UD Radius BMD") + 
    #geom_smooth(color = "red") #+
    geom_smooth(color = "green", method = lm) +
    geom_smooth(color = "lightblue", method = loess) +   
    labs(x="Radius Ct.vBMD (g/cm3)", y="UD Radius (g/cm2)")


```

```{r eval=TRUE}
#Male
full.ctvbmd.udBMD.males = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + scale(age) + scale(age_squared) + scale(crt_den_r30), data = bmdcs.male)
summary(full.ctvbmd.udBMD.males)
#confint(full.ctvbmd.udBMD.males)
nobs(full.ctvbmd.udBMD.males)
extractAIC(full.ctvbmd.udBMD.males)

#Female
full.ctvbmd.udBMD.females = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + scale(age) + scale(age_squared) + scale(crt_den_r30), data = bmdcs.female)
summary(full.ctvbmd.udBMD.females)
#confint(full.ctvbmd.udBMD.females)
nobs(full.ctvbmd.udBMD.females)
extractAIC(full.ctvbmd.udBMD.females)

#Sex interaction
bmdcs$gender_by_crt_den_r30 <- bmdcs$gender * bmdcs$crt_den_r30

full.ctvbmd.udBMD.interaction = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + gender + black + scale(age) + scale(age_squared) + scale(crt_den_r30) + scale(gender_by_crt_den_r30), data = bmdcs)
summary(full.ctvbmd.udBMD.interaction)
#confint(full.ctvbmd.udBMD.interaction)
nobs(full.ctvbmd.udBMD.interaction)
extractAIC(full.ctvbmd.udBMD.interaction)
```
Radius Ct.vBMD is associated with UD radius BMD in females but not males. However, there was no significant interaction between sex and Ct.vBMD in the prediction of UD radius aBMD. 

### 4.3.2. Relationship between Tt.Ar (total bone area) and UD Radius aBMD
```{r eval=TRUE}
ggplot(data=new.ttar.df.males, aes(tot_a_r30, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="Males: Radius Tt.Ar vs. UD Radius BMD") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) +
    #geom_smooth(color = "lightblue", method = loess)
    labs(x="Radius Tt.Ar (cm2)", y="UD Radius BMD (g/cm2)")

ggplot(data=new.ttar.df.females, aes(tot_a_r30, fore_r_ud_bmd_pc)) + 
    geom_point(color = "gray") +
    labs(title="Females: Radius Tt.Ar vs. UD Radius BMD") + 
    #geom_smooth(color = "red") #+
    geom_smooth(color = "green", method = lm) +
    #geom_smooth(color = "lightblue", method = loess)
    labs(x="Radius Tt.Ar (cm2)", y="UD Radius BMD (g/cm2)")

```

```{r eval=TRUE}
#Male
full.ttar.udBMD.males = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + scale(age) + scale(age_squared) + scale(tot_a_r30), data = new.ttar.df.males)
summary(full.ttar.udBMD.males)
#confint(full.ttar.udBMD.males)
nobs(full.ttar.udBMD.males)
extractAIC(full.ttar.udBMD.males)

#Female
full.ttar.udBMD.female = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + black + scale(age) + scale(age_squared) + scale(tot_a_r30), data = new.ttar.df.females)
summary(full.ttar.udBMD.female)
#confint(full.ttar.udBMD.female)
nobs(full.ttar.udBMD.female)
extractAIC(full.ttar.udBMD.female)

#Sex interaction
new.ttar.df$gender_by_tot_a_r30 <- new.ttar.df$gender * new.ttar.df$tot_a_r30

full.ttar.udBMD.interaction = lmer(scale(fore_r_ud_bmd_pc) ~ (1 | randid) + gender + black + scale(age) + scale(age_squared) + scale(tot_a_r30) + scale(gender_by_tot_a_r30), data = new.ttar.df)
summary(full.ttar.udBMD.interaction)
#confint(full.ttar.udBMD.interaction)
nobs(full.ttar.udBMD.interaction)
extractAIC(full.ttar.udBMD.interaction)
```
Tt.Ar is positively associated with UD radius aBMD in both males and females while controlling for ancestry. The significant interaction term between gender and Tt.Ar indicates that this relationship is significantly stronger in the females versus the males.

## 4.4. Characterizing the tracking of UD radius aBMD during childhood

### 4.4.1. Relationship between baseline and 6-year UD radius aBMD 
```{r eval=TRUE}
#scatter plot to visualize tracking relationship in ALL
ggplot(data=final.bmdcs.tracking, aes(ud_radius_bmd_z.x, ud_radius_bmd_z.y)) + 
    geom_point(color = "gray") +
    labs(title="Baseline UD Radius BMD vs. 6-Year UD Radius BMD") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) #+
    #geom_smooth(color = "lightblue", method = loess)
```

```{r eval=TRUE}
summary.lm(lm(ud_radius_bmd_z.x ~ ud_radius_bmd_z.y + black.x + gender.x, data=final.bmdcs.tracking))
```
UD radius aBMD Z-scores track strongly during childhood. The race and sex interactions were explored, but were not significant. Thus, the most parsimonious model was included in this final report. 

### 4.4.2. Tracking of UD radius aBMD based on baseline age
```{r eval=TRUE}
ggplot(data=track.age.young, aes(ud_radius_bmd_z.x, ud_radius_bmd_z.y)) + 
    geom_point(color = "gray") +
    labs(title="Baseline UD Radius BMD vs. 6-Year UD Radius BMD") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) #+
    #geom_smooth(color = "lightblue", method = loess) 

ggplot(data=track.age.medium, aes(ud_radius_bmd_z.x, ud_radius_bmd_z.y)) + 
    geom_point(color = "gray") +
    labs(title="Baseline UD Radius BMD vs. 6-Year UD Radius BMD") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) #+
    #geom_smooth(color = "lightblue", method = loess) 

ggplot(data=track.age.old, aes(ud_radius_bmd_z.x, ud_radius_bmd_z.y)) + 
    geom_point(color = "gray") +
    labs(title="Baseline UD Radius BMD vs. 6-Year UD Radius BMD") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) #+
    #geom_smooth(color = "lightblue", method = loess)
```

```{r eval=TRUE}
#Younger age (< 10 years old)
summary.lm(lm(ud_radius_bmd_z.x ~ ud_radius_bmd_z.y + black.x + gender.x, data=track.age.young))
#Medium age (10 - 14.9 years old)
summary.lm(lm(ud_radius_bmd_z.x ~ ud_radius_bmd_z.y + black.x + gender.x, data=track.age.medium))
#Older age (> 10 years old)
summary.lm(lm(ud_radius_bmd_z.x ~ ud_radius_bmd_z.y + black.x + gender.x, data=track.age.old))
```


## 4.5. Characterizing the relationship between UD radius aBMD and stature during childhood

### 4.5.1. Linear relationship between UD Radius aBMD and baseline HAZ
```{r eval=TRUE}
ggplot(data=bmdcs, aes(haz, ud_radius_bmd_z)) + 
    geom_point(color = "gray") +
    labs(title="HAZ versus UD Radius aBMD Z-score") + 
    #geom_smooth(color = "red") +
    geom_smooth(color = "green", method = lm) #+
    #geom_smooth(color = "lightblue", method = loess)
```

```{r eval=TRUE}
summary.lm(lm(haz ~ ud_radius_bmd_z, data=bmdcs))
```

### 4.5.2. Differences in UD radius aBMD across HAZ groups (HAZ <-1, -1 to 1, >1)
```{r eval=TRUE}
bmdcs$haz.groups <- cut(bmdcs$haz, c(-5, -1, 1, 5))

ggplot(data=bmdcs, aes(x=factor(haz.groups), y=ud_radius_bmd_z)) +
    geom_boxplot(color="black", fill="lightblue", na.action=na.exclude)

```

```{r eval=TRUE}
haz.group.anova <- aov(haz ~ haz.groups, data = bmdcs)
summary(haz.group.anova)
```


## 4.6. Understanding whether UD radius aBMD Z-scores are associated with fracture in childhood

### 4.6.1. Differences in UD radius aBMD between those with and without a history of fracture
```{r eval=TRUE}
ggplot(data=bmdcs.fracture, aes(x=factor(brknbone), y=ud_radius_bmd_z)) +
    geom_boxplot(color="black", fill="lightblue", na.action=na.exclude)
```

```{r eval=TRUE}
summary((glm(brknbone~ ud_radius_bmd_z, data=bmdcs.fracture, family=binomial())))
```


# Summary of Results 
In summary, UD radius aBMD increases non-linearly during childhood, and these changes are greater in blacks versus non-blacks and males versus females. In females, both cortical bone volumetric density and cortical bone area were associated with UD radius aBMD, but in males, only cortical bone area correlated with UD radius aBMD. This is likely attributed to females having denser bones than males, and males having larger bones than females. Tracking correlation coefficients were strong, but differed across childhood. Specifically, UD radius aBMD appeared to track strongest in those who were older at the baseline time point. This difference is likely attributed to the fact that the older individuals are likely closer to peak bone mass and have already surpassed the most rapid period of bone accrual, so subsequent changes over a 6 year perior are therefore lower and less variable when compared to the younger individuals. There was a modest but significant positive correlation between UD radius aBMD and HAZ, indicating that the taller children had greater bone density at the forearm. However, given the relatively low strength of this correlation coefficient, the significance of this relationship should not be overstates, as this might be an artifactual finding due to our large sample size (>10,000 measurements). Thus, suggesting that UD radius aBMD might provide a relatively unbiased measure of bone density, albeit compared to other more biased measures such as lumbar spine and total body bone density, for individuals with short stature (HAZ > 2.0). Finally, logistic regression was performed to determine whether UD radius aBMD was associated with self-reported fracture history. Forearm bone density was slightly lower in those with a prior fracture, but this difference was not statistically significant. Since a substantial fracture history was part of the exclusion criteria for the original study, the link between UD radius aBMD and fracture still warrants more rigorous testing in appropriate pediatric cohorts.  
