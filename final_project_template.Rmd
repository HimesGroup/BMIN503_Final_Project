---
title: "BMIN503/EPID600 Project Template"
author: "Katie Sullivan"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

### Overview
<ul style="list-style-type:circle">
# Overview
<li> This project aims to understand whether epigenetic changes contribute to a higher risk of type 2 diabetes and DKD in Pima Indians.</li>
<li> The objective of this project is analyze cytosine methylation changes (5mC) which exist in the Pima Indian population with diabetes, and compare these to individuals without diabetes. We also would like to investigate how these methylation changes relate to kidney outcomes. </li>
</ul> 

### Introduction
+ ***first paragraph***:  Pima Indians of Arizona have an extremely high prevalence of type 2 diabetes and Diabetic Kidney Diseasae (DKD)Â . Genetically related Pima Indians living in Mexico, whose lifestyle remains traditional, have a much lower prevalence of these morbidities. The differences in lifestyle indicate that environmental factors play an important role in disease origins and suggest involvement of epigenetic programming.

###Methods
<ul style="list-style-type:circle">
<li> 327 Pima Indians (205 women, 122 men) were selected from a longitudinal cohort, all had an eGFR greater than 60ml/min and ACR <300mg/g at baselinem ie absence of diabetic kidney disease. DNA methylation from peripheral blood leukocytes was analyzed on an Illumina Infinium HumanMethylation 450 Beadchip. Preprocessing and Quality Control will be performed using the SeSame package in R, Methylation changes will be transformed to M values. I plan to use the following covariates in my regression models: age, sex, duration of diabetes, mean blood pressure, HbA1c, genotype, batch, cell count and conversion efficiency. P-values will be corrected for multiple comparisons.




### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 
                                                                                           
```{r, eval=TRUE}

local({r <- getOption("repos")
       r["CRAN"] <- "http://cran.r-project.org"
       options(repos=r)})

```
                                                                                                                                            
```{r, eval=TRUE}
                                                                                                                                            
# install sesame package
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("sesame")

install.packages("dplyr")


```                                                                                                                                           

```{r,eval=TRUE}
install.packages("ggpubr")
```

```{r}
library(sesame)
library(ggplot2)
library(dplyr)
library(ggpubr)
#install packages needed. sesame will load and pre-process methylation files, ggplot for visualization
```

```{r}
                                                                                                                                            
### Import data
idat.dir <- "/home/sullka/idat"   #pmacs own directory
#betas <- openSesame(idat.dir, quality.mask = FALSE)  #cannot run on own system due to computational space

```

```{r, eval=FALSE}
   #perform inverse normalization of beta values 

#for (i in 1:485577 {
  #betas2[i,]<-qnorm((rank(betas,na.last="keep")-0.5)/sum(!is.na(betas)))  #again ran in pmacs 
#}
#reference https://www.biostars.org/p/80597/

#save object to a RDS file

#saveRDS(betas2, file = "inversenormalizedbetamatrix.rds" 


```
### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

```{r,eval=TRUE}

# Phenotype data is stored in a file called blood327.csv. I will load this file and then view the phenotype charachteristics

pheno_data<-read.csv("/Users/katiesullivan/Documents/blood327_katie.csv")
print(head(pheno_data))
str(pheno_data)

```

```{r,eval=TRUE}
# Start formatting data set. First step: change 1 to male and 2 to female 
pheno_data<- pheno_data %>%
  mutate(sex = recode(sex, "1" = "male",
                             "2" = "female",
                            )
  )

```

```{r,eval=TRUE}
# Each column of the data set contains data. We wanted to make a summary of each column
summary_data <- sapply(pheno_data, summary)
```

```{r,eval=TRUE}
#Here I wanted to plot out some variables against each other. egfr stands for estimated glomrrular filtration rate, which is a marker of kidney health. hbA1c stands for glycosylated haemoglobin which is a measure of diabetes severity. 
plot_hba1c_egfr<-ggplot(pheno_data, aes(x = hba1c, y =egfr)) + 
  geom_point()

plot_hba1c_egfr

plot_age_egfr<-ggplot(pheno_data, aes(x = age, y =egfr)) + 
  geom_point()

plot_age_egfr

```

```{r,eval=TRUE}
# Understand if there is a signficant correlation between hba1c and egfr and egfr and age. 
#For this I will use the ggpubr package.
# hba1c, age and egfr are normally distributed so I will use pearson. 

cor.test(pheno_data$hba1c, pheno_data$egfr, metod="pearson")
cor.test(pheno_data$age, pheno_data$egfr, metod="pearson")
         
       


```

