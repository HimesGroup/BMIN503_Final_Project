---
title: "BMIN503 Final Project"
author: "Taylor Hertzler"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

This project examines the connection between crime rates and healthcare access. It assesses whether the expansion of Medicaid under the Affordable Care Act (ACA) has led to an increase or decrease in crime rates. Answering this question will involve finding crime-rate data throughout the country (at the zip code level). These data are available from many state websites. It will also require data on Medicaid expansion (which states have expanded and when). These data are available from many sources, but this [interactive map](https://www.kff.org/medicaid/issue-brief/status-of-state-medicaid-expansion-decisions-interactive-map/) from KFF.org is one of the most intuitive.

I consulted three faculty members to help design this project: Dr. Jonathan Klick, Professor of Law, Penn Law; Dr. Douglas J. Wiebe, Professor of Epidemiology, Perelman, Department of Biostatistics, Epidemiology and Informatics; and Dr. Jesse Yenchih Hsu, Assistant Professor of Biostatistics and Epidemiology, Perelman, Department of Biostatistics, Epidemiology and Informatics.

Dr. Klick helped me to come up with the idea and pointed me to some data sources, including the many papers that have already studied the expansions in other ways. Dr. Wiebe helped me to take my original question (“Have the state Medicaid expansions under ACA affected crime rates?”) and make it more specific and testable (see below). He said that the best way to do this would be a before-and-after analysis rather than a cross-sectional one that compares implementation states with non-implementation states at one point in time only. He also suggested that I analyze a specific year or an average of a few years, rather than a trend line across years; doing this for a before and an after for each implementation state and each non-implementation state will allow me to complete a difference-in-differences analysis, which is a particularly strong study design. Dr. Hsu cautioned me to be conservative in any conclusions I draw, since the large possibility of confounding variables means that I might not be able to assert a straight causal connection, and to discuss the most likely confounding variables. He also suggested that I use zip code-level rather than statewide data, for that will allow me to get a much greater sample size.

[Final Project Github Repository](https://github.com/hzler/BMIN503_Final_Project)

### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

My topic is “Has expansion of Medicaid under ACA affected statewide crime rates in the states that have implemented expansion?” As part of ACA, many states have expanded their Medicaid programs, a process that began in 2014. This expansion, however, has not been uniform, as many states did not expand right away, and many states have not expanded at all. In expansion states, Medicaid expansion affects both access to and costs of healthcare. Many researchers have accordingly studied these expansions to see how those access/costs changes have affected other social phenomena. One aspect that has received little attention, however, is the effects expansion has had on crime rates. Increasing healthcare costs may induce increased rates of stealing, e.g., and decreasing costs may do the converse.

Most of the debate around ACA has concerned its efficacy: improving access to healthcare, decreasing healthcare costs, improving the efficiency of our healthcare system etc. Less of the debate concerns ACA's secondary effects: how its policies affect social phenomena like employment, education, secondary governmental policies (e.g., drug laws or welfare programs) etc. One important secondary effect to address is crime rates and how, if at all, ACA's expansion programs have affected them. Any causal connections that do exist between the two should play a part in the nation's continued debate over our national healthcare scheme.

This problem is interdisciplinary because it involves informatics, healthcare and criminology. Healthcare and crime continue to be pressing topics throughout our nation, at various governmental levels, making this an important topic. Both also tend to have lots of data, making them ripe for empirical analysis. The project begins with healthcare data, as the first step is to group all fifty states into expansion and non-expansion states and identifying expansion years for analysis. The criminology aspects concern not just crime data but which _types_ of crime data to use. Most states compile total criminal offenses but then subdivide those into violent and non-violent offenses. But the informatics component informs which parts of these data to use and how to use them to answer the above question. This problem thus incorporates these three disciplines to answer a question that ultimately concerns public policy.

### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 


The first step is to obtain criminal data from the Department of Justice. DOJ's Uniform Crime Reporting Program has county-level crime data going back several decades. The crime data are both comprehensive, covering most of the nation, as well as detailed, dividing crimes into violent and nonviolent and counting each individual crime type (e.g., murder, arson etc.) within those categories.

The analyses to be conducted will require data from two different years. The first year should be shortly before any states expanded Medicaid. Expansion began in 2014, so 2012 data will be used for the earlier year. The second year should be as far after expansion as possible. The most recent UCRP data are from 2016, so those data will be used for the later year.

One important factor to note: although counties record their own crimes on a county-level basis, some jurisdictions record crimes on a statewide basis only. Some state police, e.g., when recording crimes do not record the counties in which they occurred. In those cases, crime data are allocated to counties proportionate to their share of the total state population. This allocation should not pose a major problem here for two reasons: (1) this study compares states, not counties, so the data should reflect statewide increases; and (2) the statewide-only jurisdictions are not many, so they should not affect the calculations adversely.

```{r eval = TRUE}
library(haven)
arrests_2012 <- read_dta("ICPSR_35019/DS0001/35019-0001-Data.dta") #nationwide crime data for all ages, 2012
arrests_2012 <- subset(arrests_2012, select = 
      -c(STUDYNO, EDITION, PART, IDNO, AG_ARRST, JURFLAG, COVIND)) #removing unwanted columns
arrests_2016 <- read_dta("ICPSR_37059/DS0001/37059-0001-Data.dta") #nationwide crime data for all ages, 2016
arrests_2016 <- subset(arrests_2016, select = 
      -c(STUDYNO, EDITION, PART, IDNO, AG_ARRST, JURFLAG, COVIND)) #removing unwanted columns
```

Next, the data for each county in 2016 must be labeled based on whether that county lies in a state that has expanded Medicaid. The following states are those that (a) never expanded Medicaid, (b) adopted expansion but have yet to implement it or (c) expanded Medicaid after December 31, 2016: AL, FL, GA, ID, KS, ME, MS, MO, NE, NC, OK, SC, SD, TN, TX, VT, VA, WI, WY. All other fifty states (minus LA) plus DC had expanded Medicaid by January 1, 2016. LA will be excluded from the calculations because it expanded Medicaid on July 1, 2016.
```{r eval = TRUE}
library(dplyr)
library(stringr)
#removing Louisiana from both sets
arrests_2016 <- subset(arrests_2016, FIPS_ST != 22)
arrests_2012 <- subset(arrests_2012, FIPS_ST != 22)

#new column for expansion status
arrests_2016$EXPANSION_STATUS <- arrests_2016$FIPS_ST
arrests_2012$EXPANSION_STATUS <- arrests_2012$FIPS_ST

#to whomever evaluates my code, figuring out the following step took
#a bloody long time; I'd be curious if there's a way that doesn't
#involve manually inputting a number for every state.

#setting status as 0 for non-expansion states, 1 for expansion states in both sets
arrests_2016 <- arrests_2016 %>%
    mutate(EXPANSION_STATUS = if_else(str_detect(FIPS_ST, 
      "(1|12|13|16|20|23|28|29|31|37|40|45|46|47|48|50|51|55|56)$"), 0, 1))
arrests_2012 <- arrests_2012 %>%
    mutate(EXPANSION_STATUS = if_else(str_detect(FIPS_ST, 
      "(1|12|13|16|20|23|28|29|31|37|40|45|46|47|48|50|51|55|56)$"), 0, 1))


#combining state and county fips codes
colnames(arrests_2012)[colnames(arrests_2012) == "FIPS_ST"] <- "FIPS"
arrests_2012$FIPS <- sprintf("%02d", arrests_2012$FIPS)
arrests_2012$FIPS_CTY <- sprintf("%03d", arrests_2012$FIPS_CTY)
arrests_2012$FIPS <- paste0(arrests_2012$FIPS, arrests_2012$FIPS_CTY)
arrests_2012 <- subset(arrests_2012, select = -c(FIPS_CTY))

#same for 2016
colnames(arrests_2016)[colnames(arrests_2016) == "FIPS_ST"] <- "FIPS"
arrests_2016$FIPS <- sprintf("%02d", arrests_2016$FIPS)
arrests_2016$FIPS_CTY <- sprintf("%03d", arrests_2016$FIPS_CTY)
arrests_2016$FIPS <- paste0(arrests_2016$FIPS, arrests_2016$FIPS_CTY)
arrests_2016 <- subset(arrests_2016, select = -c(FIPS_CTY))

#ensuring that all data are numeric
arrests_2012$FIPS <- as.numeric(arrests_2012$FIPS)
arrests_2016$FIPS <- as.numeric(arrests_2016$FIPS)
sapply(arrests_2012, class)
sapply(arrests_2016, class)

#showing summaries of data
head(arrests_2012)
summary(arrests_2012)
```

Four separate datasets were then created, based on year and dividing between states that had expanded Medicaid by 2016: 2012 expansion states, 2012 non-expansion states, 2016 expansion states and 2016 non-expansion states.
```{r eval = TRUE}
#creating four separate datasets, distinguished by year and expansion status
arrests_2012_expansion <- subset(arrests_2012, EXPANSION_STATUS == 1)
arrests_2012_nonexpansion <- subset(arrests_2012, EXPANSION_STATUS == 0)
arrests_2016_expansion <- subset(arrests_2016, EXPANSION_STATUS == 1)
arrests_2016_nonexpansion <- subset(arrests_2016, EXPANSION_STATUS == 0)
```

```{r eval = TRUE}
#a question to whomever evaluates my code: do I actually need
#a random sample, or can I just perform my analyses on the
#entirety of the data for each dataset?

#getting two random samples of counties to use for both
#expansion and non-expansion states

#expansion:
sample_2012_exp <- sample_n(arrests_2012_expansion, 150, replace = FALSE)
joiner.exp <- subset(sample_2012_exp, select = FIPS)
sample_2016_exp <- left_join(joiner.exp, arrests_2016_expansion, by = "FIPS")

#non-expansion:
sample_2012_nonexp <- sample_n(arrests_2012_nonexpansion, 150, replace = FALSE)
joiner.nonexp <- subset(sample_2012_nonexp, select = FIPS)
sample_2016_nonexp <- left_join(joiner.nonexp, arrests_2016_nonexpansion, by = "FIPS")
```

There is not perfect unity between the counties included in 2012 and those included in 2016. This produced NA values in both 2016 samples. NA rows were therefore removed from both the 2016 samples, and the corresponding rows were removed from the 2012 samples.
```{r eval = TRUE}

#counting the number of NA rows in sample_2016_exp
150 - nrow(sample_2016_exp[complete.cases(sample_2016_exp), ])

x <- which(is.na(sample_2016_exp$CPOPARST)) #identifying those NA rows
y <- sample_2016_exp$FIPS[x] #fips IDs for those rows
z <- length(y)

#for loop to identify the corresponding rows in sample_2012_exp
#(this is where I've stopped)
for(i in 1:z){print(which(sample_2012_exp$FIPS == y[i]))}



#same process for nonexp data
150 - nrow(sample_2016_nonexp[complete.cases(sample_2016_nonexp), ])


```

```{r eval = TRUE}

```
### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
