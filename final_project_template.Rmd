---
title: "An Examination of Socio-demographic Differences in Sedentary Behavior"
author: "Liming Huang"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation in class will be based on the contents of this document. Replace the title/name and text below with your own, but leave the headers.

### Overview
Sedentary behavior is increasingly being recognized as a determinant of poor cardiovascular health, independent of physical activity levels. However, the socio-demographic correlates of both screen-based sedentary behavior (i.e., television and computer use) and transport based (i.e., driving time) have yet to be defined. To address this gap, this population level, cross-sectional study will examine the relationship between several key socio-demographic factors (age, sex, race, education, employment, shift-work urban/rural location, depression status, time spent outdoors in winter and summer) with screen-based and transport-based sedentary time. Data will be obtained from the baseline sample (N~500,000) of the United Kingdom Biobank Project.  The specific goals of this study are to determine:

1.	Are there socio-demographic differences in sedentary behavior among the UK Biobank sample?

2.	What is the socio-demographic profile of high sedentary behavior?





### Introduction 
Sedentary behavior is defined as time spent engaged in sitting or lying down activities that require an energy expenditure of 1.0 to 1.5 basal metabolic rates. Scientific evidence is accumulating that adult sedentary behavior might be associated with cardiovascular disease, cancer, Type 2 diabetes, metabolic syndrome and individual cardiovascular risk factors, obesity, overweight and adiposity, mental health, musculoskeletal disorders, cardiovascular mortality, and all-cause mortality. Research into the prevalence and determinants of sedentary behavior is essential to identify populations with high levels of sedentary behavior, and plan targeted interventions for those populations.

Correlates of sedentary behavior span multiple disciplines, including social and psychological domains. Examining the association of variables within these domains with sedentary behavior can generate plausible hypotheses to be tested and can provide initial insights relevant to the development of appropriate and targeted interventions. The collaborators on the current research team span these disciplines. Specifically, Dr. Freda Patterson is a public health researcher with expertise in cardiovascular health behavior change, including physical activity and sedentary behavior while Dr. Susan Malone has a nursing science background with expertise in cardiometabolic health. Together, this interdisciplinary team has the expertise to guide and disseminate the findings from the current investigation. 


### Methods
This study uses the UK Biobank data. UK Biobank is a large long-term biobank study in the UK investigating the respective contributions of genetic predisposition and environmental exposure to the development of disease. There are about 500,000 participants in the dataset who enrolled at ages from 40 to 69 voluntarily.

#### Exploratory Analysis

1. Sedentary behavior summary


```{r, eval=TRUE}

rm(list=ls())
getwd()
setwd ("F:/projects/002_biobank/derived_data")

library(dplyr)
library(ggplot2)

data <- read.csv(file = "F:/epid600_penn/EPID600_Final_Project/sedentary_data_for_R.csv", header = TRUE)
str(data)
data <- dplyr::rename (data, TOTAL_PHYS_ACTIVITY_N =  TOTAL_PHYS, BLOOD_PRESSURE_N = SYS_BP_AUTO, 
          FRUITVEG_N = FRUIT_VEG, BMI_N = BMI, BODY_FAT_N = BODY_FAT,
          CVD_RISK_N = FULL_CVD_RISK        ) 

data <- dplyr::mutate(data, GENDER = factor(SEX, labels=c("Female", "Male")),
           RACE = factor(RACE_NEW, labels=c("Mixed/Other", "Asian","Black","White")),
           COLLEGE_C = factor(COLLEGE,labels = c("No", "Yes")),
           EMPLOYMENT_C = factor(EMPLOYMENT, labels = c("Employed",
                                                        "Unemployed",
                                                        "Retired")),
           SHIFT_WORK_C = factor(SHIFT_WORK, labels = c("No", "Yes")),
           RESIDENCE_C = factor(RESIDENCE, labels = c("Urban", "Rural")),
           DEPRESSION_C = factor(MH_STATUS, labels = c("No", "Yes")),
           SEASON_ASSESS_C = factor(SEASON_ASSESS, labels = c("Fall", 
                                                    "Winter",
                                                    "Spring",
                                                    "Summer")),
           CHRONO_C = factor(CHRONO_4_CAT, labels = c("Definitely morning", 
                                                    "More morning than evening",
                                                    "More evening than morning",
                                                    "Definitely evening")),
           SLEEP_C = factor(SLEEP, labels = c("Short", "Long", "Adequate")),
           DIABETES_C = factor(DIABETES, labels = c("No", "Yes")),
           SMOKE_C = factor(SMOKE, labels = c("No", "Yes")),
           HYPERTENSION_MEDS_C = factor(BP_MEDS, labels = c("No", "Yes")),
           PHYSICAL_ACTIVITY_C = factor(PHYSACT_REC, labels = c("No", "Yes")),
           FRUITVEG_RECOMMEND_MET_C = factor(FRUITVEG_REC, labels = c("No", "Yes")),
           ALCOHOL_INTAKE_C = factor(ALCOHOL_INTAKE, labels = c("Daily or almost daily", 
                                                    "Three or four times a week",
                                                    "Once or twice a week",
                                                    "One to three times a month",
                                                    "Special occasions only",
                                                    "Never")),
           CVD_RISK_C = factor(CVD_RISK_N >= 0.4, labels = c("Low", "High"))
           )
          
save(data,file="data.Rda")


load("data.Rda")
str(data)


qplot(TV_HRS, data=data, geom="histogram", binwidth=1, col=I("blue"), fill=I("blue"), alpha=I(0.5))
summary(data$TV_HRS)

qplot(COMP_HRS, data=data, geom="histogram", binwidth=1, col=I("blue"), fill=I("blue"), alpha=I(0.5))
summary(data$COMP_HRS)


qplot(DRIVE_HRS, data=data, geom="histogram", binwidth=1, col=I("blue"), fill=I("blue"), alpha=I(0.5))
summary(data$DRIVE_HRS)

```

2. Sedentary behavior and continuous independent variables


```{r, eval=TRUE}

#Age

qplot(AGE, data=data, geom="histogram", binwidth=1, col=I("blue"), fill=I("blue"), alpha=I(0.5))
summary(data$AGE)

ggplot(data, aes(x=AGE, y=TV_HRS)) +
    geom_point() +    
    geom_smooth(method=lm)  
fit <- lm(TV_HRS ~ AGE, data=data)
summary(fit) 

ggplot(data, aes(x=AGE, y=COMP_HRS)) +
    geom_point() +    
    geom_smooth(method=lm)  
fit <- lm(COMP_HRS ~ AGE, data=data)
summary(fit) 

ggplot(data, aes(x=AGE, y=DRIVE_HRS)) +
    geom_point() +    
    geom_smooth(method=lm)  
fit <- lm(DRIVE_HRS ~ AGE, data=data)
summary(fit) 





```

3. Sedentary behavior and categorical variables


```{r, eval=TRUE}

#Gender

table(data$GENDER)

ggplot(data=data, aes(GENDER, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ GENDER, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(GENDER, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ GENDER, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(GENDER, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ GENDER, data=data)
summary.lm(aov.out)




#Race

table(data$RACE)

ggplot(data=data, aes(RACE, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ RACE, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(RACE, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ RACE, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(RACE, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ RACE, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)




#College

table(data$COLLEGE_C)

ggplot(data=data, aes(COLLEGE_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ COLLEGE_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(COLLEGE_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ COLLEGE_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(COLLEGE_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ COLLEGE_C, data=data)
summary.lm(aov.out)



#Employment

table(data$EMPLOYMENT_C)

ggplot(data=data, aes(EMPLOYMENT_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ EMPLOYMENT_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(EMPLOYMENT_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ EMPLOYMENT_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(EMPLOYMENT_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ EMPLOYMENT_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)






#Work shift

table(data$SHIFT_WORK_C)

ggplot(data=data, aes(SHIFT_WORK_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ SHIFT_WORK_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(SHIFT_WORK_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ SHIFT_WORK_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(SHIFT_WORK_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ SHIFT_WORK_C, data=data)
summary.lm(aov.out)




#Residence

table(data$RESIDENCE_C)

ggplot(data=data, aes(RESIDENCE_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ RESIDENCE_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(RESIDENCE_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ RESIDENCE_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(RESIDENCE_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ RESIDENCE_C, data=data)
summary.lm(aov.out)





#Depression

table(data$DEPRESSION_C)

ggplot(data=data, aes(DEPRESSION_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ DEPRESSION_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(DEPRESSION_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ DEPRESSION_C, data=data)
summary.lm(aov.out)


ggplot(data=data, aes(DEPRESSION_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ DEPRESSION_C, data=data)
summary.lm(aov.out)



#Season of assessment

table(data$SEASON_ASSESS_C)

ggplot(data=data, aes(SEASON_ASSESS_C, TV_HRS)) + 
    geom_boxplot() 
aov.out = aov(TV_HRS ~ SEASON_ASSESS_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(SEASON_ASSESS_C, COMP_HRS)) + 
    geom_boxplot() 
aov.out = aov(COMP_HRS ~ SEASON_ASSESS_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)


ggplot(data=data, aes(SEASON_ASSESS_C, DRIVE_HRS)) + 
    geom_boxplot() 
aov.out = aov(DRIVE_HRS ~ SEASON_ASSESS_C, data=data)
summary.lm(aov.out)
TukeyHSD(aov.out)





```

#### Linear Regression

```{r, eval=TRUE}
#TV_HRS
fit_tv <- lm(TV_HRS ~ AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C, data=data)
summary(fit_tv)


#COMP_HRS
fit_comp <- lm(COMP_HRS ~ AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C, data=data)
summary(fit_comp)




#DRIVE_HRS
fit_drive <- lm(DRIVE_HRS ~ AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C, data=data)
summary(fit_drive)





```

 
#### Decision Tree

```{r, eval=TRUE}
library(rpart); library(partykit)

#TV_HRS
set.seed(101)
train <- sample(1:nrow(data), nrow(data)*0.6)
test <- data[-train, "TV_HRS"]
tree_tv <- rpart(TV_HRS~AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C,  method="anova", data=data, subset=train)
plot(as.party(tree_tv), type="simple")
#plot(as.party(tree1), type="extended")
summary(tree_tv)
yhat <- predict(tree_tv, data[-train,])
plot(yhat, test)
abline(0,1)
mean((yhat-test)^2)




#COMP_HRS
set.seed(101)
train <- sample(1:nrow(data), nrow(data)*0.6)
test <- data[-train, "COMP_HRS"]
tree_comp <- rpart(COMP_HRS~AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C,  method="anova", data=data, subset=train)
plot(as.party(tree_comp), type="simple")
#plot(as.party(tree1), type="extended")
summary(tree_comp)
yhat <- predict(tree_comp, data[-train,])
plot(yhat, test)
abline(0,1)
mean((yhat-test)^2,na.rm = TRUE)



#DRIVE_HRS
set.seed(101)
train <- sample(1:nrow(data), nrow(data)*0.6)
test <- data[-train, "DRIVE_HRS"]
tree_drive <- rpart(DRIVE_HRS~AGE+SEASON_ASSESS_C+GENDER+RACE+COLLEGE_C+EMPLOYMENT_C+
             SHIFT_WORK_C+RESIDENCE_C+DEPRESSION_C,  method="anova", data=data, subset=train)
plot(as.party(tree_drive), type="simple")
#plot(as.party(tree1), type="extended")
summary(tree_drive)
yhat <- predict(tree_drive, data[-train,])
plot(yhat , test)
abline(0,1)
mean((yhat-test)^2,na.rm = TRUE)
```




### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.










