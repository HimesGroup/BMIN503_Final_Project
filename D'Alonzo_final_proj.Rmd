---
title: "Exploring Countermovement Jump (CMJ) Scan Movement Signatures in Men's Collegiate Lacrosse Athletes"
author: "Bernadette D'Alonzo"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***

### Overview
Members of Penn Athletics, Penn Sports Medicine, and the Penn Injury Science Center are collaborating on a large study titled “Force Plate Analysis in Collegiate Athletes: An Epidemiologic and Injury Prevention Study,” to evaluate a program that has been active at Penn over the last 5 years. The overarching goal of that study is to investigate whether force plate measurements can predict injuries, and performance outcomes, and whether (and how) measurements vary across sports and sex. Exploring this may identify sport-specific profiles that may inform customized strength and conditioning injury prevention programs. The objective of this class project is to take a step back from prediction to first answer the question of whether and how these measurements vary between athletes from the same sport compared to within one athlete over time, and we will examine this in the context of men’s lacrosse players. For this project, I have been working with a large interdisciplinary team including: Dr. Doug Wiebe, Professor of Epidemiology and Director of the Penn Injury Science Center (PISC), Dr. Abby Bretzin, Postdoctoral Fellow at PISC, Dr. Jeremy Weeks, Associate Director of Penn Strength & Conditioning (and Director of Research), and Dr. Brian Sennett, Chair of Athletic Medicine at Penn.


### Introduction 
The specific problem that this project addresses, is that the field currently does not have a strong understanding of how and the extent to which force plate measurements vary across collegiate athletes in the larger study playing the same sport, and within an athlete over time. This is a key concept to explore prior to estimating or predicting injury. Penn Athletics in particular is interested in this issue, having used force plates for 5 years, yet lacking evidence of the utility of what they are measuring. Ultimately, by identifying individuals who may be at increased risk of injury, we may be able to inform the development of targeted injury prevention programs, thereby improving countermeasure effectiveness. Sparta Science is a sports performance and injury evaluation tool utilized by multiple human movement-based industries, with significant use in military, athletic, and clinical settings. Sparta Science has been described as having a technology that may enable identifying athletes at-risk for sustaining an injury.To lay the groundwork for next studies on injury prediction, this project will investigate some of the metrics that force plates measure.

The collaborative nature of the team involved in this study is a strength and critical to the success of any of our projects. Penn’s Strength & Conditioning leadership and staff bring expertise in research utilizing force plates to date and Penn’s utilization and implementation of Sparta Science assessments. Penn Sports Medicine and Athletic Training contribute knowledge regarding the appropriateness and application of findings related to injury. Finally, Epidemiologists and Data Scientists provide support for study design, identify opportunities for natural and planned experiments, and interpretation of results.

From meetings with Strength & Conditioning, we have learned that the technology used in the Sparta Science system consists of a force plate, proprietary software, and a dataset projected to consist of data captured from more than 1,500,000 assessments. Current Sparta Science set-up at Penn consists of force plates with dedicated computers and software, and it is used with athletes across all years and varsity sports. Athletes begin with a standardized warm up that is completed just prior to the assessments; counter movement jump (CMJ); single leg balance scan, and single arm plank scan. The results of each assessment are computed by the software and converted to T-scores, by comparing to the Sparta Science dataset. For the CMJ assessment, the system generates industry-standard variables of force/time including Load, Explode, and Drive, which we will examine in this project. These scores represent an individual's ability to Create, Transfer, and Apply force efficiently and are referred to by Sparta as the individual's Movement Signature™. We have also learned that men’s lacrosse coaches have utilized the software most consistently in recent years, and at the encouragement of the Epidemiologists providing guidance on this project, we will focus on those athletes here. From Sports Medicine and Athletic Training, we have learned that lower-extremity injuries (LEIs) have been common among men’s lacrosse players at Penn, further underscoring this population as an ideal one to first explore patterns in CMJ scan measurements among team members and over time.


### Methods
The data utilized in this analysis were extracted from the Sparta Science platform and are part of a larger project, as discussed above. The main goal of this project is to use descriptive analyses and data visualization to explore and present the data in a meaningful way, and to aid in hypothesis generation.

I loaded the appropriate tidyverse packages and read in the Sparta scan data file (containing all sports). 

```{r}
library(dplyr)
library(ggplot2)

sparta.scans <- read.csv("U:/PhD program/600 Data Science_Final proj_Sparta/sparta_scan_summaries.csv", header = TRUE)
```

I wanted to focus on just one sport for this project, and so I looked at the total number of scans we had for each sport in the entire dataset. I confirmed that Men's lacrosse has the most (we knew that from conversations with Strength & Conditioning).
```{r}
#ID sport with most number of scans - we see that it's Men's Lacrosse.
scans.by.sport <- sparta.scans %>%
  group_by(Group.s.) %>%
  summarise(n()) %>%
  arrange(desc(`n()`))
print(scans.by.sport)
```

Next, I did a lot of cleaning and assigned new unique IDs for each athlete (id.new):
```{r}
#Cleaning up dataset here - remove identifiers, new labels, Men's Lacrosse only, Jump scan only.
sparta.scans.clean <- sparta.scans %>%
  select(Unique.ID, Group.s., Date, Time, Scan.Type, Load.t.score, Explode.t.score, Drive.t.score, Jump.height..in., Weight..lb., Injury.risk) %>%
  rename(id = Unique.ID, sport = Group.s., date.scan = Date, time.scan = Time, scan.type = Scan.Type, load.tscore = Load.t.score, explode.tscore = Explode.t.score, drive.tscore = Drive.t.score, jump.ht.in = Jump.height..in., jump.wt.lb = Weight..lb., injury.riskscore = Injury.risk) %>%
  filter(sport == "Lacrosse (M)") %>%
  filter(scan.type == "Jump")

#Check if missing - no.
sapply(sparta.scans.clean, function(x) length(x[is.na(x)]))

#Assigning new unique ID (pre-assigned from software is very long).
sparta.scans.clean <- sparta.scans.clean %>%
  group_by(id) %>%
  mutate(id.new = row_number())

#More cleaning - make new ID class character.
sparta.scans.clean$id.new <- as.character(sparta.scans.clean$id.new)
#Remove old ID from software.
sparta.scans.clean <- sparta.scans.clean[-c(1)]
#Make injury risk score a factor (1-5) from numeric.
sparta.scans.clean$injury.riskscore <- as.factor(sparta.scans.clean$injury.riskscore)

#Cleaned dataset here.
str(sparta.scans.clean)

```

### Results
We're looking now at 35 Men's lacrosse players with 852 jump scans from 2016-2020 (athletes with complete data).

```{r}
#Men's lacrosse - we have 35 players, 852 jump scans
length(unique(sparta.scans.clean$id.new))

#This table shows the number of scans per athlete, range 49-1
scans.per.athlete <- sparta.scans.clean %>%
  group_by(id.new) %>%
  summarise(n()) %>%
  arrange(desc(`n()`))
print(scans.per.athlete)
```

Exploring "Injury Risk Score" and variability within one athlete and across 35 athletes.
Below, we saw that for any given athlete, they almost all experience each injury risk score at point in time. A next step will be to see whether increase in injury risk score coincided with an injury occuring.
```{r}
#Shows frequencies of scans by injury risk score (scale range 0-5, no 4)
scans.injury.riskscore <- sparta.scans.clean %>% count(injury.riskscore)
print(scans.injury.riskscore)

#This shows most common injury risk score is 1 (then 3, 0, 5, 2)
ggplot(data = sparta.scans.clean, aes(x = injury.riskscore)) +
  geom_bar() +
  labs(y = "Scans (count)",
     x = "Injury risk score (0-5)") +
  ggtitle("# Scans by Injury Risk Score")

#This shows variability in scans by injury risk score both within the same athlete and across the 35 M lacrosse athletes. 
ggplot(data = sparta.scans.clean, aes(y = id.new, fill = injury.riskscore)) +
  geom_bar() +
  labs(y = "Athlete ID",
     x = "Scans (counts)",
     fill = "Injury risk score(0-5)") +
  ggtitle("Variability in Injury Risk Score within and across athletes")

#Jump height and injury risk score
#ggplot(data = sparta.scans.clean, aes(x = jump.ht.in, y = injury.riskscore)) +
  #geom_point()
ggplot(data = sparta.scans.clean, aes(x = jump.ht.in, y = injury.riskscore)) +
  geom_boxplot() +
  labs(y = "Injury risk score",
        x = "Jump height (in)") +
  ggtitle("Jump height (in) and Injury risk score")


```

Exploring "LOAD, EXPLODE, DRIVE" score and variability within one athlete and across 35 athletes.
```{r}
#This shows median, IQR of LOAD, EXPLODE, DRIVE tscores within and across all M lacrosse athletes
#LOAD
#ggplot(data = sparta.scans.clean, aes(x = load.tscore, y = id.new)) +
  #geom_point()
ggplot(data = sparta.scans.clean, aes(x = load.tscore, y = id.new)) +
  geom_boxplot() +
  labs(y = "Athlete ID",
         x = "Load t-score") +
  ggtitle("Variability in Load within and across athletes")

#EXPLODE
#ggplot(data = sparta.scans.clean, aes(x = explode.tscore, y = id.new)) +
  #geom_point()
ggplot(data = sparta.scans.clean, aes(x = explode.tscore, y = id.new)) +
  geom_boxplot() +
  labs(y = "Athlete ID",
         x = "Explode t-score") +
  ggtitle("Variability in Explode within and across athletes")

#DRIVE
#ggplot(data = sparta.scans.clean, aes(x = drive.tscore, y = id.new)) +
  #geom_point()
ggplot(data = sparta.scans.clean, aes(x = drive.tscore, y = id.new)) +
  geom_boxplot() +
  labs(y = "Athlete ID",
        x = "Drive t-score") +
  ggtitle("Variability in Drive within and across athletes")

```

Examining the relationship between LOAD, EXPLODE, DRIVE and injury risk score.
```{r}
#Scatterplots - LOAD, EXPLODE, DRIVE and injury.riskscore
ggplot(sparta.scans.clean, aes(x = load.tscore, y = explode.tscore,)) +
  geom_point(aes(color=factor(injury.riskscore))) +
  labs(y = "Explode t-score",
        x = "Load t-score")

ggplot(sparta.scans.clean, aes(x = explode.tscore, y = drive.tscore,)) +
  geom_point(aes(color=factor(injury.riskscore))) +
  labs(y = "Drive t-score",
         x = "Explode t-score")

ggplot(sparta.scans.clean, aes(x = load.tscore, y = drive.tscore,)) +
  geom_point(aes(color=factor(injury.riskscore))) +
  labs(y = "Drive t-score",
        x = "Load t-score")

```

I was interested in generating a variable similar to Sparta Science's Movement Signature, so I split each LOAD, EXPLODE, DRIVE t-score variable into tertiles - athletes were classified as "High," "Medium," "Low" on each LOAD, EXPLODE, DRIVE. I then concatenated them into a "Jump Profile."

```{r}
#Splitting LOAD, EXPLODE, DRIVE tscores into tertiles - low, med, high and added these columns to df
sparta.scans.clean <- sparta.scans.clean %>%
  mutate(load.tert = ntile(load.tscore, 3)) %>%
  mutate(load.tert = if_else(load.tert == 1, 'Low', if_else(load.tert == 2, 'Medium', 'High'))) %>%
  mutate(explode.tert = ntile(explode.tscore, 3)) %>%
  mutate(explode.tert = if_else(explode.tert == 1, 'Low', if_else(explode.tert == 2, 'Medium', 'High'))) %>%
  mutate(drive.tert = ntile(drive.tscore, 3)) %>%
  mutate(drive.tert = if_else(drive.tert == 1, 'Low', if_else(drive.tert == 2, 'Medium', 'High'))) %>%
  arrange(id.new)
#concatenate their "movement signature" into a "jump profile"
sparta.scans.clean$jump.profile <- paste(sparta.scans.clean$load.tert,sparta.scans.clean$explode.tert,sparta.scans.clean$drive.tert)

```

Below, we see a lot of variability within each athlete's LOAD, EXPLODE, DRIVE - across the board, athletes had scans where they were Low, Medium, High. We expected there to be some variation in scores across athletes, but were surprised by the variation within an athlete.

```{r}
#This shows variability in LOAD, EXPLODE, DRIVE within and across athletes
#Load
ggplot(data = sparta.scans.clean, aes(y = id.new, fill = load.tert)) +
  geom_bar() +
  labs(y = "Athlete ID",
       x = "Scans (counts)",
       fill = "Load tertiles") +
  ggtitle("Variability in Load within and across athletes")

#Explode
ggplot(data = sparta.scans.clean, aes(y = id.new, fill = explode.tert)) +
  geom_bar() +
  labs(y = "Athlete ID",
       x = "Scans (counts)",
       fill = "Explode tertiles") +
  ggtitle("Variability in Explode within and across athletes") 

#Drive
ggplot(data = sparta.scans.clean, aes(y = id.new, fill = drive.tert)) +
  geom_bar() +
  labs(y = "Athlete ID",
       x = "Scans (counts)",
       fill = "Drive tertiles") +
  ggtitle("Variability in Drive within and across athletes")

```

Putting these pieces together, I then looked at jump profile within an athlete and across our 35 M Lacrosse players, and saw a lot of variability here as well.
```{r}
#This shows the variability in jump profile within and across athletes
ggplot(data = sparta.scans.clean, aes(y = id.new, fill = jump.profile)) +
  geom_bar() +
  labs(y = "Athlete ID",
       x = "Scans (counts)",
       fill = "Jump profile - LOAD, EXPLODE, DRIVE") +
  ggtitle("Variability in jump profile within and across athletes")

```

Finally, I was interested in examining how these LOAD, EXPLODE, DRIVE variables were associated with Injury Risk Score as an outcome variable. 
I performed bivariate analysis, using linear(OLS) regression to look at the pairwise relationships between:
1) Load tscore - Injury Risk Score
2) Explode tscore - Injury Risk Score
3) Drive tscore - Injury Risk Score
And then fit a multivariable linear regression model:
4) Load, Explode, Drive as predictors of Injury Risk Score
```{r}

sparta.scans.clean$injury.riskscore.cont <- as.numeric(sparta.scans.clean$injury.riskscore)

summary(lm(injury.riskscore.cont ~ load.tscore, data = sparta.scans.clean))

summary(lm(injury.riskscore.cont ~ explode.tscore, data = sparta.scans.clean))

summary(lm(injury.riskscore.cont ~ drive.tscore, data = sparta.scans.clean))

injury.riskscore.cont.lm <- lm(injury.riskscore.cont ~ load.tscore + explode.tscore + drive.tscore, data = sparta.scans.clean)
summary(injury.riskscore.cont.lm)

```

****Discuss limitations here - assuming linear relationship.

### Conclusion/Next steps:
End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
