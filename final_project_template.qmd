---
title: "<br> Mobility Restrictions and the Spread of COVID-19 in the United States"
subtitle: "BMIN503/EPID600 Final Project"
author: 'Quynh Long Khuong'
date: last-modified
date-format: "MM-DD-YYYY"
title-block-banner: "#011F5B"
format: 
  html:
    embed-resources: true
    smooth-scroll: true
    theme: lumen
    toc: true
    toc-location: left
    toc-title: Summary
    urlcolor: orange
    linkcolor: orange
    df_print: kable
    # code-fold: true
execute:
  warning: false
bibliography: references.bib
csl: nature.csl
css: style.css
---

------------------------------------------------------------------------

```{r}
library(tidyverse)
library(lubridate)
library(urbnmapr)
```

## Overview {#sec-overview}

In this project, we aim to investigate the impact of mobility restrictions on the spread of COVID-19 in the U.S. The analysis takes into account other factors, including the government response to COVID-19, testing, and vaccination. The main sources of data include: (1) [US COVID-19 cases and deaths by state](https://usafacts.org/visualizations/coronavirus-covid-19-spread-map/) for number of new cases and new deaths of COVID-19 by state, (2) [Google mobility data](https://www.google.com/covid19/mobility/) for mobility information, and (3) [Coronavirus Pandemic (COVID-19)](https://ourworldindata.org/coronavirus) from *Our World in Data*. (See @tbl-table1)


This assignment is conducted with advice of Dr. John H. Holmes, PhD, FACE, FACMI, Professor of Medical Informatics in Epidemiology.

My GitHub repo for this project can be found [here](https://github.com/khuongquynhlong/BMIN503_Final_Project)


## Introduction {#sec-introduction}

Throughout the COVID-19 pandemic, human mobility restrictions were one of the main policies implemented in many countries with the aim of reducing the transmission of SARS-CoV-2. [@flaxman2020estimating; @lancet2020india; @signorelli2020covid] Such restrictions include physical distancing and community containment measures to reduce public transport use, public gatherings, school closures, and encouraging working from home where possible. Prior experiences with the 2009 H1N1 influenza [@chowell2011characterizing] and Ebola [@peak2018population] provided evidence for the effectiveness of these interventions in reducing disease transmission. However, the effectiveness of imposing mobility restrictions as a policy for controlling COVID-19 outbreaks has been controversial. Recent studies found that travel restrictions were effective in the early stages of the outbreak but may be less useful when the disease is widespread.[@kraemer2020effect; @oh2021mobility] Furthermore, these restrictions have also led to enormous economic losses.[@han2020lessons] Estimates suggest that global GDP growth has fallen by as much as 10%, at least part of which can be attributed to these mobility restrictions. [@hatzius2020sudden] Hence, it is critical to quantify the effectiveness of decisions to apply large-scale mobility restrictions in limiting the spread of the pandemic.

This study was conducted to investigate the impact of mobility restrictions on the spread of COVID-19 in the U.S. In fact, the U.S. experienced significant challenges in managing the pandemic in the early stages due to the large population, diverse demographics, and different healthcare settings across states. The findings of this project might not only support the current response but also contribute valuable evidence to the global scientific community, informing future disease control strategies. This evidence guides policymakers in future outbreaks, enabling timely interventions, especially when vaccination is not available.


## Methods {#sec-methods}

### Data sources

| Dataset                                       | Measurement | Temporal coverage  | Source             |
|-----------------------------------------------|-------------|--------------------|--------------------|
| COVID cases                                   | Daily       | Jan 2020-present   | [usafacts.org](https://usafacts.org/visualizations/coronavirus-covid-19-spread-map)       |
| COVID deaths                                  | Daily       | Jan 2020-present   | [usafacts.org](https://usafacts.org/visualizations/coronavirus-covid-19-spread-map)        |
| The U.S. population                           |             |                    | [usafacts.org](https://usafacts.org/visualizations/coronavirus-covid-19-spread-map)        |
| Google Mobility                               | Daily       | Feb 2020-present | [google.com](https://www.google.com/covid19/mobility)         |
| Vaccination, testing, and Government response | Daily       | Jan 2020-present   | [ourworldindata.org](https://ourworldindata.org/coronavirus) |

: Datasets Overview {#tbl-table1}




### Data preparation

::: panel-tabset
#### COVID-19

```{r}
#---------- COVID cases and deaths
df_case <- read_csv("Data/covid_confirmed_usafacts.csv")
df_death <- read_csv("Data/covid_deaths_usafacts.csv")
df_pop <- read_csv("Data/covid_county_population_usafacts.csv")

#----- Case: aggregate at state level
df_case <- df_case |>
  rename(county_name = `County Name`) |>
  gather(-c(countyFIPS, county_name, State, StateFIPS), 
            key = "date", value = "new_cases") |>
  mutate(date = ymd(date)) |> 
  group_by(State, date) |>
  summarise(new_cases = sum(new_cases, na.rm = T)) |>
  ungroup()

#----- Deaths: aggregate at state level
df_death <- df_death |>
  rename(county_name = `County Name`) |>
  gather(-c(countyFIPS, county_name, State, StateFIPS), 
         key = "date", value = "new_deaths") |>
  mutate(date = ymd(date))|> 
  group_by(State, date) |>
  summarise(new_deaths = sum(new_deaths, na.rm = T)) |>
  ungroup()

#----- Population: aggregate at state level
df_pop <- df_pop |> rename(county_name_pop = `County Name`) |>
  group_by(State) |>
  summarise(population = sum(population, na.rm = T)) |>
  ungroup()

#----- Merge new case, death, and population datasets
df_oc <- df_case |> left_join(df_death, by = c("State", "date")) |>
  left_join(df_pop, by = c("State"))

# Get counties shapefile: to get full state name from abbriviation
st_name_full <- urbnmapr::counties |>
  mutate(fips.code = as.numeric(county_fips)) |>
  group_by(state_abbv, state_name) |>
  slice(1) |>
  select(state_abbv, state_name)

# Create full name for state
df_oc <- df_oc |> rename(state_abbv = State) |>
  left_join(st_name_full, by = "state_abbv")
```

#### Mobility data

```{r}
#---------- Google Mobility data
df_mob <- read_csv("Data/Global_Mobility_Report.csv")

df_mob <- df_mob |> filter(country_region == "United States") |> 
  filter(sub_region_1 != "") |>
  rename(
    state_name = sub_region_1,
    grocery_pharm = grocery_and_pharmacy_percent_change_from_baseline,
    retail_recreation = retail_and_recreation_percent_change_from_baseline,
    park = parks_percent_change_from_baseline,
    transit = transit_stations_percent_change_from_baseline,
    workplace = workplaces_percent_change_from_baseline,
    residential = residential_percent_change_from_baseline,
  ) |>
  select(state_name, date, grocery_pharm, retail_recreation, park,
         transit, residential)

# Aggregate at state level
df_mob <- df_mob |> group_by(state_name, date) |>
  summarise(grocery_pharm = mean(grocery_pharm, na.rm = T),
            retail_recreation = mean(retail_recreation, na.rm = T),
            retail_recreation = mean(retail_recreation, na.rm = T),
            park = mean(park, na.rm = T),
            transit = mean(transit, na.rm = T),
            residential = mean(residential, na.rm = T))
```

#### Vaccination

```{r}
#---------- Testing, vaccination
# Data from Our World in Data
df_owid <- read_csv("Data/owid-covid-data.csv") |>
  filter(location == "United States")

df_owid <- df_owid |>
  select(date, reproduction_rate, new_tests_smoothed_per_thousand, tests_per_case,
         total_vaccinations_per_hundred, people_fully_vaccinated_per_hundred,
         stringency_index) |>
  rename(
    test_thousand = new_tests_smoothed_per_thousand,
    vacc_any = total_vaccinations_per_hundred,
    vacc_fully = people_fully_vaccinated_per_hundred,
  )
```

#### Testing policy

```{r}
#---------- Testing policy
# Data from Our World in Data
df_test_pol <- read_csv("Data/covid-19-testing-policy.csv") |>
  filter(Entity == "United States") |>
  select(Day, testing_policy) |>
  rename(date = Day)
```

#### Merging all data

```{r}
#---------- Merge all data
# setdiff(df_oc$state_name, df_mob$state_name)

df <- df_oc |> left_join(df_mob, by = c("state_name", "date")) |> 
  left_join(df_owid, by = "date") |> 
  left_join(df_test_pol, by = "date")

# Exclude Omicron variant
df <- df |>
  filter(date >= ymd("2020-02-15") & date < ymd("2021-12-01"))

# Replace missing values (testing, vaccine were not available)
df <- df |>
  mutate(
    test_thousand = ifelse(is.na(test_thousand), 0, test_thousand),
    tests_per_case = ifelse(is.na(tests_per_case), 0, tests_per_case),
    vacc_any = ifelse(is.na(vacc_any), 0, vacc_any),
    vacc_fully = ifelse(is.na(vacc_fully), 0, vacc_fully)
  )

dim(df)

head(df) |> knitr::kable()
```
:::

## Results {#sec-results}

## Conclusion

## References
