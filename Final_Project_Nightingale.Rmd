---
title: "BMIN503/EPID600 Project Template"
author: Kira Nightingale
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.
The goal of this project is to assess whether adult dietary habits have an impact on oral health, and further, whether this effect is at all moderated by self-reported oral hygiene habits. Data from NHANES years 2015-2016 and 2017-2018 will be analyzed, including the demographic survey, dental examination, dietary survey, and oral health questionnaire. For this project, I was advised by Dr. Joan Gluch (Penn Dental Medicine, community health), Dr. Kevin Lynch (Penn Medicine, biostatistics), and Jana Yablonski (Penn Dental Medicine, dental hygiene). The project can be found via this GitHub link: https://github.com/kira-nightingale/BMIN503_Final_Project 

### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

The 2017 Global Burden of Disease Study estimated that approximately 3.5 billion individuals worldwide suffer from oral conditions including carious lesions and periodontal disease, resulting in 18.3 millions years lived with disability globally (1). A study on the economic impact of oral diseases found that the direct and indirect costs associated with poor oral health result in global losses of around $442 billion in 2010. Notably, the estimated indirect costs amounted to $144 billion, a figure within the range of the indirect cost losses of the top ten global causes of death (ranging from $859 billion for cancer to $126 billion for lower respiratory infections) (2). As with all health conditions, prevention is far preferable to treatment. A 10-year follow-up on the 2007 WHO World Health Assembly resolution calling for a focus on oral health promotion and disease prevention (3) found that prevention programs were most frequently targeted at children, with few efforts aimed at improving the oral health of adolescents and adults (4).Therefore, determining how significant the role of diet is on oral health in adults could potentially provide an avenue for future adult-focused public health campaigns. However, given the difficulty many people face in making healthy changes to their diet, a multi-pronged approach to prevention strategies should be considered. Evidence that certain oral hygiene habits can either mitigate or enhance the effects of diet on oral health could provide yet another route to preventing poor oral health outcomes.

### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

First, the necessary libraries were loaded. Data from the 2015-2016 and 2017-2018 years were loaded, and the instruments were combined across years to increase the sample size.
```{r}

#Loading libraries
library(nhanesA) 
library(SASxport)
library(plyr)
library(dplyr)
library(ggplot2)
library(table1)
library(pscl)

#Loading data - 2015-2016 and 2017-2018
demog15 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.DEMO_I.XPT")
ohq15 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.OHQ_I.XPT")
exam15 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.OHXDEN_I.XPT")
#foodsd115 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.DR1IFF_I.XPT")
nutritiond115 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.DR1TOT_I.XPT")
nutritiond215 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/15-16.DR2TOT_I.XPT")

demog17 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.DEMO_J.XPT")
ohq17 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.OHQ_J.XPT")
exam17 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.OHXDEN_J.XPT")
#foodsd117 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.DR1IFF_J.XPT")
nutritiond117 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.DR1TOT_J.XPT")
nutritiond217 <- read.xport("C:/Users/nighki01/Box Sync/Course Materials/2021 Fall_Biomedical Informatics/BMIN503_Final_Project/Data/17-18.DR2TOT_J.XPT")

#Combining instruments across years
demog <- full_join(demog15, demog17)
ohq <- full_join(ohq15, ohq17)
#foodsd1 <- full_join(foodsd115, foodsd117)
nutritiond1 <- full_join(nutritiond115, nutritiond117)
nutritiond2 <- full_join(nutritiond215, nutritiond217)
nutrition <- full_join(nutritiond1, nutritiond2)


```

Next, the data was cleaned by computing new values, renaming variables, and removing unneeded variables. Individuals were assigned to age groups in 10 year increments.

```{r}

demog <- demog %>%
  select(SEQN, RIAGENDR, RIDAGEYR, RIDRETH3, DMDEDUC2, DMDEDUC3, DMDMARTL, INDHHIN2, INDFMPIR) %>%
  mutate(age.grp = ifelse(RIDAGEYR %in% 10:19, "10-19",
                    ifelse(RIDAGEYR %in% 20:29, "20-29",
                           ifelse(RIDAGEYR %in% 30:39, "30-39",
                                  ifelse(RIDAGEYR %in% 40:49, "40-49",
                                         ifelse(RIDAGEYR %in% 50:59, "50-59",
                                                ifelse(RIDAGEYR %in% 60:69, "60-69",
                                                       ifelse(RIDAGEYR %in% 70:79, "70-79",
                                                              ifelse(RIDAGEYR >79, "80+", "<10"))))))))) %>%
  rename(gender = RIAGENDR, race = RIDRETH3, child.edu = DMDEDUC3, adult.edu = DMDEDUC2, marital = DMDMARTL, income = INDHHIN2, poverty = INDFMPIR)


```  

The Decayed, Missing, Filled Tooth (DMFT) score is a commonly used indicator of tooth health used in dental research. In adults, all teeth except for third molars are assessed for caries, fillings, and missingness due to caries, and assigned a score of either 1 (presence of the aforementioned criteria) or 0 (sound, or missing due to other causes). The DMFT score is a summation of the 1 and 0 values for the full mouth. NHANES examiners assigned each tooth a letter value indicating its status. These letter values were re-coded to either 0 or 1 so that a DMFT score could be calculated for each participant. Root tips were not included as part of this calculation.

```{r}

#Dropping rows with incomplete exams
exam15 <- subset(exam15, OHDEXSTS!=3 & OHDEXSTS!=2)
exam17 <- subset(exam17, OHDEXSTS!=3 & OHDEXSTS!=2)

#Creating new variables with 0 or 1 values
for (i in 37:64) {
  newname <- paste0(names(exam15)[i], "new")
  exam15 <- mutate(exam15, !!newname := ifelse(!!as.name(names(exam15)[i]) %in% c("E", "F", "K", "P", "R", "Z", "A"), 1, 0))
}

for (i in 37:64) {
  newname <- paste0(names(exam17)[i], "new")
  exam17 <- mutate(exam17, !!newname := ifelse(!!as.name(names(exam17)[i]) %in% c("E", "F", "K", "P", "R", "Z", "A"), 1, 0))
}

#Calculating DMFT
exam15$dmft <- exam15 %>%
  select(171:198) %>%
  rowSums()

exam17$dmft <- exam17 %>%
  select(171:198) %>%
  rowSums()

#Selecting necessary variables and joining the datasets for the 2 years
exam15 <- select(exam15, SEQN, dmft)
exam17 <- select(exam17, SEQN, dmft)
exam <- full_join(exam15, exam17)

```

Nutrition data was obtained by NHANES through participant interviews. Participants were asked to report all foods eaten over a period of one or two days. Using an FDA database, NHANES personnel itemized comprehensive nutrition information for all foods eaten. For this project, the total values for relevant nutrients were used. First, participants with incomplete or not done nutrition profiles were removed. Then, the average quantity of nutrients was calculated for each participant. Finally, the amount of each nutrient consumed was compared to the recommend daily values based on age and gender, and the applicable percentage was calculated.
```{r}
#Removing participants with incomplete/not done nutrition profiles, and merging nutrition data with demographic information
data <-  full_join(demog, nutrition, by = "SEQN")
data <- subset(data, age.grp!="<10" & age.grp!="10-19")

data <- data %>%
  subset(DR1DRSTZ == 1 | DR2DRSTZ == 1) %>%
  select(SEQN, DRDINT, DR1TNUMF, DR2TNUMF, DR1TKCAL, DR1TPROT, DR1TCARB, DR1TSUGR, DR1TFIBE, DR1TTFAT, DR1TSFAT, DR1TCHOL, DR1TATOC, DR1TVARA, DR1TVB1, DR1TVB2, DR1TVB6, DR1TVB12, DR1TVC, DR1TVD, DR1TVK, DR1TCALC, DR1TIRON, DR1.300, DR1.320Z, DR2TKCAL, DR2TPROT, DR2TCARB, DR2TSUGR, DR2TFIBE, DR2TTFAT, DR2TSFAT, DR2TCHOL, DR2TATOC, DR2TVARA, DR2TVB1, DR2TVB2, DR2TVB6, DR2TVB12, DR2TVC, DR2TVD, DR2TVK, DR2TCALC, DR2TIRON, DR2.300, DR2.320Z, gender, race, child.edu, adult.edu, marital, income, poverty, age.grp)



#Averaging nutrient intake per participant
data$calories <- rowMeans(subset(data, select = c(DR1TKCAL, DR2TKCAL)), na.rm = TRUE)
data$protein <- rowMeans(subset(data, select = c(DR1TPROT, DR2TPROT)), na.rm = TRUE)
data$carbs <- rowMeans(subset(data, select = c(DR1TCARB, DR2TCARB)), na.rm = TRUE)
data$sugar <- rowMeans(subset(data, select = c(DR1TSUGR, DR2TSUGR)), na.rm = TRUE)
data$fiber <- rowMeans(subset(data, select = c(DR1TFIBE, DR2TFIBE)), na.rm = TRUE)
data$fat <- rowMeans(subset(data, select = c(DR1TTFAT, DR2TTFAT)), na.rm = TRUE)
data$satfat <- rowMeans(subset(data, select = c(DR1TSFAT, DR2TSFAT)), na.rm = TRUE)
data$cholesterol <- rowMeans(subset(data, select = c(DR1TCHOL, DR2TCHOL)), na.rm = TRUE)
data$vit.e <- rowMeans(subset(data, select = c(DR1TATOC, DR2TATOC)), na.rm = TRUE)
data$vit.a <- rowMeans(subset(data, select = c(DR1TVARA, DR2TVARA)), na.rm = TRUE)
data$vit.b1 <- rowMeans(subset(data, select = c(DR1TVB1, DR2TVB1)), na.rm = TRUE)
data$vit.b2 <- rowMeans(subset(data, select = c(DR1TVB2, DR2TVB2)), na.rm = TRUE)
data$vit.b6 <- rowMeans(subset(data, select = c(DR1TVB6, DR2TVB6)), na.rm = TRUE)
data$vit.b12 <- rowMeans(subset(data, select = c(DR1TVB12, DR2TVB12)), na.rm = TRUE)
data$vit.c <- rowMeans(subset(data, select = c(DR1TVC, DR2TVC)), na.rm = TRUE)
data$vit.d <- rowMeans(subset(data, select = c(DR1TVD, DR2TVD)), na.rm = TRUE)
data$vit.k <- rowMeans(subset(data, select = c(DR1TVK, DR2TVK)), na.rm = TRUE)
data$calcium <- rowMeans(subset(data, select = c(DR1TCALC, DR2TCALC)), na.rm = TRUE)
data$iron <- rowMeans(subset(data, select = c(DR1TIRON, DR2TIRON)), na.rm = TRUE)
data$water <- rowMeans(subset(data, select = c(DR1.320Z, DR2.320Z)), na.rm = TRUE)

data <- data %>%
  select(SEQN, DRDINT, DR1TNUMF, DR2TNUMF, DR1.300, DR2.300, calories, protein, carbs, sugar, fiber, fat, satfat, cholesterol, vit.e, vit.a, vit.b1, vit.b2, vit.b6, vit.b12, vit.c, vit.d, vit.k, calcium, iron, water, gender, race, child.edu, adult.edu, marital, income, poverty, age.grp)

#Calculating percent daily values based on age and gender
data <- data %>%
  mutate(p.calories = if_else(gender==1 & age.grp=="20-29", (calories/2400)*100, 
                             if_else(gender==2 & age.grp=="20-29", (calories/2000)*100,
                                    if_else(gender==1 & age.grp=="30-39" | age.grp=="40-49", (calories/2200)*100,
                                           if_else(gender==2 & age.grp=="30-39" | age.grp=="40-49", (calories/1800)*100, 
                                                  if_else(gender==1 & age.grp=="50-59" | age.grp=="60-69" | age.grp=="70-79" | age.grp=="80+", (calories/2000)*100, (calories/1600)*100)))))) %>%
  mutate(p.protein = if_else(gender==1, (protein/56)*100, (protein/56)*100)) %>%
  mutate(p.carbs = (carbs/130)*100) %>%
  mutate(p.sugar = ((sugar/calories)/0.1)*100) %>%
  mutate(p.fiber = if_else(gender==1 & age.grp=="20-29", (fiber/34)*100, 
                             if_else(gender==2 & age.grp=="20-29", (fiber/28)*100,
                                    if_else(gender==1 & age.grp=="30-39" | age.grp=="40-49", (fiber/31)*100,
                                           if_else(gender==2 & age.grp=="30-39" | age.grp=="40-49", (fiber/25)*100, 
                                                  if_else(gender==1 & age.grp=="50-59" | age.grp=="60-69" | age.grp=="70-79" | age.grp=="80+", (fiber/28)*100, (fiber/22)*100)))))) %>%
  mutate(p.fat = (fat/35)*100) %>%
  mutate(p.satfat = ((satfat/calories)/0.1)*100) %>%
  mutate(p.vit.e = (vit.e/15)*100) %>%
  mutate(p.vit.a = if_else(gender==1, (vit.a/900)*100, (vit.a/700)*100)) %>%
  mutate(p.vit.b6 = if_else(gender==1 & age.grp=="50-59" | age.grp=="60-69" | age.grp=="70-79" | age.grp=="80+", (vit.b6/1.7)*100,
                            if_else(gender==2 & age.grp=="50-59" | age.grp=="60-69" | age.grp=="70-79" | age.grp=="80+", (vit.b6/1.5)*100, (vit.b6/1.3)*100))) %>%
  mutate(p.vit.b12 = (vit.b12/2.4)*100) %>%
  mutate(p.vit.c = if_else(gender==1, (vit.c/90)*100, (vit.c/75)*100)) %>%
  mutate(p.vit.d = if_else(age.grp=="70-79" | age.grp=="80+", (vit.d/800)*100, (vit.d/600)*100)) %>%
  mutate(p.vit.k = if_else(gender==1, (vit.k/120)*100, (vit.k/90)*100)) %>%
  mutate(p.calcium = if_else(gender==1 & age.grp=="70-79" | age.grp=="80+", (calcium/1200)*100,
                             if_else(gender==2 & age.grp=="50-59" | age.grp=="60-69" | age.grp=="70-79" | age.grp=="80+", (calcium/1200)*100, (calcium/1000)*100))) %>%
  mutate(p.iron = if_else(gender==2 & age.grp=="20-29" | age.grp=="30-39" | age.grp=="40-49", (iron/18)*100, (iron/8)*100))

data$age.grp <- as.factor(data$age.grp)

```

#NEED TO WORK ON ORAL HEALTH QUESTIONNAIRE
```{r}

```


```{r eval=FALSE}
#SAVING THIS STUFF FOR LATER JUST IN CASE
#This one works
exam15$OHX02CTC <- as.character(exam15$OHX02CTC)
exam15$OHX02CTC <- factor(exam15$OHX02CTC, levels = c("A", "D", "M", "Q", "S", "U", "X", "Y", "E", "F", "J", "K", "P", "R", "T", "Z"), labels = c(0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1)) 

#Create new columns for variables %in% c("A", "B", ...) numeric

exam15<- mutate(exam15, ohx02 = function(x) {if (x %in% c("M", "Q", "S")){1} else {0}})
exam15<- mutate(exam15, ohx02 = ifelse(OHX02CTC %in% c("A", "D", "M", "Q", "S", "U", "X", "Y"), 1, 0))

for (i in 37:64) {
  print(i)
  newname <- paste0(names(exam15)[i], "new")
  print(newname)
  print(names(exam15)[i])
  exam15 <- mutate(exam15, !!newname := ifelse(!!as.name(names(exam15)[i]) %in% c("E", "F", "K", "P", "R", "Z", "A"), 1, 0))
}
```

Finally, all remaining data files were combined into a single data frame, and cases that included nutrition data, DMFT score, and the oral health questionnaire results were included in the final data set.
```{r}
#Merging data into a single data frame
data <-  join_all(list(data, exam, ohq), by = "SEQN", type = "full")
data <- data[!is.na(data$calories), ]
data <- data[!is.na(data$dmft), ]

```

Analysis
```{r}
#Labeling factor data and variable names
data$gender <- factor(data$gender, levels=c(1, 2), labels=c("Male", "Female"))
data$race <- factor(data$race, levels=c(3, 4, 6, 1, 2, 7), labels=c("White, Non-Hispanic", "Black, Non-Hispanic", "Asian, Non-Hispanic", "Mexican American", "Other Hispanic", "Other/Multi-Race"))
data$adult.edu <- factor(data$adult.edu, levels=c(1, 2, 3, 4, 5, 7, 9), labels=c("Less than 9th grade", "Some highschool", "Highschool/GED or equivalent", "Some college/Associates degree", "College graduate or above", "Refused", "Don't know"))
data$marital <- factor(data$marital, levels=c(1, 2, 3, 4, 5, 6, 77), labels=c("Married", "Widowed", "Divorced", "Separated", "Never married", "Living with partner", "Refused"))

label(data$age.grp) <- "Age Group"
label(data$gender) <- "Sex"
label(data$race) <- "Race"
label(data$adult.edu) <- "Education Level"
label(data$marital) <- "Marital Status"

#Creating a function to show mean (SD) for continuous variables in the table
my.render.cont <- function(x) {
    with(stats.apply.rounding(stats.default(x), digits=3), c("",
        "Mean (SD)"=sprintf("%s (&plusmn; %s)", MEAN, SD)))
}

#Generating Table 1
table1(~gender + race + adult.edu + poverty | age.grp, data=data, overall="Total", render.continuous=my.render.cont)


```

Histogram of DMFT score
```{r}
ggplot(data=exam, aes(dmft)) +
  geom_bar()
```


To assess whether DMFT score is associated with diet, a zero inflated negative binomial regression was performed. This regression model was chosen because the mean DMFT score (11.32) was much lower than the variance of the DMFT score (65.15), and the data included more zeros than expected by the model.
```{r}

model1 <- zeroinfl(dmft ~ p.sugar + age.grp + p.fat + p.calcium + adult.edu, data = data, dist = "negbin")
summary(model1)

```


### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

### References
  
    1. Bernabe E, Marcenes W, Hernandez CR, et al. Global, Regional, and National Levels and Trends in Burden of Oral Conditions from 1990 to 2017: A Systematic Analysis for the Global Burden of Disease 2017 Study. Journal of Dental Research. 2020;99(4):362-373. doi:10.1177/0022034520908533
    2. Listl S, Galloway J, Mossey PA, Marcenes W. Global Economic Impact of Dental Diseases. Journal of Dental Research. 2015;94(10):1355-1361. doi:10.1177/0022034515602879
    3. World Health Organization. World Health Assembly First Special Session: Sixtiety World Health Assembly. 2007. Retrieved from https://apps.who.int/gb/ebwha/pdf_files/WHASSA_WHA60-Rec1/E/WHASS1_WHA60REC1-en.pdf.
    4. Petersen, PE, Baez, RJ, Ogawa, H. Global application of oral disease prevention and health promotion as measured 10 years after the 2007 World Health Assembly statement on oral health. Community Dent Oral Epidemiol. 2020; 48: 338– 348. https://doi-org.proxy.library.upenn.edu/10.1111/cdoe.12538
    
   COMPLETE THIS CITATION!! Nutrient information https://ods.od.nih.gov/HealthInformation/Dietary_Reference_Intakes.aspx
  

