---
title: "determinants of liver fibrosis"
subtitle: "BMIN503/EPID600 Final Project"
author: "Samiran Mukherjee"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers. Feel free to change the theme and other display settings, although this is not required.

## Overview {#sec-overview}

Using NHANES data, we aim to predict the determinants of liver fibrosis (using the publically available fibroscan data). In addition, we will also learn to train a machine learning model to identify variables that can best predict the occurence of fibrosis. .

## Introduction {#sec-introduction}

Non-alcoholic fatty liver disease (NAFLD)  is prevalent in 30% of the US population. It is strongly associated with the presence of co-morbid metabolic risk factors like obesity, type 2 DM, hypertension and hyperlipidemia. Given that 1% patients will end up developing liver cirrhosis (fibroscan liver stiffness cut off \>14.6), it is imperative to identify preventable independent variables that may influence the occurence of the same. 

## Methods {#sec-methods}

We will be using NHANES data to assess the determinants of advanced fibrosis from the link https://wwwn.cdc.gov/nchs/nhanes/continuousnhanes/default.aspx?Cycle=2017-2020

From the multiple data sets availabe from 2017-2020, we will be using the following files for the following: 1) demo_data; Demographic data 2) hepq_data; Hepatitis questionnaire data 3) lab_data; Lab data 4) dmq_data; dmq (diabetes questionnaire) data 5) a1c_data; a1c (diabetes lab) data 6) hepb_data; hepatitis b data 7) hepc_data; Hepatitis c data 8) fibroscan_data; Fibroscan (firbous elastography) data 9) insurance_data; insurance data 10)alcohol_data; Alcohol data

The study plan will comprise of

1\) Identifying cases and controls using the fibroscan data

2\) Use logistic regression models to identify variables that are associated with cases

3\) Using parnsip to pass logistic regression through an engine to create a supervised machine learning model to predict the occurence of cirrhosis

4\) Plotting AUC curves for the same

6\) Next, we will use tSNE and PCA to identify possible clustering in an unsupervised approach

Install packages

```{r}
#install.packages("modelsummary")
#install.packages("ggplot2")
#install.packages("dplyr")
#install.packages("haven")
```

Load packages

```{r}
library(tidyverse)
library(modelsummary)
library(dplyr)
library(broom)
library(ggplot2)
library(dplyr)
library(haven) #required to read XPT files
```

```{r}
##read XPT files
demo_data <- read_xpt("P_DEMO.XPT") |> data.frame("P_DEMO.XPT")
hepq_data <- read_xpt("P_HEQ.XPT") |> data.frame("P_HEQ.XPT")
lab_data <- read_xpt("P_BIOPRO.XPT") |> data.frame("P_BIOPRO.XPT")
dmq_data <- read_xpt("P_DIQ.XPT") |> data.frame("P_DIQ.XPT") 
a1c_data <- read_xpt("P_GHB.XPT") |> data.frame("P_GHB.XPT")
hepb_data <- read_xpt("P_HEPBD.XPT") |> data.frame("P_HEPBD.XPT")
hepc_data <- read_xpt("P_HEPC.XPT") |> data.frame("P_HEPC.XPT")
fibroscan_data <- read_xpt("P_LUX.XPT") |> data.frame("P_LUX.XPT")
insurance_data <- read_xpt("P_HIQ.XPT") |> data.frame("P_HIQ.XPT")
alcohol_data <-  read_xpt("P_ALQ.XPT") |> data.frame("P_ALQ.XPT")

#Merge each of the tables to create one master data sheet. This has to happen step-wise
merged_df <- merge(demo_data, hepq_data, by = "SEQN")
merged_df <- merge(merged_df, hepb_data, by = "SEQN")
merged_df <- merge(merged_df, hepc_data, by = "SEQN")
merged_df <- merge(merged_df, lab_data, by = "SEQN")
merged_df <- merge(merged_df, dmq_data, by = "SEQN")
merged_df <- merge(merged_df, a1c_data, by = "SEQN")
merged_df <- merge(merged_df, fibroscan_data, by = "SEQN")
merged_df <- merge(merged_df, insurance_data, by = "SEQN")
merged_df <- merge(merged_df, alcohol_data, by = "SEQN")

```

Now to modify each of the variables names of interest accordingly

```{r}
#Alcohol 
merged_df$etoh <- merged_df$ALQ151 #1->Y, 2-> No, 7-> refused, 9-> ?, .-> Missing

#biomarkers (continuous variables)
merged_df$alt <- merged_df$LBXSATSI #Values .-> Missing
merged_df$alb <- merged_df$LBXSAL 
merged_df$alp <- merged_df$LBXSAPSI
merged_df$ast <- merged_df$LBXSASSI 
merged_df$urea <- merged_df$LBXSBU
merged_df$cr <- merged_df$LBXSCR
merged_df$ggt <- merged_df$LBXSGTSI
merged_df$ldh <- merged_df$LBXSLDSI
merged_df$na <- merged_df$LBXSNASI
merged_df$tbil <- merged_df$LBXSTB
merged_df$chol <- merged_df$LBXSCH
merged_df$tg <- merged_df$LBXSTR

#HepQ data

#HepB data

#HepC data

#A1c data

#fibroscan data

#Insurance data 

#Demographic data 

```

```{r}





```

```{r}





```

```{r}





```

```{r}





```

```{r}





```

```{r}





```

```{r}





```

## Results {#sec-results}

Describe your results and include relevant tables, plots, and code/comments used to obtain them. You may refer to the @sec-methods as needed. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

## Conclusion

This the conclusion. The @sec-results can be invoked if you'd like.
