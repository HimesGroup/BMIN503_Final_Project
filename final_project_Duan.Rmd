---
title: "BMIN503/EPID600 Project Template"
author: "Your Name"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers.
>This is the new template

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

Goal: 1. Use statisitcal and mathematical methods to analyze the COVID-19 spreading pattern in the past one year. 2. Use machine learning methods to make resonable prediction of COVID-19 spreading in the future one year.


### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Coronavirus disease (COVID-19) is an infectious disease caused by the SARS-CoV-2 virus. Most people infected with the virus will experience mild to moderate respiratory illness and recover without requiring special treatment. However, some will become seriously ill and require medical attention. Older people and those with underlying medical conditions like cardiovascular disease, diabetes, chronic respiratory disease, or cancer are more likely to develop serious illness. Anyone can get sick with COVID-19 and become seriously ill or die at any age. The COVID-19 pandemic is a formidable global public health challenge. Since the initial emergence of a novel coronavirus in late 2019, the spread of SARS-CoV-2 has been unrelenting, impacting nearly every aspect of society worldwide. The pandemic has required a substantial response by public health authorities at all levels. Predicting the trend of COVID-19 is a possible method to prevent the new spreading of COVID-19 pandemic. Analysis the pattern of COVID-19 in the past two years in the U.S. could help make the prediction of COVID-19 in the future. 

In United States of America, from 3 January 2020 to 5 November 2021, there have been 45,968,940 confirmed cases of COVID-19 with 744,398 deaths. Different statistical methods will be used in this project to analyze the spreading situation of COVID-19 in the U.S. Machine learning methods will also be included in this project to make the reasonable prediction of COVID-19 spreading situation in the future one year. Mathematical methods and coding will be used for this project.


### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 
```{r, eval = TRUE}
install.packages("covid19.analytics")
```

```{r, eval = TRUE}
library("covid19.analytics")
library("dplyr")
```

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

```{r, eval = TRUE}
# get the data of confirmed cases globally from dataset
covid19.confirmed.cases <- covid19.data('ts-confirmed')
covid19.confirmed.cases_us <- covid19.confirmed.cases %>% 
  filter(Country.Region == "US")

covid19.confirmed.cases_us
# show the trend of increasing number of confirmed cases
tots.per.location(covid19.confirmed.cases_us)
```


```{r, eval = TRUE}
# get the growth rate of cases in the US.(Total growth )
TS.data <- covid19.data("ts-confirmed")
growth.rate(TS.data, geo.loc="US")
```


```{r, eval = TRUE}

# get the growth rate of cases in the US.(comparing different regions in the US)
TSconfirmed.data <- covid19.data("ts-confirmed")
state = c("PENNSYLVANIA")
growth.rate(TSconfirmed.data, geo.loc=c("US","CHINA"))
```



```{r, eval = TRUE}
# get the COVID19 testing data
c19.testing.data <- covid19.testing.data()
head(c19.testing.data)
```

```{r, eval = TRUE}
# get the COVID19 vaccination data
c19.vacc.data <- covid19.vaccination()
head(c19.vacc.data)
```

```{r, eval = TRUE}
tots.per.location(covid19.confirmed.cases, geo.loc="US")
```


```{r, eval = TRUE}
# install the covid19 package in R
install.packages("COVID19")
```

```{r, eval = TRUE}
# get the library of covid19 data
library("COVID19")
```

```{r, eval = TRUE}
# get the covid19 data by US and for each state
covid19.us.state <- covid19(c("US"),level=3)
covid19.us.state

# get the date; confirmed cases and state column from the dataframe
covid19.confirmed.death <- covid19.us.state[, c("date","confirmed","deaths","administrative_area_level_2")]
# sort data
covid19.confirmed.death <- covid19.confirmed.death %>%
  arrange(administrative_area_level_2) %>%
  rename(state=administrative_area_level_2)
head(covid19.confirmed.death)
```

```{r, eval = TRUE}
library(ggplot2)

# list of all State names
state.list <- state.name
# create a list which contain the data which show the highest number of confirmed cases in a day 
highest.confirmed.oneDay <- c()

# get the highest confirmed cases in each state
for(name in state)
{
  # get the confirmed cases data by each state
  confirmed.cases.state <- covid19.confirmed.death %>% filter(state == name)
  # get highest number of the cases
  highest.number.case <- max(confirmed.cases.state$confirmed)
  # add the number in to the list
  highest.confirmed.oneDay <- c(highest.confirmed.oneDay, highest.number.case)
}
  

```

```{r, eval = TRUE}
library(sf)
library(RColorBrewer)

# create a new dataset which only contains the confirmed case and state
confirmed.cases.by.state <- data.frame(state.list, highest.confirmed.oneDay)
head(confirmed.cases.by.state)

max_confirmed <- max(confirmed.cases.by.state$highest.confirmed.oneDay)
min_confirmed <- min(confirmed.cases.by.state$highest.confirmed.oneDay)

my_theme <- function() {
  theme_minimal() +                                  
  theme(axis.line = element_blank(),                 
        axis.text = element_blank(),                 
        axis.title = element_blank(),
        panel.grid = element_line(color = "white"),  
        legend.key.size = unit(0.8, "cm"),          
        legend.text = element_text(size = 16),       
        legend.title = element_text(size = 16),
        plot.title = element_text(size = 22))      
}

myPalette <- colorRampPalette(brewer.pal(9, "YlOrRd"))

ggplot() +
  geom_sf(data = confirmed.cases.by.state, aes(fill=highest.confirmed.oneDay),lwd = 0) +
  my_theme() +
  ggtitle("the confirmed cases in a day") +
  scale_fill_gradientn(name = "confirmed cases", colours = myPalette(100),
                      limit = range(min_confirmed, max_confirmed)) 
```