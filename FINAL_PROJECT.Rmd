---
title: "Your Document Title"
author: "Document Author"
date: "`r Sys.Date()`"
---

# Final Project (In progress)

> **Overview:**
>
> > This project aims to study the impact of the COVID-19 pandemic on solid organ transplantation in the United States using UNOS OPTN data.

> **Introduction:**
>
> > The SARS-CoV-2 (COVID-19) pandemic has significantly impacted solid organ transplant programs across the United States. At the height of the pandemic, transplant centers adjusted guidelines for donor selection, management of patients with a positive COVID-19 diagnosis, and prevention of transmission of COVID-19 to transplant recipients and healthcare workers. The COVID-19 pandemic gave rise to a new subset of patients being referred for lung transplantation as well. The aim of this project is to understand the impact of the COVID-19 pandemic on the lung transplantation program using publically available UNOS OPTN data and local COVID-19 incidence rates.
>
> > Lung transplantation involves multiple disciplines that include the coordination of multiple disciplines including transplant pulmonology, cardiothoracic surgery, critical care medicine, nursing, respiratory therapy and organ procurement teams among many others teams that closely coordinate to make transplants a success. Data from the effects of COVID-19 pandemic and understanding its impact will help us better prepare for future pandemics.
>
> > To compare the effect of the pandemic more accurately, we would also need to consider if there are seasonal variations of the number of transplants even pre COVID-19 pandemic. A geospatial depiction of the effect of COVID-19 would be considered as well.

> Methods and Results: \> Data source:

UNOS OPTN database

De-identified data request was submitted to UNOS.

Data was received in the SAS format

Project Question: Impact of COVID-19 on Organ Transplant Organs:

> Decrease in transplantation during COVID-19?

> Increase in mortality in patients on waitlist?

> Corelated with surges in selected states? - NY, NJ, PA?

## Transplant Categories:

1)  Lung
2)  Heart
3)  Kidney
4)  Pancreas
5)  Liver

## Thoracic Data

```{r eval = TRUE}
library(haven)
thoracic_data <- read_sas("/Users/work/Downloads/SAS Dataset 202209/Thoracic/thoracic_data.sas7bdat")
```

```{r eval = TRUE}
library(gtsummary)
library(tidyverse)
library(dplyr)
library(ggplot2)

head(thoracic_data)
dim(thoracic_data)

thoracic_data_subset_all <- thoracic_data %>% 
  dplyr::select(WL_ID_CODE, TXED, WL_ORG, DAYSWAIT_CHRON, ACTIVATE_DATE, TX_DATE, GENDER, PERM_STATE, TXLNG, TX_YEAR, DIAG) %>% dplyr::mutate(TXED = (factor(TXED, levels = c(0, 1), labels = c("no", "yes"))), GENDER = factor(GENDER), PERM_STATE = factor(PERM_STATE))
thoracic_data_subset_all

thoracic_data_subset_all %>%
  filter(WL_ORG == "LU" & TXED == "yes")


thoracic_data_subset_lung <- thoracic_data %>% 
  dplyr::select(WL_ID_CODE, TXED, WL_ORG, DAYSWAIT_CHRON, ACTIVATE_DATE, TX_DATE, GENDER, PERM_STATE, TXLNG, TX_YEAR, DIAG, TCR_DGN) %>% dplyr::mutate(TXED = (factor(TXED, levels = c(0, 1), labels = c("no", "yes"))), GENDER = factor(GENDER), PERM_STATE = factor(PERM_STATE)) %>% dplyr::filter(TX_DATE >= "2015-01-01") %>% dplyr::filter(WL_ORG == "LU")
thoracic_data_subset_lung

thoracic_data_subset_lung %>% dplyr::select(TXED, DAYSWAIT_CHRON, GENDER, ACTIVATE_DATE, TX_DATE, PERM_STATE) %>%
  tbl_summary(by = TXED) %>% add_p() %>% add_overall()

ggplot(thoracic_data_subset_lung, aes(TX_DATE, fill = TXED)) + 
      geom_histogram(binwidth = 30)

lungtx2015 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2015-01-01" & TX_DATE < "2015-12-31") %>% count(TX_DATE)
lungtx2015 <- summarise(lungtx2015, sum(n))
lungtx2015

lungtx2016 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2016-01-01" & TX_DATE < "2016-12-31") %>% count(TX_DATE)
lungtx2015 <- summarise(lungtx2016, sum(n))
lungtx2016

lungtx2017 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2017-01-01" & TX_DATE < "2017-12-31") %>% count(TX_DATE)
lungtx2017 <- summarise(lungtx2017, sum(n))
lungtx2017

lungtx2018 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2018-01-01" & TX_DATE < "2018-12-31") %>% count(TX_DATE)
lungtx2018 <- summarise(lungtx2018, sum(n))
lungtx2018

lungtx2019 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2019-01-01" & TX_DATE < "2019-12-31") %>% count(TX_DATE)
lungtx2019 <- summarise(lungtx2019, sum(n))
lungtx2019

lungtx2020 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2020-01-01" & TX_DATE < "2020-12-31") %>% count(TX_DATE)
lungtx2020 <- summarise(lungtx2020, sum(n))
lungtx2020

lungtx2021 <- thoracic_data_subset_lung %>%
  dplyr::filter(TX_DATE >= "2021-01-01" & TX_DATE < "2021-12-31") %>% count(TX_DATE)
lungtx2021 <- summarise(lungtx2021, sum(n))
lungtx2021
```

```{r eval = TRUE}
lungtx <- thoracic_data_subset_lung %>%
  filter(TXED == 'yes') %>%
  group_by(TX_DATE) %>%
  count(TX_DATE)
lungtx

library(CausalImpact)

lungtx <- lungtx

time.points <- seq.Date(as.Date("2015-01-05"), by=1, length.out=2803)
number <- ts(lungtx$n)
data <- zoo(number, time.points)
pre.period=as.Date(c("2018-01-05", "2020-03-31"))
post.period=as.Date(c("2020-04-01", "2022-09-01"))
impact <- CausalImpact(data, pre.period, post.period)
plot(impact)
```

```{r eval = TRUE}
library(ggplot2)
library(ggpubr)
library(plotly)

require(ggplot2)
ggplot(A, aes(Dates, GasDiff)) + geom_line( aes(colour = Year))

```
