---
title: "response to treatment and risk-of-recurrence in patients with stage 2 or 3 breast cancer receiving neoadjuvant chemotherapy (NACT)"
author: "Yuxi (Clara) Dong"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation in class will be based on the contents of this document. Replace the title/name and text below with your own, but leave the headers.
ok

### Overview

Neoadjuvant chemotherapy for breast cancer provides critical information about tumor response. The I-SPY1 TRIAL (Investigation of Serial Studies to Predict Your Therapeutic Response With Imaging and Molecular Analysis) integrated clinical and imaging data to evaluate and predict pathologic complete response(PCR) and recurrence-free survival(RFS) based on MRI imaging, and the data from I-SPY1 TRIAL consists of image data, clinical and outcome data for locally advanced breast cancer patients. My ultimate goal is to use these data to find the relationship and predictability of PCR and RFS based on tumor biomarkers, patients characteristics and recptor status, as well as evaluate the ability of MRI for prediction of response to neoadjuvant chemotherapy. 

### Introduction 

Neoadjuvant chemotherapy is a common treatment that used to treat woman with invasive breast cancer, and it has shown to reduce the risk of recurrence after surgery and siginificant overall survival outcomes. There is a positive association between change of primary tumor size in response to chemotheray and overall survival, therefore, the size change of primary tumor can be regarded as a biomarker for breast cancer. Thus, monitoring tumor response can provide prediction of PCR and RFS to neoadjuvant chemotherapy. Current clinical assessment of tumor response to radiation or chemotherapy and therapeutic efficacy can be obtained from magnetic resonance imaging (MRI) with the indication of changes in tumor morphology resulted from the molecular changes to tumor tissue. 
The purpose of this project is to find the relationship of PCR and RFS based on patient clinical information and tumor biomarkers assessed by MRI. 

To address this problem, multidisciplinary approach is required. Understanding pathophysiology of breast cancer will be helpful to interpret clinical assessments of tumor response to neoadjuvant chemotherapy, as well as histopathologic analysis of surgical specimens. Having knowledge in MR imaging technique as well as knowledge in MR image data assessment is also necessary to understand image data of tumor response to chemotherapy. Finally, statistics will serve as a key input for the overall study to not only show the data graphically, but also explore data among important issues, and make correctly and properly inference. Thus, the probelm addressed in this project is interdisciplinary.




### Methods

The data sets I utilized in this project were obtained from [Cancer Imaging Archive](https://wiki.cancerimagingarchive.net/display/Public/ISPY1#0eadffee2ba44b479e4ed5f7a6311f33), which is a database of various cancer images and related clinical trial data. Specifically, the data set I analyzed are part of the ACRIN 6657 trial in I-SPY1 TRIAL (Investigation of Serial Studies to Predict Your Therapeutic Response With Imaging and Molecular Analysis). The dataset is consists of two part - patient clinical data and treatment outcome data. I will do several analysis on this two data and investigate several relationships and predictbilities of PCR and RFS based on patient characteristics, clinical information and tumor biomarkers.

```{r, eval=TRUE}
library(readxl)
setwd("/Users/claradong/Documents/GitHub/BMIN503_Final_Project")
df_clinical = read_xlsx("Final_project_data.xlsx", sheet = 2)
df_outcome = read_xlsx("Final_project_data.xlsx", sheet = 4)
```
Summary views of the raw patients clinical data were reviewed. 
```{r, eval=TRUE}
str(df_clinical)
```
Summary views of the raw treatment outcome data were reviewed.
```{r, eval=TRUE}
str(df_outcome)
```

However, lots of information in raw data are not related to this project. Two datasets are therefore cleaned for better utilization.
```{r, eval=TRUE}
library(tidyverse)
```

```{r, eval=TRUE}
clinical <- df_clinical %>%
  select(SUBJECTID,age,race_id,ERpos,PgRpos,'HR Pos','Her2MostPos','HR_HER2_CATEGORY', BilateralCa,Laterality,'MRI LD Baseline','MRI LD 1-3dAC', 'MRI LD InterReg','MRI LD PreSurg') %>%
  mutate(race_id = factor(race_id, levels=c(1,3,4,5,6,50), labels=c("Caucasian", "Afican American", "Asian", "Native Hawaiian/Pacific Islander", "American Indian/Alaskan Native", "Multiple race"))) %>%
  mutate(ERpos = factor(ERpos, levels=c(0,1,2), labels=c("Negative","Positive","Inderminate"))) %>%
  mutate(PgRpos = factor(PgRpos,levels=c(0,1,2), labels=c("Negative","Positive","Inderminate"))) %>% 
  mutate('HR Pos' = factor(`HR Pos`,levels=c(0,1,2), labels=c("Negative","Positive","Inderminate"))) %>%
  mutate('Her2MostPos' = factor(`Her2MostPos`, levels=c(0,1), labels=c('Negative','Positive'))) %>%
  mutate('HR_HER2_CATEGORY' = factor(`HR_HER2_CATEGORY`, levels=c(1,2,3), labels=c('HR Positive, Her2 Negative', 'Her2 Positive', 'Triple Negative'))) %>%
  mutate(BilateralCa = factor(BilateralCa, levels=c(0,1), labels=c("No","Yes"))) %>%
  mutate(Laterality = factor(Laterality, levels=c(1,2), labels=c("Left", "Right")))
str(clinical)

outcome <- df_outcome %>%
  rename(survival.status = sstat) %>%
  mutate(survival.status = factor(survival.status, levels=c(7,8,9), labels=c("Alive", "Dead","Lost"))) %>%
  mutate(PCR = factor(PCR, levels=c(0,1), labels=c("No","Yes"))) %>%
  mutate(RCBClass = factor(RCBClass, levels=c(0,1,2,3), labels=c("0,RCB index 0", "1=I,RCB index less than or equal to 1.36", "2=II,RCB index greater than 1.36 or equal to 3.28", "3=III,RCB index greater than 3.28")))
```

To investigating the relationship between recptor status and PCR, RCF, I will select related columns from two clinical and outcome dataset and merge them together to facilitate furthur use. 
```{r, eval=TRUE}
total <- merge(clinical, outcome) %>%
  select("SUBJECTID", "age","ERpos", "PgRpos", "HR Pos", "Her2MostPos", "HR_HER2_CATEGORY","BilateralCa", "Laterality","survival.status", "survDtD2 (tx)", "RFS", "PCR") %>%
  rename(HR_status = 'HR Pos')
str(total)
```
To get an overall information of patients enrolled in this clinical trial, summray of patients characteristics is reviewed.
```{r, eval=TRUE}
library(ggplot2)
ggplot(data=clinical, aes(x=age)) +
  geom_histogram(binwidth = 3)
ggplot(data=clinical, aes(x=race_id)) +
  geom_bar()
```

### Results

Since I want to look at the relationship between MRI imaging data and PCR as well as RFS, I will first visualize the tumor size change from the MRI imaging data. Worth to mention here, baseline is the first MRI image patient got before getting neoadjuvant chemotherapy (NACT), t1 is the second examination after one cycle of anthracyline-based treatment, t3 is the third examination between the anthracycline-based regimen and taxane, and t4 is the fourth examination  after all chemotherapy and prior to surgery. The MR imaging assessment included the measurements of tumor longest diameter, which has a direct indication of tumor size change. From the boxplot below, we can see after the NACT treatment, the overall tumor size decrease over time. 

```{r, eval=TRUE}
tumor.df <- clinical %>%
  select(SUBJECTID, `MRI LD Baseline`,`MRI LD 1-3dAC`,`MRI LD InterReg`,`MRI LD PreSurg`) %>%
  rename(baseline='MRI LD Baseline', t1='MRI LD 1-3dAC', t2='MRI LD InterReg', t3='MRI LD PreSurg')

tumor.df %>%
  gather(time, size, baseline:t3) %>%
  ggplot(aes(time, size)) +
  geom_boxplot(na.rm = TRUE) +
  geom_jitter(width = 0.1, pch = 21, fill = "grey", na.rm = TRUE) +
  labs(title = "Tumor Size ~ Time",
       x = "Time Point",
       y = "Tumor Size") +
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    text = element_text(family = "Palatino"),
    plot.title = element_text(face = "bold", size = 20)
  )
```

We also want to take a look at the rate tumor size decreases over time because at different treatment time points, the effect of treatment will be different, and the overall percentage of tumor size might have correlation with PCR an RFS. Below we have a box plot for tumor size percentage change over four different treatment time points, and the results indicate that the tumor decreasing rate will be greatest at the very beginning of the treatment, and the rate will decrease over time.

```{r, eval=TRUE}
id <- tumor.df["SUBJECTID"]
n <- 3L
id[,2:length(n-2):dim(tumor.df)[2]] <-
  lapply(n:dim(tumor.df)[2], function(x) setNames(((tumor.df[x]-tumor.df[x-1])/tumor.df[x-1]),
                                            paste0("Pct", x-2, x-1)))
SUBJECTID <- id$SUBJECTID
pct12 <- id$V2$Pct12
pct23 <- id$V3$Pct23
pct34 <- id$V4$Pct34

id <- data.frame(SUBJECTID,pct12,pct23,pct34)

id %>%
  gather(time, percentage_change, pct12:pct34) %>%
  ggplot(aes(time, percentage_change)) +
  geom_boxplot(na.rm = TRUE) +
  geom_jitter(width = 0.1, pch = 21, fill = "grey", na.rm = TRUE) +
  labs(title = "Tumor Size Percentage Change ~ Time",
       x = "Time Point",
       y = "Tumor Size") +
  theme_bw() +
  theme(
    panel.grid.major.x = element_blank(),
    text = element_text(family = "Palatino"),
    plot.title = element_text(face = "bold", size = 20)
  )
 
  
```

Then, we want to investigate the correlation between tumor size overall change and PCR and RFS. Looking at the overall tumor size changes versus RFS, we can say RFS is independently associated with tumor size over change over four treatment time points. However, looking at boxplot of tumor size change versus PCR, we found that the larger percentage of tumor decrease over time, the higher possibility that patient will have PCR after treatments. 

```{r, eval=TRUE}
tumor.df <- mutate(tumor.df, overall_change = (t3-baseline)/baseline)

df2 <- merge(tumor.df, outcome)
df2 %>%
  select(SUBJECTID, overall_change, RFS, PCR)

ggplot(df2, aes(x=overall_change, y=RFS)) +
  geom_point()

ggplot(df2, aes(x=PCR, y=overall_change)) +
  geom_boxplot()
```

Looking at the correlation between PCR and RFS, we found that patient with Pathologic Complete Response after neoadjuvant treatment (no residual invasive disease in breast or lymph nodes; presence of only in situ disease are considered disease free) will be more likely to have higher recurrence-free survival time - time from neoadjuvant chemotherapty start date ultil earliest local or distant progression or death. 
```{r, eval=TRUE}
ggplot(total, aes(x=PCR, y=RFS)) +
  geom_boxplot()
```

To look at the association with various receptor status and PCR,RFS outcome, a multivariate regression model is made.
```{r, eval=TRUE}
PCR.glm <- glm(PCR ~ age + ERpos + PgRpos + Her2MostPos + HR_status + HR_HER2_CATEGORY, data=total, family="binomial")
summary(PCR.glm)

PCR.lm <- lm(RFS ~ age + ERpos + PgRpos + Her2MostPos + HR_status + HR_HER2_CATEGORY, data=total)
summary(PCR.lm)
```
Based on the multivariate regression model, age and HER2 receptor status are two significant predictors for PCR outcome, estrogen receptor status is a significant predictor for RFS outcome. 

