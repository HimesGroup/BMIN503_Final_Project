---
title: "BMIN503/EPID600 Car Crashes in Philadelphia in 2008 and 2018"
author: "Nuoying MA"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation in class will be based on the contents of this document. Replace the title/name and text below with your own, but keep the headers.

### Overview
In this section, give a brief a description of your project and its goal, what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

The goal is to examine car crash data in Philadelphia in 2008 and 2018, respectively. This project will first obtain and compare the critical factors contributing the fatal car crashes in 2008 and 2018 using machine learning methods. Then, the important factors contributing to the deadly car crashes will be plotted. 


### Introduction 
In the first paragraph, describe the problem addressed, its significance, and some background to motivate the problem.

This project utilizes the data provided by the Philadelphia government for all car crashes in 2008 and 2018. Car crashes can be fatal and detrimental to the families of victims. By finding the most critical factors contributing to fatal car crashes, this project could provide a warning and raise the caution to drivers and pedestrians of those factors, and potentially reduce the fatal rate of accidents. 

In the second paragraph, explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Since the car crash data also contains information on observed dangerous driving behaviors, including alcohol consumption, speeding, this data would be useful to study the effect of human psychology and health status on the severity of accidents. 


### Methods
In the first paragraph, describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

```{r, eval = TRUE}
getwd()
library(ggplot2)
library(dplyr)
flag.2018 <- read.csv("Philadelphia_FLAG_2018.csv", header = TRUE) #load 2018 flag data

crash.2008<-read.csv("CRASH_2008_Philadelphia.csv", header=TRUE)
flag.2008<-read.csv("FLAG_2008_Philadelphia.csv", header=TRUE) #load 2008 flag data, look for most important factors contributing to fatal car crashes.
crash.08 <- crash.2008 %>%
             select(CRN, CRASH_YEAR,DAY_OF_WEEK, HOUR_OF_DAY, FATAL_COUNT, INJURY_COUNT, PERSON_COUNT)


            
library(ggplot2) 
ggplot(data = flag.2018, aes(x = DAY_OF_WEEK))+
  geom_bar()+
  labs(x = "day of week when crash happens")#summarise by day of week
#no significant difference in number of car crashes among different day of week.

library(dplyr)
flag.2018 %>% 
    mutate(HOUR_OF_DAY = ifelse(HOUR_OF_DAY %in% c(99), NA,HOUR_OF_DAY)) %>% 
    ggplot(aes(x = HOUR_OF_DAY))+
    geom_bar()+
    labs(x = "hour of the day when crash happens")
# from 15pm to 19pm is the peak hours of car crashes.

```
 
```{r, eval = TRUE}
colnames(flag.2008)
class(flag.2008$FATAL)
#This excel sheet contains 4 separate column, driver age=16,17,18,19,20, I would like to combine them to be 1 column, and remove the original columns
flag.2008$Driveryoung<-flag.2008$DRIVER_16YR+flag.2008$DRIVER_17YR+flag.2008$DRIVER_18YR+flag.2008$DRIVER_19YR+flag.2008$DRIVER_20YR
flag.2008$Driveryoung<-ifelse(flag.2008$Driveryoung==0,0,1)
flag.2008$DRIVER_16YR<-NULL
flag.2008$DRIVER_17YR<-NULL
flag.2008$DRIVER_18YR<-NULL
flag.2008$DRIVER_19YR<-NULL
flag.2008$DRIVER_20YR<-NULL
colnames(flag.2008)
test <- flag.2008 %>% 
  select(CRN,Driveryoung)
  class(test$Driveryoung)# test the values of Driveryoung
#We would like to focus on fatal crashes, so exclue other conditions, like "MAJOR_INJURY"       "MODERATE_INJURY", "MINOR_INJURY", "PROPERTY_DAMAGE_ONLY","INJURY_OR_FATAL","FATAL_OR_MAJ_INJ","INJURY" 


test2<-flag.2008 %>% 
  select(CRN,FATAL)
class(test$Driveryoung)
crash.08 <- crash.2008 %>%
             select(CRN, CRASH_YEAR,DAY_OF_WEEK, HOUR_OF_DAY, FATAL_COUNT, INJURY_COUNT, PERSON_COUNT)
```


```{r, eval = TRUE}             
             
             filter(adult.status == "child") %>% 
    ggplot(aes(x = age, y = fev1)) + 
        geom_point() +
        geom_smooth(method = "lm", color = "red")
mutate(asthma = ifelse(asthma %in% c(7,9), NA, ifelse(asthma == 2, 0, 1))) %>%
    filter(!is.na(asthma)
           mutate(race = ifelse(race %in% c("NA"), NA, race))
  
flag.2018%>%
    group_by(DAY_OF_WEEK) %>%
    summarise(count = n())%>% #summarise by day of week
  ggplot(aes(x = count, fill = gender)) + #binary relationship, how race diff by gender, fill=fill by color, separate by race, each race 2 color
    geom_bar(binwidth = 1)
ggplot(aes(x=dep_time,y=delay, color=origin)) +
  geom_point()+
  geom_smooth(color = "blue", method = "auto")+
  labs(x = "departure time", y = "average delay time")
names(flag.2018)
str(pheno.feather)
head(pheno.feather)
crash.2018 <- read_excel("my_file.xlsx", sheet = "data")
t <- read.table("GSE35571_Phenotype.txt", header = TRUE)
class(t) #load it as data frame
names(t) #name of header
head(t) #top few lines
row.names(t) #some time first row is row name, so 少了一行

dim(t)
```

### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
