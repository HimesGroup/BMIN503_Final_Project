---
title: "Tracking comorbidity between depression and substance abuse over the past ten years"
subtitle: "BMIN503/EPID600 Final Project"
author: "Keely Beyries"
format: html
editor: visual
number-sections: true
embed-resources: true
---

------------------------------------------------------------------------

Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers. Feel free to change the theme and other display settings, although this is not required.

## Overview {#sec-overview}

Substance use disorder(SUD) Using the 2021 NSDUH data, this project aims to track the prevalence of substance use disorder in the adult population of the United States.

## Introduction {#sec-introduction}

According to the World Health Organization(WHO), mental health issues disorders have risen 13% over the past ten years. This project aims to focus on the prevalence of depression in the US. Substance abuse issues are often linked with mental health issues such as depression. It will be explored if a relationship exists between substance use and depression among individuals.

This project may be helpful to those who work in fields related to mental health, substance abuse treatment or epidemiology. The link between substance abuse and mental health disorders can often be hard to study because it can be difficult to tell if one was caused by the other and in some cases which disorder occurred first. Tracking if rates of depression and substance abuse rates are correlated over the past decade may give some insight into how common the comorbidity between these two disorders may be.

## Methods {#sec-methods}

**Data set**

The data used for this project are from the 2021 National Survey on Drug Use and Health. This survey intends to collect information from US civilians aged 12 and older.

**Libraries**

```{r}
library(tidyverse)
library("dplyr")
library(ggplot2)
library(RColorBrewer)
library(scales)
library(gridExtra)
library(ggeasy)
```

**Pre-analysis**

Before any analysis could be done, variables were identified and the data was cleaned.

```{r}
#load in data 


NSDUH <- read.delim("NSDUH_2021.txt")
NSDUH <- data.frame(NSDUH)


#select data needed and rename variables
NSDUH <- NSDUH %>% select(QUESTID2 , AGE3, income, COUTYP4, txevrrcvd, 
                          txyruseadb, txyrhosov,
                          txyrresov, txyroutpt, 
                          txyrmhcop , txyremrgn, 
                          txyrdrpad, txyrprisn, txyrslfhp, 
                          txyrother, TXYROTHSP2, impweeks,
                          suicthnk, suiplanyr, ADLSI2WK,
                          auinpyr, auoptyr, amdeyr,
                          casurcvr, camhrcvr, camhprob) %>% 
  
  rename(id = QUESTID2 , age = AGE3, income = income, citysize = COUTYP4, rec_sub_trtm = txevrrcvd, 
                          sub_trtm_12mo = txyruseadb, hos_trtm = txyrhosov,
                         rehab_trtm = txyrresov, outpatient_trtm = txyroutpt, 
                        mhfacility_trtm = txyrmhcop , ER_trtm = txyremrgn, 
                        private_trtm = txyrdrpad, prison_trtm = txyrprisn, selfhelp_trtm = txyrslfhp, 
                        other_trtm = txyrother, type_other_trtm = TXYROTHSP2, num_weeks_mh = impweeks,
                        think_suicide = suicthnk, plan_suicide = suiplanyr, dep_two_weeks = ADLSI2WK,
                        hos_overnight_mh = auinpyr, outpatient_mh = auoptyr, MDE_pastyear = amdeyr,
                        think_recovered_sub = casurcvr, think_recovered_mh = camhrcvr, think_had_mh = camhprob)
```

Data cleaning consisted of keeping only respondents of age 18 or older and only those who had responded whether or not they had received any treatment for substance use issues.

```{r}
#filter to only keep respondents who are 18 years or older and who answered yes or no to ever receiving treatment for substance use
  filter(NSDUH, rec_sub_trtm == 1 | rec_sub_trtm == 2 & age >=4) 
  
 #re-coding variables in data set 
 clean_NSDUH <- NSDUH %>%
   mutate(rec_sub_trtm = factor(rec_sub_trtm, 
                                levels = c(1,2), 
                                labels = c("yes", "no") )) %>% 
  
   mutate(age = factor(age, 
                                 levels = c(4,5,6,7,8,9,10,11),
                                 labels = c("18-20", "21-23", " 24-25", "26-29", "30-34", 
                                            "35-49", "50-64", "65 and older"))) %>% 
   mutate(income = factor(income, 
                       levels = c(1,2,3,4),
                       labels = c("less than $20,000", "$20,000 - $49,999", "$50,000 - $74,999", "$75,000 or more"))) %>% 
   
   mutate( citysize = factor(citysize, 
                       levels = c(1,2,3),
                       labels = c("large city", "small city/town", "Rural"))) %>% 
   
   mutate(sub_trtm_12mo = factor(sub_trtm_12mo, 
                                  levels = c(1,2),
                                  labels = c("yes", "no"))) %>% 
   
   mutate(hos_trtm = factor(hos_trtm, 
                                 levels = c(1,2),
                                 labels = c("yes", "no"))) %>% 
  
  mutate(rehab_trtm = factor(rehab_trtm, 
                                 levels = c(1,2),
                                 labels = c("yes", "no"))) %>% 
   
  mutate(outpatient_trtm = factor(outpatient_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
  
  mutate(mhfacility_trtm = factor(mhfacility_trtm, 
                            levels = c(1,2),
                            labels = c("yes", "no"))) %>% 
 
  mutate(ER_trtm = factor(ER_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
  
  mutate(private_trtm = factor(private_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
  
  mutate(prison_trtm = factor(prison_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
  
  mutate(selfhelp_trtm = factor(selfhelp_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
  mutate(other_trtm = factor(other_trtm, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 

  mutate(type_other_trtm = factor(type_other_trtm, 
                              levels = c(2,6,8,9,40, 41, 42, 44, 45, 46, 47, 48, 49, 52, 53, 56, 64, 65, 67, 90 ),
                              labels = ("other"))) %>% 
  
  # mutate(num_weeks_mh = factor(num_weeks_mh, 
  #                             levels = c(1,2),
  #                             labels = c("yes", "no"))) %>% 
   
   mutate(think_suicide = factor(think_suicide, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(plan_suicide = factor(plan_suicide, 
                                 levels = c(1,2),
                                 labels = c("yes", "no"))) %>% 
   
   mutate(dep_two_weeks = factor(dep_two_weeks, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(hos_overnight_mh = factor(hos_overnight_mh, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(outpatient_mh = factor(outpatient_mh, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(MDE_pastyear = factor(MDE_pastyear, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(think_recovered_sub = factor(think_recovered_sub, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(think_recovered_mh = factor(think_recovered_mh, 
                              levels = c(1,2),
                              labels = c("yes", "no"))) %>% 
   
   mutate(think_had_mh = factor(think_had_mh, 
                              levels = c(1,2),
                              labels = c("yes", "no")))
```

```{r}
   
 plot_theme <- function() {
   theme(plot.title=element_text(hjust=0.5,size=16),axis.text.y = element_text(size=12),axis.text.x = element_text(size=12),
         axis.title.y = element_text(size=14),axis.title.x = element_text(size=14),
         legend.text = element_text(size = 12),legend.title = element_text(size = 14))     
 }
 
 
 # Show bar plot of respondents who ever required substance use treatment 
 ever <- clean_NSDUH %>% 
   filter(!is.na(rec_sub_trtm)) %>% 
   ggplot(aes(x = rec_sub_trtm, y = after_stat(count/sum(count)), fill = rec_sub_trtm)) +
   geom_bar() +
   plot_theme() + 
   scale_y_continuous(labels = percent) +
   ggtitle("Received Treatment for SUD") +
   xlab(" ") +
   ylab("Percent") +
   scale_fill_manual(name=" ",values=c("hotpink","darkgrey")) 
 
 # Show bar plot of respondents who required substance use treatment in the past year
 pastyear <- clean_NSDUH %>%
   filter(!is.na(sub_trtm_12mo)) %>% 
   ggplot(aes(x = sub_trtm_12mo, y = after_stat(count/sum(count)), fill = sub_trtm_12mo)) +
   geom_bar() +
   plot_theme() + 
   scale_y_continuous(labels = percent) +
   ggtitle("In the Past 12 Months") +
   xlab(" ") +
   ylab(" ") +
   scale_fill_manual(name=" ",values=c("hotpink","darkgrey"))
 
   grid.arrange(ever, pastyear, nrow = 1)
 
 #age of respondents who have received treatment 
 clean_NSDUH %>% 
   filter(rec_sub_trtm == "yes") %>% 
   filter(!is.na(age)) %>% 
   ggplot(aes(x = age, y = after_stat(count/sum(count)))) +
   geom_bar(fill = "hotpink") +
   plot_theme() + 
   scale_y_continuous(labels = percent) +
   ggtitle("Age of Respondents That Ever Received Treatment") +
   xlab(" ") +
   ylab("Percent")
```

```{r}
 #Respondents from rural areas 
 rural <- clean_NSDUH %>% 
    filter(!is.na(rec_sub_trtm)) %>% 
    filter(citysize == "Rural") %>% 
    ggplot(aes(x = rec_sub_trtm, y = after_stat(count/sum(count)))) +
    geom_bar(fill = "hotpink") +
    plot_theme() + 
    scale_y_continuous(labels = percent) +
    ggtitle("Rural area") +
    xlab(" ") +
    ylab("Percent")
  
 #respondents from small city/town  
  smallcity <- clean_NSDUH %>% 
    filter(!is.na(rec_sub_trtm)) %>% 
    filter(citysize == "Small city/town") %>% 
    ggplot(aes(x = rec_sub_trtm, y = after_stat(count/sum(count)))) +
    geom_bar(fill = "hotpink") +
    plot_theme() + 
    scale_y_continuous(labels = percent) +
    ggtitle("Small city/town") +
    xlab(" ") +
    ylab("Percent")
  
  
  #respondents from large cities
  largecity <- clean_NSDUH %>% 
    filter(!is.na(rec_sub_trtm)) %>% 
    filter(citysize == "Large city") %>% 
    ggplot(aes(x = rec_sub_trtm, y = after_stat(count/sum(count)))) +
    geom_bar(fill = "hotpink") +
    plot_theme() +
    scale_y_continuous(labels = percent) +
    ggtitle("Large city") +
    xlab(" ") +
    ylab("Percent")
  
  grid.arrange(rural, smallcity, largecity, nrow = 2)
```

```{r}
 #compare where respondents received treatment
  NSDUH_long <- clean_NSDUH %>% 
    rename(Hospital = hos_trtm, Rehab = rehab_trtm, 
            Outpatient = outpatient_trtm, "MH facility" = mhfacility_trtm, "Emergency Room" = ER_trtm,
            "Private Facility" = private_trtm, "Jail/Prison" = prison_trtm, "Self Help" =selfhelp_trtm)
  
  NSDUH_long <- gather(NSDUH_long, key = "Facility", value="response", c("Hospital", "Rehab", 
                                                                          "Outpatient", "MH facility", "Emergency Room",
                                                                          "Private Facility", "Jail/Prison", "Self Help"))
  
  NSDUH_long %>%
  filter(rec_sub_trtm == "yes") %>%
  filter(response == "yes")%>% 
    ggplot(aes(x = Facility, y = after_stat(count/sum(count)), fill = response)) +
    geom_bar(fill = "hotpink", position = 'dodge') +
    plot_theme() +
    scale_y_continuous(labels = percent) +
    ggtitle("Treatment Facility Type") +
    xlab(" ") +
    ylab("Percent") +
    easy_rotate_x_labels(angle = 90) 
  
    #Respondents who received treatment and think they had MH issues
  clean_NSDUH %>% 
    filter(rec_sub_trtm == "yes") %>% 
    filter(!is.na(think_had_mh)) %>% 
    ggplot(aes(x = think_had_mh, y = after_stat(count/sum(count)), fill = think_had_mh)) +
    geom_bar() +
    plot_theme() + 
    scale_y_continuous(labels = percent) +
    ggtitle("Think They Had MHI (Past 12 Months)") +
    xlab(" ") +
    ylab("Percent") +
    scale_fill_manual(name=" ",values=c("hotpink","darkgrey")) 
  
```

```{r}

    #number of weeks of MHI
  clean_NSDUH %>% 
    filter(rec_sub_trtm == "yes") %>% 
    filter(num_weeks_mh >= 2) %>% 
    ggplot(aes(x = num_weeks_mh)) +
    geom_histogram(fill = "hotpink", binwidth = 4) +
    plot_theme() +
    ggtitle("Length of MHI") +
    xlab("Length (weeks)") +
    ylab("Number of Respondents")


 #Respondents who had depression lasting two weeks or longer
  clean_NSDUH %>% 
    filter(rec_sub_trtm == "yes") %>% 
    filter(!is.na(dep_two_weeks)) %>% 
    ggplot(aes(x = dep_two_weeks, y = after_stat(count/sum(count)), fill = dep_two_weeks)) +
    geom_bar() +
    plot_theme() + 
    scale_y_continuous(labels = percent) +
    ggtitle("Depression Lasting Two Weeks or Longer") +
    xlab(" ") +
    ylab("Percent") +
    scale_fill_manual(name=" ",values=c("hotpink","darkgrey")) 
  

```

Describe the data used and general methodological approach used to address the problem described in the @sec-introduction. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why.

## Results {#sec-results}

Describe your results and include relevant tables, plots, and code/comments used to obtain them. You may refer to the @sec-methods as needed. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

## Conclusion

This the conclusion. The @sec-results can be invoked if you'd like.

References

Drake RE, Mueser KT, Brunette MF. Management of persons with co-occurring severe mental illness and substance use disorder: program implications. World Psychiatry. 2007 Oct
