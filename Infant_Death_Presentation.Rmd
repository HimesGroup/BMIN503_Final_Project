---
title: "Changing Nature of Death in Infancy in the United States"
author: "Kevin Dysart"
date: "12/1/2019"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r loading packages, echo=FALSE, warning=FALSE, message=FALSE}
library("tidyverse")
library("urbnmapr")
library("lubridate")
library("survival")
library("survminer")
library("RColorBrewer")
```

```{r reading in dataframes for slides, echo=FALSE, warning=FALSE, message=FALSE}
#Reading CDC Wonder Data Files
Wonder_File_Names <- list.files(path = "Linked_Birth_Death_Data/CDC_Wonder_All_Death_By_Year/", pattern = "*.txt")
Wonder_Files <- list.files(path = "Linked_Birth_Death_Data/CDC_Wonder_All_Death_By_Year/", pattern = "*.txt", full.names = T)
Wonder_Files_df <- lapply(Wonder_Files, read.delim)
names(Wonder_Files_df) <- Wonder_File_Names
#Reading Linked Birth and Death Data
Linked_Birth_Death_Names <- list.files(path = "Linked_Birth_Death_Data/Linked_Year_CSV_Zip/", pattern = "*.csv.zip")
Linked_Birth_Death_Files <- list.files(path = "Linked_Birth_Death_Data/Linked_Year_CSV_Zip/", pattern = "*.csv.zip", full.names = T)
Linked_Birth_Death_Files_df <- lapply(Linked_Birth_Death_Files, read_csv)
names(Linked_Birth_Death_Files_df) <- Linked_Birth_Death_Names
```

```{r removing Notes column, echo=FALSE, warning=FALSE, message=FALSE}
for (i in 1:length(Wonder_Files_df)) {
  Wonder_Files_df[[i]] <-  Wonder_Files_df[[i]] %>%
                    select(-Notes) %>%
                    slice(1:51)
}
```

```{r Reading in IMR files for VLBW and ELBW, echo=FALSE, warning=FALSE, message=FALSE}
## Reading in IMR files from CDC 1995 through 2017 ELBW VLBW.
IMR_VLBW_ELBW_Names <- list.files(path = "Linked_Birth_Death_Data/IMR_VLBW_ELBW/", pattern = "*.txt")
IMR_VLBW_ELBW_Files <- list.files(path = "Linked_Birth_Death_Data/IMR_VLBW_ELBW/", pattern = "*.txt", full.names = T)
IMR_VLBW_ELBW_df <- lapply(IMR_VLBW_ELBW_Files, read.delim)
names(IMR_VLBW_ELBW_df) <- IMR_VLBW_ELBW_Names
## Cleaning each dataframe in the list. ELBW and VLBW Dataframes are paired down the list.
ELBW_1995 <- IMR_VLBW_ELBW_df[[1]] %>%
                select(-Notes) %>%
                    slice(1:4)
VLBW_1995 <- IMR_VLBW_ELBW_df[[2]] %>%
                select(-Notes) %>%
                    slice(1:4)
ELBW_1999 <- IMR_VLBW_ELBW_df[[3]] %>%
                select(-Notes) %>%
                    slice(1:4)
VLBW_1999 <- IMR_VLBW_ELBW_df[[4]] %>%
                select(-Notes) %>%
                    slice(1:4)
ELBW_2003 <- IMR_VLBW_ELBW_df[[5]] %>%
                select(-Notes) %>%
                    slice(1:4)
VLBW_2003 <- IMR_VLBW_ELBW_df[[6]] %>%
                select(-Notes) %>%
                    slice(1:4)
ELBW_2007 <- IMR_VLBW_ELBW_df[[7]] %>%
                select(-Notes) %>%
                    slice(1:11)
VLBW_2007 <- IMR_VLBW_ELBW_df[[8]] %>%
                select(-Notes) %>%
                    slice(1:11)
All_ELBW_IMR <- do.call("rbind", list(ELBW_1995, ELBW_1999, ELBW_2003, ELBW_2007))
All_VLBW_IMR <- do.call("rbind", list(VLBW_1995, VLBW_1999, VLBW_2003, VLBW_2007))
All_VLBW_IMR$Year.Group <- c(rep("1995-1998", 4), rep("1999-2002", 4),
                             rep("2003-2006", 4), rep("2007-2017", 11))
All_ELBW_IMR$Year.Group <- c(rep("1995-1998", 4), rep("1999-2002", 4),
                             rep("2003-2006", 4), rep("2007-2017", 11))
All_ELBW_IMR$Year.Group <- as.factor(All_ELBW_IMR$Year.Group)
All_VLBW_IMR$Year.Group <- as.factor(All_VLBW_IMR$Year.Group)
```

```{r Cleaning Data for IMR Description}
linked_1995 <- Linked_Birth_Death_Files_df[[1]]
linked_1995_VLBW <- filter(linked_1995, gestat<33)
Percent_1995_IMR_VLBW <- length(linked_1995_VLBW$matchs)/length(linked_1995$matchs)
```


## Introduction

- Infant mortality in the United States is a much discussed topic in population.
  - Infant mortality rates are often associated with the health of nations across the world.
- Much of the recent conversation in neonatal medicine is on the increasing survival amongst infants born less than 1,500g (VLBW) or less than 32 weeks.
  - Recent studies have shown small but significant increases in survival amongst the smallest and most premature infants. 
    - This is largely the result of therapeutics interventions introduced over the last 20 years and more frequent applications to younger infants.
  - Little information is available on how trends in care practices have impacted death in infancy.
    - Specifically among infants born VLBW

## Hypothesis {.bigger}

- Among infants born ELBW there will be a temporal trend towrds increasing time before death among infants born less than 1,000g. 

## Infant Mortality Rate 1995

```{r IMR 1995, echo = FALSE, warning=FALSE}
All_Infant_Death_1995_By_State <- Wonder_Files_df[[1]]
All_Infant_Death_1995_By_State <- rename(All_Infant_Death_1995_By_State, state_name = State)
All_Infant_Death_1995_By_State <- rename(All_Infant_Death_1995_By_State, death_rate = "Death.Rate")

state_data_infant_death_1995 <- left_join(All_Infant_Death_1995_By_State, states, 
                                          by = "state_name")
state_data_infant_death_1995 %>%
  ggplot(aes(long, lat, group = group, fill = death_rate)) +
  ggtitle("Infant Death Rate in the US 1995") +
  geom_polygon(color = NA) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
  labs(fill = "Infant Death Rate")
```

## Infant Mortality Rate 2007

```{r IMR 2007, echo = FALSE, warning=FALSE}
All_Infant_Death_2007_By_State <- Wonder_Files_df[[13]]
All_Infant_Death_2007_By_State <- rename(All_Infant_Death_2007_By_State, state_name = State)
All_Infant_Death_2007_By_State <- rename(All_Infant_Death_2007_By_State, death_rate = "Death.Rate")

state_data_infant_death_2007 <- left_join(All_Infant_Death_2007_By_State, states, 
                                          by = "state_name")
state_data_infant_death_2007 %>%
  ggplot(aes(long, lat, group = group, fill = death_rate)) +
  ggtitle("Infant Death Rate in the US 2007") +
  geom_polygon(color = NA) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
  labs(fill = "Infant Death Rate")
```

## Infant Mortality Rate 2017

```{r IMR 2017, echo = FALSE, warning=FALSE}
All_Infant_Death_2017_By_State <- Wonder_Files_df[[23]]
All_Infant_Death_2017_By_State <- rename(All_Infant_Death_2017_By_State, state_name = State)
All_Infant_Death_2017_By_State <- rename(All_Infant_Death_2017_By_State, death_rate = "Death.Rate")

state_data_infant_death_2017 <- left_join(All_Infant_Death_2017_By_State, states, 
                                          by = "state_name")
state_data_infant_death_2017 %>%
  ggplot(aes(long, lat, group = group, fill = death_rate)) +
  ggtitle("Infant Death Rate in the US 2017") +
  geom_polygon(color = NA) +
  coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
  labs(fill = "Infant Death Rate")
```

## What Portion of the IMR is Accounted for by VLBW Infants?
- In 1995 `r Percent_1995_IMR_VLBW` percent of the IMR in the United States was accounted for by those infants born VLBW and xxx percent from infants born ELBW.
- 

## Improvements in IMR in Infants 1,000 to 1,499g.
```{r IMR in VLBW}
aa <- ggplot(All_VLBW_IMR, aes(x=Year.of.Death, y=Death.Rate))
bb <- aa +geom_point(aes(colour = Year.Group, size=Deaths)) +
      scale_color_brewer(palette="Blues") +
      ggtitle("IMR in Infants 1,000 to 1,499g") + 
      xlab("Year") +
      ylab("IMR") +
      labs(Size="Number of Deaths", colour="Year Group") +
      theme_dark()
bb
```

## Improvements in IMR in Infants 500-999g.
```{r IMR in ELBW}
cc <- ggplot(All_ELBW_IMR, aes(x=Year.of.Death, y=Death.Rate))
dd <- cc +geom_point(aes(colour = Year.Group, size=Deaths)) +
      scale_color_brewer(palette="Blues") +
      ggtitle("IMR in Infants 500 to 999g") + 
      xlab("Year") +
      ylab("IMR") +
      labs(Size="Number of Deaths", colour="Year Group") + 
      theme_dark()
dd
```

