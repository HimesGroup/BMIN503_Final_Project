---
title: "Health Disparities Between Different Races in Philadelphia Region"
author: "Joyce Wang"
output:
  html_document:
    depth: 3
    highlight: tango
    theme: paper
    toc: no
  pdf_document:
    toc: no
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
### Overview
Race influences many aspects of ones life from culture and lifestlye to health outcomes, especially between Caucasian people and minorities. I'm interested to see if these health disparities exist in the greater Philadelphia region and what factors are the greatest predictors of adverse health events. I will be applying statistical and machine learning analysis to the Southeastern Pennsylvania Household Survey results from 2015 to evaluate the difference between Caucasians and minorities. You can get access to my Github repository [here](https://github.com/joycehelenwang/BMIN503_Final_Project).

I conceptualized my project after speaking with three faculty members: Andria Johnson, Rebecca Hubbard, and Ariana Chao. Andria Johnson is a Professor in the Department of History and Sociology of Science and recommended that I look at health disparities in the local Philadelphia region. Rebecca Hubbard is an Associate Professor of Biostatistics in the Department of Biostatistics, Epidemiology and Informatics and suggested using machine learning techniques to create a model to predict health outcomes and determine source variability. Ariana Chao is an Assistant Professor of Nursing and reccomended some datasets and discussed the impact of mental health on BMI and other health outcomes as a possibile route.

### Introduction 
While there exists many difference between Caucasians and minorities, there's been a growing interest in health disparities between the two groups. The difference in demographics of the groups along with correlations with socioeconomic status and access to healthcare providers leads to health disparities. In an era where healthcare issues are at the forefront of political agendas, it's important to create policies that benefit all Americans regardless of their race. For this project in particular, looking at the greater Philadelphia region will provide insights locally. Through this analysis I hope to elucidate differences in health outcomes between difference races and also what factors are the greatest predictors of adverse health outcomes to inform healthcare policies in the region.

This problem interdiciplinary as it spans several fields. There is a large data science aspect since the analysis is performed through coding in R. The problem itself draws insights from epidemiology, public health and policy, and sociology. Since healthcare policies are so influential, it's vital that we have adequate data and effective analysis in order to inform these decisions. Datasets will need to be properly cleaned and transformed, making note of missing values. Additionally, being able to apply context to the obtained results and drawing the correct conclusions is crucial in best representing the population.

### Methods
In the first paragraph, describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

The data I am analyzing is from the 2014-2015 Southeastern Pennsylvania Household Health Survey with results from adults and children combined. After loading in the data, variables will be converted to factor or numeric accordingly. Finally, interesting variables will be filtered and cleaned up for analysis.

``` {r, eval = TRUE, message = FALSE}
library(haven)
library(tidyverse)

# read in raw data
raw.data <- read_sav(url("https://raw.githubusercontent.com/joycehelenwang/BMIN503_Final_Project/master/HS15COM1b.sav"))

# convert to factors
data <- as_factor(raw.data)

# clean up race demographics
table(data$RACE2)

levels(data$RACE2) <- c("White", "Black", "Latino", "Asian", "Multi", "Native American", "Other")

race.data <- data %>% 
  filter(RACE2 == "White" | RACE2 == "Black" | RACE2 == "Latino" | 
           RACE2 == "Asian" | RACE2 == "Native American") %>%
  group_by(RACE2)

# select relevant data (demographics, access to care, obesity)
# filter.data <- race.data %>%
#   select(Race = RACE2, County = COUNTY, Sex = SEX, Age = AGE, Kids = TOTKIDS, Adults = NUMADULT, Health = HEALTH2, Source = SOURCE, Usual = USUALGO, Work = WORKCOM, Self = SELFCOM, MedA = MEDACOM, MedB = MEDBCOM, MA = MACOM, VA = VACOM, Other = OTHERCOM, Insured = INSURED, Dentist = DENTIST, Obesity = OBESITY2, Grad = RSPGRAD2, Income = INCOME)
```
``` {r, eval = TRUE}
## demographics
# county
county <- race.data %>%
  select(Race = RACE2, County = COUNTY, Income = INCOME) %>%
  na.omit
ggplot(county, aes(Race)) +
  geom_bar(position = "fill", aes(fill = County)) + 
  labs(y = "Proportion")
ggplot(county, aes(Race)) +
  geom_bar(position = "fill", aes(fill = Income)) +
  labs(y = "Proportion") +
  theme(legend.text=element_text(size=4))

# income
income <- race.data %>%
  ungroup() %>%
  select(Income = INCOME) %>%
  na.omit
ggplot(income, aes(Income)) +
  geom_bar(aes(fill=Income)) +
  labs(y = "Proportion") +
  theme(legend.text=element_text(size=5), 
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
table(income)

# sex and age
age <- race.data %>%
  select(Race = RACE2, Age = AGE) %>%
  na.omit
ggplot(age, aes(Age)) +
  geom_histogram(aes(fill = Race))

sex <- race.data %>%
  select(Race = RACE2, Sex = SEX) %>%
  na.omit
ggplot(sex, aes(Sex)) +
  geom_bar(aes(fill = Race))

```
```{r, eval = TRUE, message = FALSE, warning = FALSE}
library(reshape2)

# insurance rate
insurance.data2 <- race.data %>%
  select(Race = RACE2, Insured = INSURED) %>%
  na.omit
ggplot(insurance.data2, aes(Race)) +
  geom_bar(aes(fill=Insured), position = "fill")

# types of insurance - count number of yes
work <- race.data %>%
  count(WORKCOM) %>%
  na.omit %>%
  filter(WORKCOM == "Yes") %>%
  select(Race = RACE2, Work = n)

self <- race.data %>%
  count(SELFCOM) %>%
  na.omit %>%
  filter(SELFCOM == "Yes") %>%
  select(Race = RACE2, Self = n)

meda <- race.data %>%
  count(MEDACOM) %>%
  na.omit %>%
  filter(MEDACOM == "Yes") %>%
  select(Race = RACE2, MedA = n)

medb <- race.data %>%
  count(MEDBCOM) %>%
  na.omit %>%
  filter(MEDBCOM == "Yes") %>%
  select(Race = RACE2, MedB = n)

ma <- race.data %>%
  count(MACOM) %>%
  na.omit %>%
  filter(MACOM == "Yes") %>%
  select(Race = RACE2, MA = n)

va <- race.data %>%
  count(VACOM) %>%
  na.omit %>%
  filter(VACOM == "Yes") %>%
  select(Race = RACE2, VA = n)

other <- race.data %>%
  count(OTHERCOM) %>%
  na.omit %>%
  filter(OTHERCOM == "Yes") %>%
  select(Race = RACE2, Other = n)

insurance.type <- list(work, self, meda, medb, ma, va, other) %>% 
  reduce(full_join, by = "Race")
insurance <- melt(insurance.type, id.vars='Race')

ggplot(insurance, aes(Race, value)) +
  geom_bar(stat = "identity", position = "fill", aes(fill=variable)) +
  labs(y = "Proportion") +
  scale_fill_discrete(name = "Insurance Type")

ggplot(insurance, aes(variable, value)) +
  geom_bar(stat = "identity", position = "fill", aes(fill=Race)) +
  labs(x = "Insurance Type", y = "Proportion") +
  scale_fill_discrete(name = "Race")
```
``` {r, eval = TRUE}
## health outcomes
# obesity
obesity <- race.data %>%
  select(Race = RACE2, Obesity = OBESITY2) %>%
  na.omit
ggplot(obesity, aes(Race)) +
  geom_bar(position = "fill", aes(fill = forcats::fct_rev(Obesity))) + 
  labs(y = "Proportion") +
  scale_fill_discrete(name = "Obesity")

# dentist
dentist <- race.data %>%
  select(Race = RACE2, Dentist = DENTIST) %>%
  na.omit
ggplot(dentist, aes(Race)) +
  geom_bar(position = "fill", aes(fill = Dentist)) + 
  labs(y = "Proportion")

# smoking
smoke <- race.data %>%
  select(Race = RACE2, Smoking = SMOKHOME) %>%
  na.omit
ggplot(smoke, aes(Race)) +
  geom_bar(position = "fill", aes(fill = Smoking)) + 
  labs(y = "Proportion")

# asthma
asthma <- race.data %>%
  count(EVRASTH) %>%
  na.omit %>%
  rename(Race = RACE2, Asthma = EVRASTH, Count = n)
ggplot(asthma, aes(Asthma, n)) +
  geom_bar(stat = "identity", aes(fill = Race))

```


### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
