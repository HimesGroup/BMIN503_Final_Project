---
title: "BMIN503 Final Project: Multiple myeloma and excess body weight"
name: "Beatrice Razzo"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 OVERVIEW: 
This study aims to identify any associations between newly diagnosed Multiple Myeloma and excess body weight within patients in the MMRF Compass database. These data include ISS risk stratification at diagnosis, adverse cytogenetics, RNA expression and telomere length. We will use BMI as a surrogate marker for excess body weight, recognizing this is an imperfect measure of adiposity.Please find my Github Repository for the final project [here](https://github.com/bearazzo/BMIN503_Final_Project).

# 2 INTRODUCTION:
Multiple myeloma (MM) is the second most common blood cancer diagnosis, with over 20,000 cases diagnosed each year in the United States. Age, race and genetic factors are known predisposing risk factors, but obesity is the only modifiable characteristic consistently implicated in the development of both MGUS and MM (Carson, Bates, and Tomasson 2014; Landgren et al. 2010; Wallin and Larsson 2011). Persons with excess body weight are 10-20% more likely to develop multiple myeloma, with an estimated number of 12,480 cases attributed to excess body weight in the United States between 2011-2015 (Islami et al. 2019).The pathophysiological basis of this association is not fully understood with systemic and marrow immune dysfunction as putative driver mechanisms. 

This study uses the data from the MMRFcompass database to identify any associations between excess body weight and ISS risk at diagnosis, adverse cytogenetics, RNA expression and telomere length. We will use BMI as a surrogate marker for excess body weight, recognizing this is an imperfect measure of adiposity.

This is an intrinsically multidisciplinary project because it incorporates elements of hematology-oncology, pathology, endocrinology, radiology and population genetics. My mentors have been introduced by experts to these respective fields in order to enrich my studies. 

***For the introduction, the first paragraph describes the problem addressed, its significance, and some background to motivate the problem. In the second paragraph, explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.*** 

# 3 METHODS/RESULTS:
***Start working on the Methods/Results section, which consists of code and its output along with text describing what you are doing (Note: we will not check your code now, but you should have something in place before Assignment 6 is distributed).***

## 3.1 Data Source  

***The study was designed to prospectively profile newly diagnosed, treatment naive MM (NDMM) from more than 1000 patients with longitudinal clinical follow up. Tumor specimens collected at diagnosis and relapse are interrogated by whole-exome, modified low pass whole-genome, and or RNA sequencing. The longitudinal component required clinical follow-up of each patient with collection of clinical parameters four times annually over a period of 10 years. Furthermore, each patient participating in the study underwent an IMID and/or Proteasome inhibitor-based treatment regimen at diagnosis determined by the treating haematologist.***

# 3.2 Methodological Approach

Iâ€™ll load in all the necessary libraries first.
```{r, eval = TRUE}
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(tibble)
library(readr)
library(survminer)

```

# 3.3 Descriptive Analyses of the population:
```{r, eval = TRUE}
MMRFfull <- read.csv("~/Documents/BMIN 5030/Final Project/Raw Files/Razzo_MMRF raw csv.csv", header = T, fill = TRUE, row.name = NULL)
MMRFfull <- rename(MMRFfull, Patient_ID = Patient)

MMRFclean <- read.csv("~/Documents/BMIN 5030/Final Project/Raw Files/Razzo_MMRF clean csv.csv", header = T, fill = TRUE, row.name = NULL)
MMRFclean <- rename(MMRFclean, Sex = D_Gender, Race = D_Race, AgeDx = D_Age, BMIDx = BMI, ISSDx = D_ISS) %>%
  mutate(BMI_cat_4 = factor(BMI_cat_4, levels = c(0,1,2,3), labels = c("BMI <18.5", "BMI 18.5-25", "BMI 25-30", "BMI >30"))) %>%
  mutate(BMI_cat_6 = factor(BMI_cat_6, levels = c(0,1,2,3,4,5), labels = c("BMI <18.5", "BMI 18.5-25", "BMI 25-30", "BMI 30-35", "BMI 35-40", "BMI >40"))) %>%
  mutate(FU_status = factor(FU_status, levels = c(0,1), labels = c("Not censored", "Censored"))) %>%
  mutate(OS_status = factor(OS_status, levels = c(0,1), labels = c("Alive", "Dead"))) %>%
  mutate(ISSDx = factor(ISSDx, level = c(1,2,3)))

MMRFclean$Translocation_Summary <- as.factor(MMRFclean$Translocation_Summary)
MMRFclean$HRD <- as.factor(MMRFclean$HRD)

#Baseline Patient Characteristics, BMI 4 categories
patientcharacteristics <- MMRFclean %>% gtsummary::tbl_summary()
MMRFclean %>% 
  dplyr::select(c(Sex, Race, AgeDx, BMI_cat_4, ISSDx, IMWG_Risk, Translocation_Summary)) %>%
  gtsummary::tbl_summary(by = BMI_cat_4) %>%
  gtsummary::add_p()

#Baseline Patient Characteristics, BMI 6 categories
patientcharacteristics <- MMRFclean %>% gtsummary::tbl_summary()
MMRFclean %>% 
  dplyr::select(c(Sex, Race, AgeDx, BMI_cat_6, ISSDx, IMWG_Risk, Translocation_Summary)) %>%
  gtsummary::tbl_summary(by = BMI_cat_6) %>%
  gtsummary::add_p()

#Graphs representing this summary table - 
library(RColorBrewer)
mycolors=brewer.pal(8,"Set2")

#BMI distribution by Sex - ?HOW TO I REMOVE THE NAS - NA.RM = TRUE IS NOT WORKING*****
ggplot(data = MMRFclean, aes(x = BMIDx, color = Sex, na.rm = TRUE)) + 
    geom_histogram(aes(y= ..density.., color=Sex), na.rm=TRUE, Male = "blue", Female = "red", fill = "white", alpha = 0.7)+
    geom_density(Male = "blue", Female = "red", na.rm=TRUE)
ggsave("BMI histogram by sex.pdf")

```

# 4 Results

## 4.1 Demographic and clinical data according to BMI

AGE. The scatter plot slope is small but statistically significant: BMI at diagnosis declines with age. A linear model appears to be an appropriate fit. Later analyses will need to take this relationship into account.
```{r, eval = TRUE}
BMIagelm <- lm(MMRFclean$AgeDx ~ MMRFclean$BMIDx) 
summary(BMIagelm)
coef(BMIagelm) 
confint(BMIagelm)

ggplot(BMIagelm, aes(x = MMRFclean$AgeDx, y = MMRFclean$BMIDx)) +
    geom_point(color = "darkseagreen3") + 
    geom_smooth(method = "lm", color = "green4") +
    labs(title = "BMI by age of diagnosis") +
    labs(x = "Age at diagnosis", y = "BMI at diagnosis")
ggsave("BMI by Age.pdf")
cor(MMRFclean$AgeDx, MMRFclean$BMIDx, use = "complete.obs")  

```

SEX. A linear model integrating age and BMI data again demonstrates the relationship with age but does not demonstrate a relationship with BMI as a continuous variable. However, when BMI is split in 4 or 6 discreet categories, there is a small but statistically significant difference in the distribution of biological sex. Whether these differences will be relevant in the following analysis will be determined on a case to case basis. 
```{r, eval = TRUE}
#Barplots of discreet data distribution, histogram as shown above
ggplot(data = MMRFclean, aes(x = BMI_cat_4, fill = factor(Sex))) + 
    geom_bar(position = "dodge")

ggplot(data = MMRFclean, aes(x = BMI_cat_6, fill = factor(Sex))) + 
    geom_bar(position = "dodge")

#LM of BMI as continuous variable
library(modelsummary)
lm1 <- lm(BMIDx ~ AgeDx + Sex, data = MMRFclean)
modelsummary(list(lm1), coef_omit = "Intercept",
             statistic = c("p = {p.value}"),
             estimate = "{estimate} [{conf.low}, {conf.high}]") 

#Chi-Sq using discreet BMI categories
chisq.test(table(MMRFclean$BMI_cat_4, MMRFclean$Sex))
chisq.test(table(MMRFclean$BMI_cat_6, MMRFclean$Sex))

```

RACE: By lm, there are statistically signficant differences in BMI distribution. ***ANOVA NOT WORKING...*** 
```{r, eval = TRUE}
ggplot(data = MMRFclean, aes(x = factor(Race), y = BMIDx)) +
    geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
    stat_summary(fun.data=mean_sdl, mult=1, 
                 geom="pointrange", color="red")

lm2<- lm(BMIDx ~ Race, data = MMRFclean)
modelsummary(list(lm2), coef_omit = "Intercept",
             statistic = c("p = {p.value}"),
             estimate = "{estimate} [{conf.low}, {conf.high}]") 

```

ISS Stage. Visually there is no difference in presenting ISS according to BMI. ***IS THE SAME TRUE WHETHER ACCOUNTING FOR AGE DIFFERENCES? PROBABLY...*** This is confirmed by a non-statistically significant Chi-Sq test.
```{r, eval = TRUE}
#BMI and presenting ISS
ggplot(data = MMRFclean, aes(x = BMIDx, color = ISSDx, na.rm = TRUE, position = "dodge")) + 
    geom_histogram(aes(y= ..density.., color=ISSDx), na.rm=TRUE, fill = "white", alpha = 0.7)+
    geom_density()

chisq.test(table(MMRFclean$BMI_cat_4, MMRFclean$ISSDx))
```

## 4.3 Characterization of BMI at diagnosis with respect to translocations, RNA risk category and ISS

In regards to the weight distribution of the most common MM related translocations, none appear to seggregate with BMI (though t(8;14) did appear to be statistically significant, it is a rare translocation so this is unlikely to be a clinically significant finding).

Finally, the BMI distribution is exactly the same accross individuals with and without high risk RNA risk profiling (defined as GEP70 score > ***) EILEEN: IS THIS CORRECT THAT IT IS THE GEP70?***). 

```{r, eval = TRUE}

#Translocation Summary - NA, t(4;14), t(11;14), t(14;20), t(4;14), t(6;14), t(8;14)
ggplot(data = MMRFclean, aes(x = factor(Translocation_Summary), y = BMIDx)) +
    geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
    stat_summary(fun.data=mean_sdl, mult=1, 
                 geom="pointrange", color="red") +
    geom_jitter(shape=16, position=position_jitter(0.2))

lm4<- lm(BMIDx ~ Translocation_Summary, data = MMRFclean)
modelsummary(list(lm4), coef_omit = "Intercept",
             statistic = c("p = {p.value}"),
             estimate = "{estimate} [{conf.low}, {conf.high}]") 

#Nice examples of barplot then boxplot distributions with stats in the supplental figures 
##del(17p) - I DON'T HAVE THESE DATA - or were you using tab "TP53_loss"
##gain1q - I DON'T HAVE THESE DATA - or were you using "cks1b_gain"
##del(1p) - I DON'T HAVE THESE DATA - or were you using
##Transplant status?
#TTL and LTL and BMI

#RNA risk status
MMRFclean$RNA_high_risk <- as.factor(MMRFclean$RNA_high_risk)
ggplot(data = MMRFclean, aes(x = BMIDx, color = RNA_high_risk, na.rm = TRUE)) + 
    geom_histogram(aes(y= ..density.., color=RNA_high_risk), na.rm=TRUE, fill = "white", alpha = 0.7)+
    geom_density(na.rm=TRUE)

```

## 4.4 Outcome Summary Statistics

```{r, eval = TRUE}
#Survival by BMI cat 4 - PENDING
MMRFclean$OS_status_num <- as.numeric(MMRFclean$OS_status)
km_fit_BMIcensor <- survfit(Surv(OS_time, OS_status_num) ~ BMI_cat_4, data=MMRFclean)
summary(km_fit_BMIcensor, times=seq(0, 6))
ggsurvplot(km_fit_BMIcensor,
           conf.int=FALSE, # add confidence intervals
           pval=TRUE, # show the p-value for the log-rank test
           risk.table=FALSE, # show a risk table below the plot
           legend.labs=c("1", "2","3","4"), # change group labels
           legend.title="BMI category",  # add legend title
           palette=c("#66C2A5", "#8DA0CB","#A6D854", "#E5C494"), # change colors of the groups
           title="Kaplan-Meier Curve for MM by BMI", # add title to plot
           risk.table.height=0.1)
coxph(Surv(OS_time, OS_status_num) ~ BMI_cat_4, data=MMRFclean)

#Survival by BMI cat 6 - PENDING
km_fit_BMIsix <- survfit(Surv(OS_time, OS_status_num) ~ BMI_cat_6, data=MMRFclean)
summary(km_fit_BMIsix, times=seq(0, 6))
ggsurvplot(km_fit_BMIsix,
           conf.int=FALSE, # add confidence intervals
           pval=TRUE, # show the p-value for the log-rank test
           risk.table=FALSE, # show a risk table below the plot
           legend.labs=c("1", "2","3","4", "5","6"), # change group labels
           legend.title="BMI category",  # add legend title
           palette=c("#66C2A5", "#FC8D62", "#8DA0CB", "#E78AC3", "#A6D854", "#FFD92F" ), # change colors of the groups
           title="Kaplan-Meier Curve for MM by BMI", # add title to plot
           risk.table.height=0.1)
coxph(Surv(OS_time, OS_status_num) ~ BMI_cat_6, data=MMRFclean)

#Survival by Age Ranges - PENDING, will use same as Age paper


#Survival by Sex - PENDING
#Survival adjusted by age and by sex - PENDING
#Survival by t(4;14) and by HRD by BMI 4, adjusted by age - PENDING
#Raw
#Corrected for age, sex and ***

```

# 5. Additional genetic correlates
## 5.1 DGE -- normal and high groups:

```{r, eval = TRUE}


```


## 5.2 NMF for Apobec signatures [MONDAY EILEEN EMAIL]

Why NMF versus other method for GSEA? Should I compare these?

```{r, eval = TRUE}


```


## 5.3 CHIP
Some form of metabolomics and immune profiles would be interesting...

```{r, eval = TRUE}



```

## 5.4 TLT and TTL
```{r, eval = TRUE}



```

***Other Ideas and feedback***

From the older age paper:
+Percentage of deaths attributable to each factor
+Waterfall plot summarizing the CH mutations detected. Left panel showeing the VAF distribution of these mutations. 
+Boxplot suggesting patients iwth CH are older than the ones without CH
+Signature analysis of mutations suggesting they related  

+Any PAF graphs? PAF perhaps including - 

+CHIP data? Correct for age?

+Chromothripsis and chromoplexy don't quite make sense to include?

+Compare with BRFSS data? BMI distribution - perhaps would use mean year of diagnosis in this population -- would be able to extract based on what learned in class


# 6 RESULTS/DISCUSSION:

***ORIGINALLY FROM EILEEN***
We identified 1143 patients. 1122 had BMI information. The median BMI was 27.3 (13.6-61.6). 2% (n=22) were underweight, 30% (n=340) were within normal range, 38% (n=425) were overweight, and 30% (n=335) were obese. When sub setting the obese population according to WHO: 60% (n=202), were I 28% (n=95) were II, 11% (n=38) were III, and 6% (n=21) were stage IV. 
We assessed CH on WGS germline data. We noted that patients with CH had significantly smaller BMIs (27.4 (15.2-41.1) vs 26.4 (19.9-35.7) chi-squared = 4.534, df = 1, p-value = 0.03). 

(Is this not GSEA?) We performed an nNMF in order to identify the APOBEC mutational signature. These was no correlation between BMI and APOBEC mutational signature using BMI as a continuous variable (F=3, p=0.08) or segmented in groups (X2: 2.1, DF=3, p=0.5), Figure XXX. 
	
Telomere length has been associated with Aging and chronic aggressions. In myeloma, Tumour Telomere length has been associated with chromothrypsis, age, and an adverse outcome. In order to access the role of obesity, we matched BMI and 887 LTL and 779 TTL derived from WGS. As continuous variables, there were no correlations between BMI and both LTL and TTL. As discrete categories were concerned, there was a significant correlation between BMI and LTL (for group Chi 12, DF 3, p=0.006) and WHO classification (13.6 DF5, p=0.01). Interestingly, patients with a higher BMI had longer LTL (need to correct this data by age though!). Of note, there was no linear correlation between Age and BMI in this dataset (F-statistic: 3.225 on 1 and 958 DF,  p-value: 0.07 ). ***(However in the 758 patients with BMI data there does appear to be a correlation)*** 
	In terms of outcome, there were no difference in PFS according to BMI. 


# 7 CONCLUSIONS

# 8 REFERENCES
(1)
(2)
(3)
(4)
(5)
(6)


