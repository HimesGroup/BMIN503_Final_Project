---
title: "Razzo_Final Project Outline"
output: html_document
date: "2022-10-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##ABSTRACT:
Multiple myeloma (MM) is the second most common blood cancer diagnosis, with over 20,000 cases diagnosed each year in the United States. Age, race and genetic factors are known predisposing risk factors, but obesity is the only modifiable characteristic consistently implicated in the development of both MGUS and MM (Carson, Bates, and Tomasson 2014; Landgren et al. 2010; Wallin and Larsson 2011). Persons with excess body weight are 10-20% more likely to develop multiple myeloma, with an estimated number of 12,480 cases attributed to excess body weight in the United States between 2011-2015 (Islami et al. 2019).The pathophysiological basis of this association is not fully understood with systemic and marrow immune dysfunction as putative driver mechanisms. This study aims to identify any associations between excess body weight and ISS risk at diagnosis, adverse cytogenetics, RNA expression and telomere length. We will use BMI as a surrogate marker for excess body weight, recognizing this is an imperfect measure of adiposity. 

##METHODS:
Using your local version of the forked [Final Project Repo](https://github.com/HimesGroup/BMIN503_Final_Project) that is on your local computer, write the overview and introduction for your final project. The overview consists of 2-3 sentences summarizing the project and goals. For the introduction, the first paragraph describes the problem addressed, its significance, and some background to motivate the problem. 

In the second paragraph, explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff. 

Start working on the Methods/Results section, which consists of code and its output along with text describing what you are doing (Note: we will not check your code now, but you should have something in place before Assignment 6 is distributed).

##RESULTS:

#Descriptive Analyses of the population:

```{r cars}
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
library(tibble)
library(readr)

MMRFfull <- read.csv("~/Documents/BMIN 5030/Final Project/Raw Files/Razzo_MMRF raw csv.csv", header = T, fill = TRUE, row.name = NULL)
MMRFfull <- rename(MMRFfull, Patient_ID = Patient)

MMRFclean <- read.csv("~/Documents/BMIN 5030/Final Project/Raw Files/Razzo_MMRF clean csv.csv", header = T, fill = TRUE, row.name = NULL)
MMRFclean <- rename(MMRFclean, Sex = D_Gender, Race = D_Race, AgeDx = D_Age, BMIDx = BMI, ISSDx = D_ISS) %>%
  mutate(BMI_cat_4 = factor(BMI_cat_4, levels = c(0,1,2,3), labels = c("BMI <18.5", "BMI 18.5-25", "BMI 25-30", "BMI >30"))) %>%
  mutate(BMI_cat_6 = factor(BMI_cat_6, levels = c(0,1,2,3,4,5), labels = c("BMI <18.5", "BMI 18.5-25", "BMI 25-30", "BMI 30-35", "BMI 35-40", "BMI >40"))) %>%
  mutate(FU_status = factor(FU_status, levels = c(0,1), labels = c("Not censored", "Censored"))) %>%
  mutate(OS_status = factor(OS_status, levels = c(0,1), labels = c("Alive", "Dead")))


patientcharacteristics <- MMRFclean1 %>% gtsummary::tbl_summary()
MMRFclean1 %>% 
  dplyr::select(c(Sex, Race, AgeDx, BMI_cat_4, ISSDx, IMWG_Risk, Translocation_Summary)) %>%
  gtsummary::tbl_summary(by = BMI_cat_4) %>%
  gtsummary::add_p()

library(huxtable)
patientcharacteristics <- MMRFclean1 %>% gtsummary::tbl_summary()
MMRFclean1 %>% 
  dplyr::select(c(Sex, Race, AgeDx, BMI_cat_4, ISSDx, IMWG_Risk, Translocation_Summary)) %>%
  gtsummary::tbl_summary(by = BMI_cat_4) %>%
  gtsummary::add_p() %>%
  huxtable::quick_xlsx()

install.packages("huxtable")
huxtable::quick_xlsx()

install.packages("flextable")
library(flextable)
library(gt)
patientcharacteristics %>%
  as_flex_table() %>%
  flextable::save_as_docx()

patientcharacteristics %>%
  gt::as_gt() %>%
  gt::gtsave(filename = ".")

```

#Survival Analyses:

```{r cars}


head(survival)

km <- with(veteran, Surv(time, status))

km_fit <- survfit(Surv(time, status) ~ 1, data=veteran)
summary(km_fit, times = c(1,30,60,90*(1:10)))

#Raw
#Corrected for age

```


#DGE -- high vs non-elevated BMI groups:

```{r cars}

#Best way to represent this?

```

#NMF for Apobec signatures:
Why NMF versus other method for GSEA? Should I compare these?

```{r, eval = TRUE}


```

#GSEA -- looking at other pathways?
Some form of metabolomics and immune profiles would be interesting...

```{r, eval = TRUE}



```

#Other Ideas?

+SEER data?
+BRFSS data?

#Basic scripts from Eileen:

```{r cars, include = TRUE}

install.packages("dplyr")
install.packages("RColorBrewer")
install.packages("PairedData")
install.packages("ggplot2")
library("RColorBrewer")
library("dplyr")
library("PairedData")
library("ggplot2")

#Define a list of colors
mycolors=brewer.pal(8,"Set2")
mycolors
hist(1:10, col=mycolors)

#Calculate averages and SD. e.g. HRD
group_by(my_data, HRD ) %>%
  summarise(
    count = n(),
    mean = mean(HRD , na.rm = FALSE),
    sd = sd(HRD , na.rm = FALSE))

#Remove all the NA from your table. Be careful, you shouldn't do in on all your data
my_data=na.omit(my_data)

##BOXPLOTS:
##Version two: try replacing FALSE by TRUE
boxplot(Shannon~HRD, data=my_data,  col=mycolors, outline=FALSE)

##Statistics, to separate out value and chi-squared lines 52 and 53
mytest=kruskal.test(Shannon~Risk, my_data)
mytest$p.value
mytest$statistic

##Add the p-value to the plot
boxplot(Shannon~Risk, data=my_data,  col=c("red","green"), outline=FALSE)
mylabel1 = bquote(p == .(format(mytest$p.value, digits = 5)))
mylabel2 = bquote(Chi2==.(format(mytest$statistic, digits = 2)))
text(x=1.5, y=1.9, mylabel2)
text(x=1.5, y=1.85, mylabel1)

##PAIRED VARIABLES:
##Load the "weight" Obesity data"
###Subset the tables
# Subset weight data before treatment
before <- subset(poisson,  Study_ID == "before", BMI_dx,
                 drop = TRUE)
# subset weight data after treatment
after <- subset(poisson,  Study_ID == "after", BMI_dx,
                drop = TRUE)
# Plot paired data
pd <- paired(before, after)Study_ID
plot(pd, type = "profile", color= c("#00AFBB", "#E7B800")) + 
  theme_light()

##BARPLOTS:
# create a datase
d2 <- my_data %>% 
  group_by(Progressed,HRD) %>% 
  summarise(count=n())%>% 
  mutate(perc=count/sum(count))

d2=na.omit(d2)


#Create barplots
ggplot(d2, aes(fill=factor(HRD), y=perc, x=Progressed))+ 
  #add a barplot
  geom_bar(position="fill", stat="identity")+
  #choose the colors to fill
   scale_fill_manual(values=mycolors)+
  #remove the grey backgroung
  theme_light(base_size = 14)+
  #add test
  geom_text(aes(label=round(perc, digits = 2)), position=position_dodge(width=0.9), vjust=-0.25, colour="white")+
  labs(x = "Progression status", y = "Percent cats", fill = "Hyperdiploidy" )
  

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
