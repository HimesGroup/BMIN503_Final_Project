---
title: "Cleaning data 10/31"
output: html_document
---

```{r setup, error = FALSE, warning = FALSE, message = FALSE, include=FALSE}
options(scipen = 999)
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r}
library("tidyverse")
library("dplyr")
datafr <- purrr::map_dfr(
  .x = c(2008:2019), #add years here after loading txt file into USDA_Data folder
  .f = function(x){
    purrr::map_dfr(
  .x = c("C", "D", "E"),
  .f = function(x, y){
    #tibble(test = paste0("C:/Users/Deeksha Hegde/Downloads/BMIN503_Final_Project/USDA_Data/",y,"_col_",x,".txt")) #Testing if loop works correctly
    dat <- read.table(file = paste0("C:/Users/Deeksha Hegde/Downloads/BMIN503_Final_Project/USDA_Data/",y,"_col_",x,".txt"), header = TRUE, sep = "\t")
    dat %>%
      mutate(across(.cols = All_Other_Covered_Species:Total, .fns =~ as.numeric(str_remove_all(string = .x, ","))), 
        Year = y,
        Column = x
      )
  } ,y=x
    )
  }
)
datafr %>% count(Year, Column)
mutate(datafr, pain.level = factor(Column, levels = c("C", "D", "E"), labels = c(0, 1, 2)))
```

Include B as well

```{r}

data.total <- filter(datafr, State == "REPORT TOTAL")

#Total by year and column
ggplot(data = data.total, aes(x = Year, y = Total, color = Column)) + geom_line() + scale_x_continuous(breaks = c(2008:2019)) + scale_y_continuous(breaks = seq(100000, 700000, by = 100000)) +
theme(
        plot.title = element_text(size = 22, face = "bold", hjust = 0.5),
        axis.title = element_text(size = 10),
        axis.text = element_text(size = 10),
        legend.position = "bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10)
      )

#Total by year
data.total <- summarise(group_by(data.total, Year), Total = sum(Total))
ggplot(data = data.total, aes(x = Year, y = Total)) + geom_line() +
  scale_x_continuous(breaks = c(2008:2019))
```


```{r}
#Total by column for PA

data.PA <- filter(datafr, State == "PA")
ggplot(data = data.PA, aes(x = Year, y = Total, color = Column)) + geom_line()+
  scale_x_continuous(breaks = c(2008:2019))
```

```{r}
#Total by column by state

data.by.state <- datafr %>%
  filter(State != "REPORT TOTAL") %>%
  group_by(State, Column) %>%
  summarise(Total = sum(Total))
  
#max(data.by.state$Total, by = data.by.state$Column)   
ggplot(data.by.state, aes(x = State, y = Total, color = Column)) + geom_point()
```

Highest by column:
C CA, MA, OH
D CA, TX, MA
E MO, MI, IA