---
title: "Using Childhood and Adulthood Stress Factors as Predictors for Tobacco/Nicotine Use"
subtitle: "BMIN503/EPID600 Final Project"
author: "Katie Cardone"
format: html
editor: visual
embed-resources: true
---

------------------------------------------------------------------------

### Overview

Cigarette smoking is a major health problem in the United States, as it is the leading cause of preventable death. Many family-related problems/stress have been associated with increased smoking individually, but this study considers whether the combination of these risk factors in a machine learning approach can better predict smoking. This study will leverage data from the Behavioral Risk Factor Surveillance System 2022 survey, as this provides data on both family risk factors and tobacco use.

Link to github repository: [Github Repository](https://github.com/katiecardone26/BMIN503_Final_Project)

### Introduction

Cigarette smoking is the leading cause of preventable mortality^1^. 480,000 deaths per year in the United States are due to smoking^2^ and smokers die on average 10 years earlier compared to non-smokers^3^. Stress is a risk factor for smoking, as greater stress is associated with a higher odds of persistent smoking^4^. This includes family problems in the past year, which is particularly important as family problems doubles the odds of quitting failure^4^. Many studies have shown that a variety of family problems/stress factors in the home are associated with an increased prevalence of smoking. In one study, 81% of tobacco users had a family history of tobacco use^5^. Additionally, individuals with a history of child abuse are more likely to become smokers as adults^6^. More specifically, child sexual abuse predicted adolescent smoking frequency^7^. Maltreatment in childhood, including neglect and failure of caregivers to provide for child, is associated with smoking in adulthood^8^. Another study showed that substance use, including tobacco, was associated with past and present parental incarceration^9^. Parental divorce or separation in childhood was also associated with smoking in adulthood^10^.

Evidently, smoking is a major health problem and family issues individually seem to predict it. However, the project assesses whether the combination of these factors can better predict smoking. To properly create a model that answers this question, an interdisciplinary approach is most beneficial. This is a public health issue, so epidemiologists will provide insight on factors to consider when answering this question. Additionally, the outcome of interest is substance use, so psychiatrists can also provide useful knowledge. Last, this project will use a machine learning method, so computational biologists can provide insight on how to optimize the model.

### Methods

#### Loading Packages

The packages needed for this project are tidyverse, haven, modelr, randomForest, vip, tidymodels, and ggplot2.

```{r}
# tidyverse package
library(tidyverse)
# haven package
library(haven)
# modelr package
library(modelr)
# random forest package
library(randomForest)
# VIP package
library(vip)
# tidymodels
library(tidymodels)
# ggplot
library(ggplot2)
```

#### Downloading Data

The 2022 BRFSS data will be used for this analysis.

```{r}
# Load in data
brfss_raw <- as.tibble(read_xpt("LLCP2022.XPT"))
head(brfss_raw)
```

#### Cleaning Data

The BRFSS dataframe will be subset to the variables that will used in the analysis. The outcome of interest is nicotine use status. If an individual uses cigarettes, e-cigarettes, or other forms of nicotine at all, they are considered a nicotine user. Predictors include:

-   adult status

-   sex

-   days in a month of bad mental health

-   caregiver status

-   lived with someone who was depressed, mentally ill, or suicidal as a child

-   lived with an alcoholic or problem drinker as a child

-   lived with an illicit substance user or prescription substance abuser as child

-   lived with someone who was incarcerated as a child

-   had parents who were separated or divorced

-   had parents that sweared at them as a child

-   was abused, neglected or molested as a child

Most variables will be recoded such that they are binary variables (yes or no). Multiple molestation columns will be combined into one to reduce missingness. Individuals with a missing value in any column will be dropped.

```{r}
# subset to columns I need
brfss_clean <- brfss_raw |>
  select(LADULT1,COLGSEX1,CADULT1,CELLSEX1,MENTHLTH,SMOKDAY2,USENOW3,ECIGNOW2,CAREGIV1,ACEDEPRS,ACEDRINK,ACEDRUGS,ACEPRISN,ACEDIVRC,ACEHURT1,ACESWEAR,ACETOUCH,ACETTHEM,ACEHVSEX,ACEADNED)

# rename columns
brfss_clean <- rename(brfss_clean,adult_landline=LADULT1,
                      sex_landline=COLGSEX1,
                      adult_cell=CADULT1,
                      sex_cell=CELLSEX1,
                      days_mental_health_bad_past_month=MENTHLTH,
                      cigs_day_freq=SMOKDAY2,
                      other_forms_tobacco_day_freq=USENOW3,
                      ecigs_day_freq=ECIGNOW2,
                      caregiver_past_month=CAREGIV1,
                      lived_with_depressed_mentally_ill_or_suicidial=ACEDEPRS,
                      lived_with_alcoholic=ACEDRINK,
                      lived_with_hard_drug_user=ACEDRUGS,
                      lived_with_convict=ACEPRISN,
                      parents_separated_or_divorced=ACEDIVRC,
                      parents_hurt_you_freq=ACEHURT1,
                      parents_swear_at_you_freq=ACESWEAR,
                      sexual_touch_you_freq=ACETOUCH,
                      force_touch_others_sexually=ACETTHEM,
                      force_sex_freq=ACEHVSEX,
                      basic_needs_met_by_adult_amount_childhood=ACEADNED)

# recode columns
# combine landline and cell adult columns
# 1 = adult, 0 = child, NA = missing
brfss_clean <- brfss_clean %>%
  mutate(adult=paste0(adult_landline,adult_cell))
brfss_clean$adult=case_match(brfss_clean$adult,
                             c('1NA','NA1',11) ~ 1,
                             c('2NA','NA2',22) ~ 0,
                             'NANA' ~ NA)
# combine landline and cell sex columns
# 1 = male, 0 = female, NA = missing
brfss_clean <- brfss_clean %>%
  mutate(sex=paste0(sex_landline,sex_cell))
brfss_clean$sex=case_match(brfss_clean$sex,
                           c('1NA','NA1',11) ~ 1,
                           c('2NA','NA2',22) ~ 0,
                           'NANA' ~ NA)

# clean mental health column
# 0-30 = number of days with bad mental health, NA=missing
brfss_clean$days_mental_health_bad_past_month=case_match(brfss_clean$days_mental_health_bad_past_month,
                                                         1 ~ 1,
                                                         2 ~ 2,
                                                         3 ~ 3,
                                                         4 ~ 4,
                                                         5 ~ 5,
                                                         6 ~ 6,
                                                         7 ~ 7,
                                                         8 ~ 8,
                                                         9 ~ 9,
                                                         10 ~ 10,
                                                         11 ~ 11,
                                                         12 ~ 12,
                                                         13 ~ 13,
                                                         14 ~ 14,
                                                         15 ~ 15,
                                                         16 ~ 16,
                                                         17 ~ 17,
                                                         18 ~ 18,
                                                         19 ~ 19,
                                                         20 ~ 20,
                                                         21 ~ 21,
                                                         22 ~ 22,
                                                         23 ~ 23,
                                                         24 ~ 24,
                                                         25 ~ 25,
                                                         26 ~ 26,
                                                         27 ~ 27,
                                                         28 ~ 28,
                                                         29 ~ 29,
                                                         30 ~ 30,
                                                         c(77,99) ~ NA,
                                                         88 ~ 0)

# clean cigs_day_freq column
# 1 = every day or some days, 0 = not at all, NA = missing, no answer or inconclusive answer
brfss_clean$cigs_day_freq=case_match(brfss_clean$cigs_day_freq,
                                     1 ~ 1,
                                     2 ~ 1,
                                     3 ~ 0,
                                     c(7,9) ~ NA)

# clean other_forms_tobacco_day_freq column
# 1 = every day or some days, 0 = not at all, NA = missing, no answer or inconclusive answer
brfss_clean$other_forms_tobacco_day_freq=case_match(brfss_clean$other_forms_tobacco_day_freq,
                                                    1 ~ 1,
                                                    2 ~ 1,
                                                    3 ~ 0,
                                                    c(7,9) ~ NA)

# clean ecigs_day_freq column
# 1 = use them every day or some days, 0 = never or not right now, NA = missing, no answer or inconclusive answer
brfss_clean$ecigs_day_freq=case_match(brfss_clean$ecigs_day_freq,
                                c(1,4) ~ 0,
                                c(2,3) ~ 1,
                                c(7,9) ~ NA)

# clean caregiver_past_month columns
# 1 = yes or person caring for died in the past 30 days (need to see if those people answered subsequent questions), 0 = no, NA = missing, no answer or inconclusive answer
# need to make one caregiver score?
# maybe include employment status in this to see if it is interferring with work?
brfss_clean$caregiver_past_month=case_match(brfss_clean$caregiver_past_month,
                                            1 ~ 1,
                                            2 ~ 0,
                                            c(7,9) ~ NA,
                                            8 ~ 1)

# clean lived_with_depressed_mentally_ill_or_suicidial column
# 1 = yes, 0 = no, NA = missing, no answer, or inconclusive answer
brfss_clean$lived_with_depressed_mentally_ill_or_suicidial=case_match(brfss_clean$lived_with_depressed_mentally_ill_or_suicidial,
                                                                      1 ~ 1,
                                                                      2 ~ 0,
                                                                      c(7,9) ~ NA)

# clean lived_with_alcoholic column
# 1 = yes, 0 = no, NA = missing, no answer, or inconclusive answer
brfss_clean$lived_with_alcoholic=case_match(brfss_clean$lived_with_alcoholic,
                                            1 ~ 1,
                                            2 ~ 0,
                                            c(7,9) ~ NA)

# clean lived_with_hard_drug_user column
# 1 = yes, 0 = no, NA = missing, no answer, or inconclusive answer
brfss_clean$lived_with_hard_drug_user=case_match(brfss_clean$lived_with_hard_drug_user,
                                                 1 ~ 1,
                                                 2 ~ 0,
                                                 c(7,9) ~ NA)

# clean lived_with_convict column
# 1 = yes, 0 = no, NA = missing, no answer, or inconclusive answer
brfss_clean$lived_with_convict=case_match(brfss_clean$lived_with_convict,
                                          1 ~ 1,
                                          2 ~ 0,
                                          c(7,9) ~ NA)

# clean parents_separated_or_divorced column
# 1 = yes, 0 = no, NA = missing, no answer, or inconclusive answer
brfss_clean$parents_separated_or_divorced=case_match(brfss_clean$parents_separated_or_divorced,
                                                     1 ~ 1,
                                                     2 ~ 0,
                                                     c(7,9) ~ NA)

# clean parents_hurt_you_freq column
# 1 = once or more than once, 0 = never, NA = missing, no answer, or inconclusive answer
brfss_clean$parents_hurt_you_freq=case_match(brfss_clean$parents_hurt_you_freq,
                                             1 ~ 0,
                                             c(2,3) ~ 1,
                                             c(7,9) ~ NA)

# clean parents_swear_at_you_freq column
# 1 = once or more than once, 0 = never, NA = missing, no answer, or inconclusive answer
brfss_clean$parents_swear_at_you_freq=case_match(brfss_clean$parents_swear_at_you_freq,
                                                 1 ~ 0,
                                                 c(2,3) ~ 1,
                                                 c(7,9) ~ NA)

# clean sexual_touch_you_freq column
# 1 = once or more than once, 0 = never, NA = missing, no answer, or inconclusive answer
# maybe integrate with other molesting columns
brfss_clean$sexual_touch_you_freq=case_match(brfss_clean$sexual_touch_you_freq,
                                             1 ~ 0,
                                             c(2,3) ~ 1,
                                             c(7,9) ~ NA)

# clean force_touch_others_sexually column
# 1 = once or more than once, 0 = never, NA = missing, no answer, or inconclusive answer
# maybe integrate with other molesting columns
# turned freq column into a yes or no column
brfss_clean$force_touch_others_sexually <- case_match(brfss_clean$force_touch_others_sexually,
                                                      1 ~ 0,
                                                      c(2,3) ~ 1,
                                                      c(7,9) ~ NA)

# clean force_sex_freq column
# 1 = once or more than once, 0 = never, NA = missing, no answer, or inconclusive answer
# maybe integrate with other molesting columns
# turned freq column into a yes or no column
brfss_clean$force_sex_freq=case_match(brfss_clean$force_sex_freq,
                                      1 ~ 0,
                                      c(2,3) ~ 1,
                                      c(7,9) ~ NA)

# clean basic_needs_met_by_adult_amount_childhood column
# 1 = never, 2 = little, 3 = some, 4 = most, 5 = all, NA = missing, no answer, or inconclusive answer
# maybe make this into a hard score
brfss_clean$basic_needs_met_by_adult_amount_childhood=case_match(brfss_clean$basic_needs_met_by_adult_amount_childhood,
                                                                 1 ~ 1,
                                                                 2 ~ 2,
                                                                 3 ~ 3,
                                                                 4 ~ 4,
                                                                 5 ~ 5,
                                                                 c(7,9) ~ NA)

# create molesting column
# 1: answered yes to at least one of the questions, 0: answered no or missing to all the questions, NA: all questions missing
brfss_clean <- brfss_clean %>%
  mutate(molestation = paste0(sexual_touch_you_freq,force_touch_others_sexually,force_sex_freq))
brfss_clean$molestation <- case_match(brfss_clean$molestation,
                                      c('100','110','101','010','011','001','111','1NANA','NA1NA','11NA','NANA1','1NA1','NA11','10NA','NA01','0NA1','NA10','1NA0','01NA') ~ 1,
                                      c('000','0NA0','0NANA','NANA0','NA00','00NA','NA0NA') ~ 0,
                                      'NANANA' ~ NA)

# create smoking column
# 1: answered yes to at least one of the questions, 0: answereing no or missing to all questions, NA: all questions missing
brfss_clean <- brfss_clean %>%
  mutate(smoking=paste0(cigs_day_freq,other_forms_tobacco_day_freq,ecigs_day_freq))
brfss_clean$smoking <- case_match(brfss_clean$smoking,
                                  c('100','010','001','NA01','NA10','NA11','1NA1','110','011','101','NANA1','1NA0','0NA1','NA1NA','1NANA','111','10NA','11NA','01NA') ~ 1,
                                  c('NA00','000','NANA0','0NA0','NA0NA','00NA','0NANA') ~ 0,
                                  'NANANA' ~ NA)

# remove unneeded columns
brfss_clean <- brfss_clean %>%
  select(-adult_landline,-sex_landline,-adult_cell,-sex_cell,-cigs_day_freq,-other_forms_tobacco_day_freq,-ecigs_day_freq,-sexual_touch_you_freq,-force_sex_freq,-force_touch_others_sexually)

# drop nas
brfss_clean_no_missing <- brfss_clean %>%
  drop_na()
nrow(brfss_clean_no_missing)
head(brfss_clean_no_missing)

# convert smoking column (outcome) to factor
brfss_clean_no_missing$smoking=as.factor(brfss_clean_no_missing$smoking)
```

There are 8158 individuals in the model after cleaning.

#### Build and Run Random Forest Model

I am using a random forest model to combine the predictors and predict the outcome. I will be comparing using the model with and without 10-fold cross validation.

```{r}
# set seed
set.seed(1234)

# set random forest specs
rf_spec <- 
  rand_forest(trees = 1000, min_n = 5) |> 
  set_engine("randomForest", importance = TRUE) |>
  set_mode("classification")

# split dataset 80% train 20% test
brfss.split <- initial_split(brfss_clean_no_missing, 
                            strata = smoking, 
                            prop = 0.80)

brfss.allvars.split <- initial_split(brfss_clean_no_missing_all_vars, 
                            strata = smoking, 
                            prop = 0.80)

# create training dataset
brfss.train <- training(brfss.split)
brfss.train.allvars <- training(brfss.allvars.split)

# split dataset for 10 fold cross validation
brfss.training.folds <- vfold_cv(brfss.train, v = 10)
brfss.training.folds.allvars <- vfold_cv(brfss.train.allvars, v = 10)

# create rf workflow
rf_workflow <-
  workflow() |>
  add_model(rf_spec) |>
  add_formula(smoking ~ .)

# fit model with cross validation
brfss.rf.pred.values.crossval <-
  rf_workflow |>
  fit_resamples(brfss.training.folds, 
                control = control_resamples(save_pred = TRUE))

# fit model without cross validation
brfss.rf.predicted.nocrossval <- rf_spec |>
  fit(smoking ~ ., data = brfss_clean_no_missing)

# extract predicted values
brfss.rf.pred.values.nocrossval <-  bind_cols(
  truth = brfss_clean_no_missing$smoking,
  predict(brfss.rf.predicted.nocrossval, brfss_clean_no_missing),
  predict(brfss.rf.predicted.nocrossval, brfss_clean_no_missing, type = "prob"))
```

### Results

The following results will show:

-   Number of smokers and non-smokers

-   Most important predictors

-   Area under the curve for models with and without cross validation

-   ROC curve for models with and without cross validation

```{r}
# get the number of smokers and non-smokers in the model
brfss_clean_no_missing%>%
  group_by(smoking)%>%
  summarize(n())

# plot most important predictors
brfss.rf.predicted.nocrossval |>
  extract_fit_engine() |>
  vip()

# calculate AUC without cross validation
roc_auc(brfss.rf.pred.values.nocrossval, truth, .pred_0)

# calculate AUC with cross validation
brfss.rf.pred.values.crossval |>
  collect_predictions() |>
  roc_auc(smoking, .pred_0)

# make plot input without cross validation
brfss.rf.plot_input.nocrossval <- brfss.rf.pred.values.nocrossval |>
  roc_curve(truth, .pred_0)

# make plot input with cross validation
brfss.rf.plot_input.crossval <- brfss.rf.pred.values.crossval |>
  collect_predictions() |>
  roc_curve(smoking, .pred_0)

# plot ROC curve
brfss.rf.pred.values |>
  collect_predictions() |>
  roc_curve(smoking, .pred_0) |>
  ggplot(aes(x = 1-specificity, y = sensitivity)) +
  geom_path(data=brfss.rf.plot_input.crossval,aes(color='Cross Validation')) +
  geom_path(data=brfss.rf.plot_input.nocrossval,aes(color='No Cross Validation')) +
  geom_abline(lty = 3) +
  coord_equal() +
  labs(title='Using Child and Adult Stress Factors to Predict Smoking Status ROC Curve',subtile='n_nonsmokers=1482, n_smokers=6676') +
  theme_bw() +
  scale_color_manual(name='Models',
                     breaks=c('No Cross Validation', 'Cross Validation'),
                     values=c('No Cross Validation'='pink', 'Cross Validation'='blue'))
```

### Conclusion

The method modestly predicts non-smoking status. Without cross-validation, the area under the curve was 0.72. However, this was subjective to over fitting, as the area under the curve decreased to 0.64 when doing 10-fold cross validation. The most important predictors are days of bad mental health, lived with a hard drug user in childhood, sex, and lived with a convict in childhood. Based on previous studies, this makes sense. In summary, combining child and adult home stress factors in a random forest model modestly predicted non-smoking status.

### References

1.  Diseases and death. *Centers for Disease Control and Prevention* (2022). Available at: https://www.cdc.gov/tobacco/data_statistics/fact_sheets/fast_facts/diseases-and-death.html#:\~:text=Smoking%20is%20the%20leading%20cause%20of%20preventable%20death.&text=This%20is%20about%20one%20in,or%201%2C300%20deaths%20every%20day. (Accessed: 30th October 2023)

2.  U.S. Department of Health and Human Services. *The Health Consequences of Smoking-50 Years of Progress: A Report of the Surgeon General* (Department of Health and Human Services, Centers for Disease Control and Prevention, National Center for Chronic Disease Prevention and Health Promotion, Office on Smoking and Health, 2014).

3.  Jha, P. *et al.* 21st-century hazards of smoking and benefits of cessation in the United States. *New England Journal of Medicine* **368,** 341--350 (2013).

4.  Slopen, N. *et al.* Psychosocial stress and cigarette smoking persistence, cessation, and relapse over 9--10 years: A prospective study of middle-aged adults in the United States. *Cancer Causes & Control* **24,** 1849--1863 (2013).

5.  Pathak, R., Dwivedi, S., Agarwalla, R. & Ali, W. The intergenerational transmission of tobacco habit: Role of parents and the family. *Journal of Family Medicine and Primary Care* **5,** 373--377 (2016).

6.  Eve, S. G. *et al.* Relationship between child abuse and adult smoking. *Int J Psychiatry Med* **39,** 417--426 (2009).

7.  Kristman-Valente, A. N., Brown, E. C. & Herrenkohl, T. I. Child physical and sexual abuse and cigarette smoking in adolescence and adulthood. *Journal of Adolescent Health* **53,** 533--538 (2013).

8.  Taha, F., Galea, S., Hien, D. & Goodwin, R. D. Childhood maltreatment and the persistence of smoking: A longitudinal study among adults in the US. *Child Abuse & Neglect* **38,** 1995--2006 (2014).

9.  Davis, L. & Shlafer, R. J. Substance use among youth with currently and formerly incarcerated parents. *Children of Incarcerated Parents* **87,** 42--57 (2018).

10. Lindström, M. & Rosvall, M. Parental separation/divorce in childhood and tobacco smoking in adulthood: A population-based study. *Scandinavian Journal of Public Health* **48,** 657--666 (2019).

11. 
