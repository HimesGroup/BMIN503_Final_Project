---
title: "BMIN503/EPID600 Final Project Madeleine: The Relationship Between Diabetes and Dental Health"
author: "Madeleine Salwen"
output: 
  html_document:
    toc: true
    toc_float: 
        collapsed: true
        smooth_scroll: true
    depth: 3 
    theme: flatly
    highlight: pygments
---

***

# Overview
The purpose of this project is to explore the relationship between dental health and Type 1 diabetes diagnosis considering possible co-variates such as smoking and food insecurity. To do so, I will be using NHANES data from the past 18 years (minus the covid years). My two advisors are Blanca Himes, PhD, Epidemiology, and Kira Nightingale from the epidemiology department who works in the dental school. Dr Himes has been very helpful in figuring out the question and how to use the NHANES data. Kira Nightingale was vital in assisting me with the dmft score as a metric of dental health.  

https://github.com/msalwen19/BMIN503_Final_Project

# Introduction 
Diet is a vital tool in type 1 diabetes management in order to keep blood glucose levels near normal. Technological advancements in insulin therapies such as insulin pumps and flexible injection regiments have drastically improved the lifestyle of children and adults with diabetes. It is still necessary to calculate carbohydrate intake at each meal to account for the appropriate amount of insulin. A review by Rovner suggests that children with diabetes eat more processed foods because packaged items are appealing to facilitate carbohydrate counting. (1) In instances of hypoglycemia, fast acting carbohydrates are required to quickly raise glucose levels. Often, simple sugars like glucose tablets or skittles and other candy are used because they provide fast acting relief. (2) Overall, these dietary practices may affect dental health. Countless studies have shown the relationship between sugar intake and an increased risk of dental caries. Processed foods also tend to contain more sugar, or additives that can damage oral health. Lastly, the higher glucose levels in blood, is also true in saliva, creating an ideal breeding ground for bacteria in the mouth. (3) There is precedent for the relationship between diabetes and dental health, however, my research has only seen instances of type 2 diabetes or diabetes in general investigated. I am interested in specifically isolated type 1 cases to see if these could be statistically significant from type 2 as the diseases have different mechanisms. 

This issue can be understood through an interdisciplinary approach. Diabetes and dental health must be investigated through a broader public health lens to account for factors such as access to dental care, smoking status, and food insecurity in addition to the clinical factors of dental outcomes and diabetes type. I will use the NHANES data set over multiple years, and practices of statistical models to investigate the data. Fields that can contribute to this understanding are epidemiological, statistical, dental, and endocrine. 

# Methods

This report incorporates theNHANES questionnaire and examination data sets from 2001 - 2018. Covid years were not considered due to complications of missing and repeated data. Data cleaning was necessary to isolate variables and rename factors to represent desired data. 

### Useful packages

```{r, eval = FALSE}
install.packages("nhanesA")
install.packages("plyr")
install.packages("rgdal")
install.packages("sf")
install.packages("tidycensus")
install.packages("ggsn")
install.packages("leaflet")
```
```{r global options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```   
```{r}
library(nhanesA)#nhanes data
library(plyr) #cleaning
library(dplyr) #cleaning
library(tidyverse)
library(ggplot2) #plots
library(GGally)
library(gtsummary) #nice table
library(ggforce) #for the zoom on the graph
library(modelsummary)
library(lemon) #to print pretty data frames 
```

## Loading in the data

```{r}
varlist <- c("DEMO", "DIQ", "OHQ", "SMQ", "FSQ") 
varlist_years <- paste0(rep(varlist, each = 9), c("_B", "_C", "_D", "_E","_F","_G","_H","_I","_J")) #creates a list with the necessary data sets with which to call in the next step
list_all <- sapply(varlist_years, function(x) {data.frame(nhanes(x))}) #loads in data from the R package nhanes for the chosen data sets and years

#Create a data frame for each section of questions ex DEMO
for(i in 1:length(list_all)) {
  assign(names(list_all)[i], list_all[[i]])
} 

#Combine section questions from each year into one larger data frame and remove the year individual data frames
for (i in 1:length(varlist)) {
  assign(varlist[i], plyr::rbind.fill(mget(grep(varlist[i], ls(), value = T))))
} 
rm(list = grep("_[BCDEFGHIJ]", ls(), value = T)) #cleans the environment 

nhanes.data <- full_join(get(varlist[1]), get(varlist[2]), by = "SEQN") #join the data frames. only 2 can be joined at a time. 
```

## Cleaning the data

```{r}
nhanes.data <- nhanes.data %>%
  dplyr::rename(have_diabetes = DIQ010, age_when_diagnosed = DID040, 
                taking_insulin = DIQ050, how_long_insulin = DID060, A1C = DIQ280,
                take_metformin = DIQ070) %>%
  dplyr::rename(house_income = INDHHIN2, pregnant = RIDEXPRG) %>%
  dplyr::rename(sex = RIAGENDR, age = RIDAGEYR, 
           race = RIDRETH1, education = DMDEDUC2) %>% 
  dplyr::mutate(sex = factor(sex, levels = c(1, 2), 
                           labels = c("men", "women"))) %>%
  dplyr::mutate(race = factor(race, levels = c(3, 1, 2, 4, 5),
                         labels = c("White", "MexicanAmerican", 
                                    "Hispanic", "Black", "Other"))) %>%
  dplyr::mutate(education = factor(education, levels = c(1,2,3,4,5,7,9), 
                                   labels = c("< 9th grade", "9-11th", "HS or GED", 
                                              "some college or AA", ">= college graduate", 
                                              "refused", "don't know")))

nhanes.data <- nhanes.data %>% 
  dplyr::select(-contains(c("DIQ", "DID", "DMD", "IND", "DMQ", "RID", "WT"))) %>% #deletes everything that contains words that I found I didn't want 
  dplyr::select(-FIAINTRP, -FIALANG, - FIAPROXY,  -MIAINTRP, 
                -MIALANG, -MIAPROXY, -AIALANG, -AIALANGA,  
                -SDDSRVYR, -SDMVPSU, -SDMVSTRA, -SIAINTRP, -SIALANG, -SIAPROXY) #and deleting the rest of variables I didn't want

#OHQ data
OHQ <- OHQ %>%
  dplyr::rename(taste_affect = OHQ650, avoid_food = OHQ660, difficulty_eating = OHQ670) %>%
  dplyr::rename(tooth_loose = OHQ855, tooth_looks_wrong = OHQ865) %>%
  dplyr::rename(last_dentist = OHQ030, fluoride = OHQ566, aching = OHQ620, difficulty_bc_teeth = OHQ640,
           embarrassed_bc_teeth = OHQ680, not_recieve_dental = OHQ770,
           reason_no_dental_cost = OHQ780A, reason_no_dental_money = OHQ780B, 
           reason_no_dental_insurance = OHQ780C, reason_no_dental_distance = OHQ780D,
           reason_no_dental_open = OHQ780E, reason_no_dental_recommended = OHQ780F,
           reason_no_dental_afraid = OHQ780G, reason_no_dental_work = OHQ780H,
           reason_no_dental_busy = OHQ780I,reason_no_dental_dissapear = OHQ780J,
           reason_no_dental_other = OHQ780K,
           gum_disease = OHQ835, rate_dental_health = OHQ845, 
           gum_disease_treatment = OHQ850, lost_bone = OHQ860) 

OHQ <- OHQ %>%
  dplyr::mutate(gum_disease = factor(gum_disease, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(rate_dental_health = factor(rate_dental_health, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Excellent", "Very Good", "Good", 
                                              "Fair", "Poor", "Refused", "Don't know"))) %>%
  dplyr::mutate(gum_disease_treatment = factor(gum_disease_treatment, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(tooth_loose = factor(tooth_loose, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(lost_bone = factor(lost_bone, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(tooth_looks_wrong = factor(tooth_looks_wrong, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(last_dentist = factor(last_dentist, levels = c(1,2,3, 4, 5, 6, 7, 77, 99), 
                                   labels = c("<6mo", "6mo < x < 1yr", "1yr < x < 2yr", 
                                              "2yr < x < 3yr", "3yr < x < 5yr", ">5yr",
                                              "Never", "Refused", "Don't know"))) %>%
  dplyr::mutate(aching = factor(aching, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(difficulty_bc_teeth = factor(difficulty_bc_teeth, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(embarrassed_bc_teeth = factor(embarrassed_bc_teeth, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(taste_affect = factor(taste_affect, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(avoid_food = factor(avoid_food, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(difficulty_eating = factor(difficulty_eating, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) 

OHQ <- OHQ %>% 
  dplyr::select(-contains(c("OHQ", "OHD")))
#join OHQ
nhanes.data <- nhanes.data %>%
    full_join(OHQ, by = "SEQN")

#SMQ data
SMQ <- SMQ %>%
  dplyr::select(SMQ020, SMD030, SMQ040, SMQ900, SEQN) %>%
  dplyr::rename(hundred_cigs = SMQ020, smoke_cigs = SMQ040, e_cigs = SMQ900, age_started_smoking = SMD030) %>%
  dplyr::mutate(hundred_cigs = factor(hundred_cigs, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know"))) %>%
  dplyr::mutate(smoke_cigs = factor(smoke_cigs, levels = c(1, 2, 3, 7,9), 
                           labels = c("everyday", "some days", "not at all", 
                                      "refused", "don't know"))) %>%
  dplyr::mutate(e_cigs = factor(e_cigs, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know")))
#join SMQ with the other data frame
nhanes.data <- nhanes.data %>%
    full_join(SMQ, by = "SEQN")  

#FSQ data
FSQ <- FSQ %>%
  dplyr::select(FSD032A, FSD032B, FSD032C, FSDAD, FSDCH, FSD041, FSD052, SEQN) %>%
  dplyr::rename(worried_run_out = FSD032A, food_didnt_last = FSD032B, 
                no_balanced_meals = FSD032C, adult_food_security = FSDAD, 
                child_food_security = FSDCH, skip_meals = FSD041, 
                how_often_skip_meals = FSD052)
FSQ <- FSQ %>%
  dplyr::mutate(worried_run_out = factor(worried_run_out, levels = c(1,2,3, 7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(food_didnt_last = factor(food_didnt_last, levels = c(1,2,3, 7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(no_balanced_meals = factor(no_balanced_meals, levels = c(1,2,3,7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(skip_meals = factor(skip_meals, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know"))) %>%
  dplyr::mutate(adult_food_security = factor(adult_food_security, levels = c(1,2,3,4), 
                           labels = c("full", "marginal", "low", "very low")))

#join FSQ with the other data frame
nhanes.data <- nhanes.data %>%
    full_join(FSQ, by = "SEQN")
``` 

## Creating a new column for diabetes type

Categorization was required to introduce a new variable diabetes_type. This variable attempted to distinguish between type 1 and type 2, as well as label those who didn't have diabetes. The type 1 and 2 distinction was performed by separating patients with diabetes by answers to questions on metformin and insulin. Metformin is a common blood sugar management drug usually used by patients with type 2 diagnosis. Insulin can be used by both types of diabetes but is vital for patients with type 1 status. (4) Thus, in categorizing these questions, I am able to get a good estimate of diabetes type. All other patients including those considered pre-diabetic were assigned a "No diabetes" status. 

```{r}
nhanes.data <- nhanes.data %>%
  dplyr::filter(have_diabetes != "NA") #removing NA because this is the most important question

nhanes.data <- nhanes.data %>%
     mutate(diabetes_type1 = ifelse(have_diabetes == 1 & 
           take_metformin == 2 & 
           taking_insulin == 1, "Type 1", "")) #assigning type 1 patients based on insulin and metformin use

nhanes.data <- nhanes.data %>%
  dplyr::mutate(diabetes_type2 = ifelse(have_diabetes == 1 & 
                                          diabetes_type1 != "Type 1", "Type 2", "")) #everyone with diabetes who isn't type 1 is type 2

nhanes.data <- nhanes.data %>%
  dplyr::mutate(diabetes_type0 = ifelse(have_diabetes != 1, "No Diabetes", "")) #Everyone without diabetes 

nhanes.data <- nhanes.data %>%
  dplyr::mutate(diabetes_type = paste(diabetes_type1, diabetes_type2, diabetes_type0)) %>% #combining into one variable
  dplyr::mutate(diabetes_type = as.factor(diabetes_type)) %>% #convert to factor
  dplyr::filter(!grepl("NA",diabetes_type)) #remove any NA (for it they answered NA to the insulin/metformin q)
  

nhanes.data %>%
  count(diabetes_type) #counting by diabetes type to make sure I have enough patients 
```

## Creating a dmft score

Additionally, the variable dmft score was created. A dmft score is a metric used by dentists to monitor dental health status. (5) Teeth are given a score of 1 if they are decayed, missing due to carries, or filled permanent teeth. The score does not consider wisdom teeth (3rd molars). Thus, a high dmft score indicates poorer dental health. The score is ranges from 0 - 28 with 28 being the highest, and least healthy score. In this report, dmft score was calculated by assignment of 0 or 1 status to each tooth in the tooth examination data and was treated as a continous variable in regressional analysis. The examination data from the data sets D, E, and F corresponding to years 2005 - 2010 could not be considered because they did not include the tooth by tooth examination required to calculate the dmft score. However, these years were included in other models of dental health such as the existance of gum disease in patients. 

Kira Nightingale helped assisted with this step. The code cycles through 

A - Z codes given in the data correspond to the status of the teeth. For the dmft score a 1 means that the tooth is missing due to carries and a zero means the tooth is not counted in the dmft score (it is healthy or gone for a different reason).

```{r}
#load the dentition data
dentition <- c("OHXDEN") 
dentition_years <- paste0(rep(dentition, each = 6), c("_B", "_C","_G","_H","_I","_J"))
list_all_dentition <- sapply(dentition_years, function(x) {data.frame(nhanes(x))}) 
for(i in 1:length(list_all_dentition)) {
  assign(names(list_all_dentition)[i], list_all_dentition[[i]])
} 

OHXDEN_I <- OHXDEN_I %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3) #I saw that there is no missing data for this but the 2 and 3 status code means the data is incomplete
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_I)[i], "new")
  OHXDEN_I <- mutate(OHXDEN_I, !!newname := ifelse(!!as.name(names(OHXDEN_I)[i])
                              %in% c("A", "E", "F", "K", "P", "R", "T", "Z"), 1, 0)) #assign 1 or 0 to every variable as explained above
} 
OHXDEN_I <- OHXDEN_I %>%
  dplyr::mutate(dmftI = rowSums(OHXDEN_I[,c(171:198)])) #here is summing them up and creating a new column


OHXDEN_B <- OHXDEN_B %>% 
  dplyr::filter(OHAEXSTS!=2 & OHAEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC", "DI", "TR")))
for (i in 38:65) {
  dmft_tally <- paste0(names(OHXDEN_B)[i], "dmft")
  OHXDEN_B <- mutate(OHXDEN_B, !!dmft_tally := ifelse(!!as.name(names(OHXDEN_B)[i])
                              %in% c("E", "K", "R", "Z"), 1, 0)) #the reason that the A-Z are different here is because 2015 included some new distinctions that were not always there. 
}
OHXDEN_B <- OHXDEN_B %>%
  dplyr::mutate(dmftB = rowSums(OHXDEN_B[,c(86:113)]))



OHXDEN_C <- OHXDEN_C %>% 
  dplyr::filter(OHAEXSTS!=2 & OHAEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC")))
for (i in 38:65) {
  newname <- paste0(names(OHXDEN_C)[i], "dmft")
  OHXDEN_C <- mutate(OHXDEN_C, !!newname := ifelse(!!as.name(names(OHXDEN_C)[i])
                              %in% c("E", "K", "R", "Z"), 1, 0))
}
OHXDEN_C <- OHXDEN_C %>%
  dplyr::mutate(dmftC = rowSums(OHXDEN_C[,c(122:149)]))



OHXDEN_G <- OHXDEN_G %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3)
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_G)[i], "new")
  OHXDEN_G <- mutate(OHXDEN_G, !!newname := ifelse(!!as.name(names(OHXDEN_G)[i])
                              %in% c("E", "K", "P", "R", "Z", "T"), 1, 0))
}
OHXDEN_G <- OHXDEN_G %>%
  dplyr::mutate(dmftG = rowSums(OHXDEN_G[,c(111:138)]))

OHXDEN_H <- OHXDEN_H %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3)
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_H)[i], "new")
  OHXDEN_H <- mutate(OHXDEN_H, !!newname := ifelse(!!as.name(names(OHXDEN_H)[i])
                              %in% c("E", "K", "P", "R", "Z", "T"), 1, 0))
}
OHXDEN_H <- OHXDEN_H %>%
  dplyr::mutate(dmftH = rowSums(OHXDEN_H[,c(111:138)]))


OHXDEN_J <- OHXDEN_J %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC", "RTC", "RSC")))
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_J)[i], "new")
  OHXDEN_J <- mutate(OHXDEN_J, !!newname := ifelse(!!as.name(names(OHXDEN_J)[i])
                              %in% c("A", "E", "F", "K", "P", "R", "T", "Z"), 1, 0))
} 
OHXDEN_J <- OHXDEN_J %>%
  dplyr::mutate(dmftJ = rowSums(OHXDEN_J[,c(87:114)]))

#select only important variables 
OHXDEN_I <- OHXDEN_I %>% 
  dplyr::select(SEQN, dmftI)
OHXDEN_B <- OHXDEN_B %>% 
  dplyr::select(SEQN, dmftB)
OHXDEN_C <- OHXDEN_C %>% 
  dplyr::select(SEQN, dmftC)
OHXDEN_G <- OHXDEN_G %>% 
  dplyr::select(SEQN, dmftG)
OHXDEN_H <- OHXDEN_H %>% 
  dplyr::select(SEQN, dmftH)
OHXDEN_J <- OHXDEN_J %>% 
  dplyr::select(SEQN, dmftJ)

#join the data
nhanes.data <- nhanes.data %>%
  full_join(OHXDEN_B, by = "SEQN")%>%
  full_join(OHXDEN_C, by = "SEQN")%>%
  full_join(OHXDEN_G, by = "SEQN")%>%
  full_join(OHXDEN_H, by = "SEQN")%>%
  full_join(OHXDEN_I, by = "SEQN")%>%
  full_join(OHXDEN_J, by = "SEQN")

nhanes.data <- nhanes.data %>%
  unite(., col = "dmft",  dmftB, dmftC, dmftG, dmftH, dmftI, dmftJ, na.rm=TRUE, sep = "") #making a column dmft instead of separate ones for each year

nhanes.data <- nhanes.data %>%
  dplyr::mutate(dmft2 = as.numeric(dmft)) #need to turn into numeric not factor. The reason I didn't overwrite the dmft is because wanted to ensure the 0 stayed 0 and wasn't moved around. 

```

##  Overview of the diabetes data

``` {r}
nhanes.data %>%
  dplyr::select(c(age, sex, race, diabetes_type)) %>%
  tbl_summary(by = diabetes_type,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Patient Characteristics Grouped By Diabetes Type**") %>%
  bold_labels()
```

This table indicates as a first look that there does not seem to be much difference between demographics of the diabetes type. This is good because it means that there is less chance for confounding variables. 

# Results


## Comparing diabetes status with dmft score 

```{r}
nhanes.data <- nhanes.data %>%
  dplyr::filter(grepl("Type",diabetes_type) | grepl("Diabetes",diabetes_type)) #I am having so much trouble getting NA not to appear I don't know why

ggplot(data = nhanes.data, aes(dmft2, diabetes_type)) +
    geom_boxplot() +
    ggtitle("Comparing Diabetes Type to Dmft Score") +
    labs(y= "diabetes type", x = "dmft score") 
```

At a first glance, it seems that there may be an association. With both types of diabetes leading to a higher dmft score.

## Regressions of dmft score 

```{r}
summary((lm(dmft2 ~ diabetes_type, data = nhanes.data)))
 #regression for just difference between type 1 and type 2, excluding those who don't have diabetes. 
nhanes.diabetes <- nhanes.data %>% 
  dplyr::filter(diabetes_type != "  No Diabetes") 
summary((lm(dmft2 ~ diabetes_type, data = nhanes.diabetes))) 
```
It seems that diabetes in general, type 1 and type 2 are statistically significant when compared to the dmft score of those without diabetes. However, the difference between diabetes type 1 and type 2 are not statistically significant. 


## Judging dental health through questionnaire data

Here I compare diabetes type to other factors of proxies of dental health: gum disease, tooth is loose, lost bone in mouth, and answer to the question of does dental pain create difficulty going about daily life? Overall, these should give a picture of dental health for the patients and how it impacts their lives. For each variable, I included a bar plot that considered counts of each dental health response when patients were grouped by diabetes type. However, due to many more patients reporting that they did not have diabetes, the graph is much better interpretable by the table below. 


### Gum disease
Answers the question if the patient had ever been diagnosed with gum disease. 

```{r}
knit_print.data.frame <- lemon_print

nhanes.gumdisease <- nhanes.data %>%
   filter(gum_disease != "NA" & gum_disease != "Refused" & gum_disease != "Don't know")

nhanes.data.gumdisease <- nhanes.data %>% 
  group_by(diabetes_type, gum_disease) %>%
  filter(gum_disease != "NA" & gum_disease != "Refused" & gum_disease != "Don't know") %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, gum_disease)

ggplot(data = nhanes.gumdisease, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(gum_disease))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 3000)) +
    labs(x = 'diabetes type', y = 'count', fill = 'gum disease') +
    ggtitle("Relationship Between Diabetes Type and Gum Disease")


knitr::kable(nhanes.data.gumdisease, col.names = c("Percent  ",
                           "Diabetes type   ", "   Gum Disease"), align = "lll") 
  
```
The table indicates that gum disease seems more likely for patients with either type 1 or type 2 diabetes. A regression model was applied to check for significance.
```{r}
summary(glm(gum_disease ~ diabetes_type, data = nhanes.data, family = binomial(logit)))
summary(glm(gum_disease ~ diabetes_type, data = nhanes.diabetes, family = binomial(logit)))
```
Once again, both type 1 and type 2 diabetes were statistically significant against people who didn't have diabetes. However, the difference between type 1 and type 2 is not significant.

### Loose tooth
Answers the question if the patient ever felt they had a loose permanent tooth, an indicator of poor dental health. 

```{r}
nhanes.loose.tooth <- nhanes.data %>%
  filter(tooth_loose != "NA" & tooth_loose != "Refused" & tooth_loose != "Don't know")
ggplot(data = nhanes.loose.tooth, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(tooth_loose))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 1500)) +
    labs(x = 'diabetes type', y = 'count', fill = 'loose tooth status') +
    ggtitle("Relationship Between Diabetes Type and Loose Teeth")


nhanes.data.loose.tooth <- nhanes.loose.tooth %>% 
  group_by(diabetes_type, tooth_loose) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100)%>%
  select(percent_per_factor, diabetes_type, tooth_loose)

knitr::kable(nhanes.data.loose.tooth, col.names = c("Percent  ",
                           "Diabetes type   ", "   Loose tooth?"), align = "lll") 
```

Again it seems that people with diabetes seem to respond "yes" to tooth looks wrong more than those who don't.

```{r}
summary(glm(tooth_loose ~ diabetes_type, data = nhanes.data, family = binomial(logit)))
summary(glm(tooth_loose ~ diabetes_type, data = nhanes.diabetes, family = binomial(logit)))
```
Both type 1 and type 2 diabetes were statistically significant against people who didn't have diabetes. However, the difference between type 1 and type 2 is not significant.

### Lost bone
Did a doctor tell the patient that they had lost bone around their teeth?

```{r}
nhanes.lost.bone <- nhanes.data %>%
  filter(lost_bone != "NA" & lost_bone != "Refused" & lost_bone != "Don't know") 
ggplot(data = nhanes.lost.bone, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(lost_bone))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 2000)) +
    labs(x = 'diabetes type', y = 'count', fill = 'lost bone') +
    ggtitle("Relationship between Diabetes Type and Lost Bone around Mouth")


nhanes.data.lost.bone <- nhanes.lost.bone %>% 
  group_by(diabetes_type, lost_bone) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, lost_bone)

knitr::kable(nhanes.data.lost.bone, col.names = c("Percent  ",
                           "Diabetes type   ", "   Lost bone"), align = "lll")

summary(glm(lost_bone ~ diabetes_type, data = nhanes.data, family = binomial(logit)))
summary(glm(lost_bone ~ diabetes_type, data = nhanes.diabetes, family = binomial(logit)))
```

Both type 1 and type 2 diabetes were statistically significant against people who didn't have diabetes. Here type 1 diabetes is close to significant compared to diabetes type 2, but not quite. 

### Tooth difficulty 
Did they ever have difficulty completing daily tasks due to dental pain?

```{r}
nhanes.tooth.difficulty <- nhanes.data %>%
  dplyr::filter(difficulty_bc_teeth != "NA" & difficulty_bc_teeth != "Refused" & difficulty_bc_teeth != "Don't know")

ggplot(data = nhanes.tooth.difficulty, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(difficulty_bc_teeth))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 2000)) +
    labs(x = 'diabetes type', y = 'count', fill = 'tooth difficulty questionnaire') +
    ggtitle("Relationship Between Diabetes Type and Reported Difficulty due to Dental Pain")


nhanes.data.difficulty <- nhanes.data %>% 
  group_by(diabetes_type, difficulty_bc_teeth) %>%
  filter(difficulty_bc_teeth != "NA" & difficulty_bc_teeth != "Refused" & difficulty_bc_teeth != "Don't know") %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, difficulty_bc_teeth)

knitr::kable(nhanes.data.difficulty, col.names = c("Percent  ",
                           "Diabetes type   ", "   Difficulty"), align = "lll")

summary(glm(difficulty_bc_teeth ~ diabetes_type, data = nhanes.data, family = binomial(logit)))
summary(glm(difficulty_bc_teeth ~ diabetes_type, data = nhanes.diabetes, family = binomial(logit)))
```

Diabetes status is significant compared to non-diabetes status, but not type 1 vs type 2.


## Examining possible co-variates

### Cigarette smoking

Here cigarette smoking is examined as a possible co-variate. Tobacco from cigarettes in a well established mechanism for poor dental health. I used the answer to the question "Have you smoked 100 cigarettes" as a proxy for smoking because this would include people who had smoked and quit as well as current smokers. I looked at the proportion of respondents answering yes to smoking and saw that a greater percentage of diabetes patients do smoke. This confirmed my reasoning for adjusting for this variable. I also ensured that the dmft score would indicate a statistically significant relationship between smoking status and dmft score. This also works to confirm my methedology for the diabetes type compared to dmft score because there is already an established relationship for smoking. 

```{r}
cigarette.counts <- nhanes.data %>%
  dplyr::filter(hundred_cigs != "refused" & hundred_cigs != "don't know") %>%
  group_by(diabetes_type) %>%
  count(hundred_cigs)
knitr::kable(cigarette.counts)


nhanes.hundred.cigs <- nhanes.data %>%
  dplyr::filter(hundred_cigs == "yes" | hundred_cigs == "no")
ggplot(data = nhanes.hundred.cigs, aes(dmft2, hundred_cigs)) +
    geom_boxplot() +
    ggtitle("Dmft score to whether patient smoked 100 cigarettes") +
    labs(y= "hundred cigarettes", x = "dmft score") 


summary((lm(dmft2 ~ hundred_cigs, data = nhanes.hundred.cigs))) 
```

Regression was significant for smoking relation to worse dmft score. I then decided to redo the previous dmft score with diabetes type, but this time exclude those who reported yes for smoking one hundred cigarettes. 

```{r}
nhanes.no.smoking <- nhanes.data%>%
  dplyr::filter(hundred_cigs != "yes") 
ggplot(data = nhanes.no.smoking, aes(dmft2, diabetes_type)) +
    geom_boxplot() +
    ggtitle("Diabetes type with dmft score excluding those who smoked 100 cigarettes")+
    labs(y= "diabetes type", x = "dmft score") 

summary((lm(dmft2 ~ diabetes_type, data = nhanes.no.smoking)))
```

I found that the data was still statistically significant and diabetes type 1 and 2 were higher than patients without diabetes. 
I then compared the effectiveness of regression models when considering hundred cigarettes smoking status as a co-variate. The three regressions below refer to clm1 = significance of diabetes type alone, clm 2 = significance of diabetes type and one hundred cigarettes, clm 3 =  significance of diabetes type and one hundred cigarettes but the people who both smoke one hundred cigarettes and have diabetes are not overly weighted the way that they are in clm 2. In this way clm 2 allows for the intercept of the regression to change for a better fit, and clm 3 allows for the slope of the regression to also change for a better fit. 

```{r}
clm1 <- lm(dmft2 ~ diabetes_type, data = nhanes.data)
clm2 <- lm(dmft2 ~ diabetes_type + hundred_cigs, data = nhanes.data)
clm3 <- lm(dmft2 ~ diabetes_type + hundred_cigs + hundred_cigs:diabetes_type, data = nhanes.data)

modelsummary(list(clm1, clm2, clm3), coef_omit = "Intercept",
             statistic = c("p = {p.value}"),
             estimate = "{estimate} [{conf.low}, {conf.high}]")

```

It seems that both the original model and new one with the hundred cigarettes as a co-variate were equally effective. Model 3 is worse, indicating that cigarette smoking should not be considered as a co-variate and allowing it to change the slope, reduces the efficacy of the model. 

### Food Security

I decided to also look into the variable of food security. Type 2 diabetes can be very related to malnutrition and food intake. Additionally, types of food and malnutrition can impact dental health (6). I considered that there malnutrition could thus be a co-variate. To study malnutrition, I looked at the adult food security a factor with 4 categories: full, marginal, low, and very low. 

I first looked at an overview of the data and a breakdown of who experienced food insecurity with regard to race, sex, age, and diabetes type in order to learn more about who experienced food insecurity. 

```{r}
nhanes.data %>%
  dplyr::select(c(age, sex, race, adult_food_security)) %>%
  tbl_summary(by = adult_food_security,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Patient Characteristics Grouped By Adult Food Security**") %>%
  bold_labels() 

nhanes.data %>%
  dplyr::select(c(diabetes_type, adult_food_security)) %>%
  tbl_summary(by = diabetes_type,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Food Security Categorized by Diabetes Type**") %>%
  bold_labels() 
```

It is not immediately clear if one group experiences food insecurity more than another. I decided to create a box plot where I considered food insecurity on a 1-4 numeric scale. Even though adult food insecurity was not a continuous variable, I treated it as such because the math would still work to consider higher averages indicating a more overall food insecure population. In this way, it was more easily visualized. 

```{r}
nhanes.food.security <- nhanes.data %>%
  dplyr::filter(adult_food_security != "NA")

ggplot(data = nhanes.food.security, aes(as.numeric(adult_food_security), diabetes_type)) +
    geom_boxplot() +
    ggtitle("Adult Food Security Categorized by Diabetes Type") +
    labs(y= "diabetes type", x = "adult food security") 

summary((lm(as.numeric(adult_food_security) ~ diabetes_type, data = nhanes.data))) 
```

Here it actually seems like only people with type 1 diabetes experience more food insecurity. This does not fit into my assumptions about the relationship between food insecurity and type 2 diabetes, but could reveal interesting points about type 1 diabetes, an autoimmune disorder. It is also possible that due to the smaller data set for type 1 diabetes patients, this data has been shifted somewhat due to outliers that are over-represented. 

I also looked at the relationship between dmft score and adult food security. 

```{r}
ggplot(data = nhanes.food.security, aes(dmft2, adult_food_security)) +
    geom_boxplot()+
    ggtitle("Dmft Score catagorized by Adult Food Security")+
    labs(y= "adult food security", x = "dmft score") 

summary((lm(dmft2 ~ adult_food_security, data = nhanes.data)))
```

Again there does not seem to be much of a difference between dmft score and food security. In fact, people with full food security seem to have a higher dmft score. I believe that once again, the data for marginal, low, and very low populations are improperly representative of dmft score because the portion of the data sets are too small to overcome the influence of outliers. 

### Last dental visit

Finally, I chose to study the possible co-variate for the last time a patient went to the dentist. My prediction was that this would also play an important role in dental health, due to frequent access to dental care for better preventative care for teeth. 

```{r}
nhanes.never <- nhanes.data %>%
  filter(last_dentist != "Never" & last_dentist != "NA" & last_dentist != "Don't know" & last_dentist != "Refused")
  
ggplot(data = nhanes.never, aes(dmft2, last_dentist)) +
    geom_boxplot() +
    ggtitle("Dmft Score Categorized by Last Visit to Dentist") +
    labs(y= "last dentist visit", x = "dmft score") 

summary((lm(dmft2 ~ last_dentist, data = nhanes.data)))
```
The analysis indicates that it does seem like a long time away from the dentist could affect dmft score and worsen dental health. However, I felt that it was also important to look into the reasoning why people weren't visiting the dentist. The questionnaire gave optional reasoning for why patients hadn't been to the dentist: couldn't afford the cost, didn't want to spend the money, insurance didn't cover the visit, distance to dental office, hours of dental office, that they weren't recommended to visit the dentist, that they were afraid of the dentist, that they had work and couldn't attend, that they were busy with other responsibilities and couldn't attend, that they thought their dental problems would dissapear, and other. Patients could select multiple options. I first created a table to see what I was looking at and the breakdown of who was responding to these questions. 

```{r}
r1 <- nhanes.data %>%
  filter(reason_no_dental_cost == "10") %>%
  count()
r2 <- nhanes.data %>%
  filter(reason_no_dental_money == "11") %>%
  count()
r3 <- nhanes.data %>%
  filter(reason_no_dental_insurance == "12") %>%
  count()
r4 <- nhanes.data %>%
  filter(reason_no_dental_distance == "13") %>%
  count()
r5 <- nhanes.data %>%
  filter(reason_no_dental_open == "14") %>%
  count()
r6 <- nhanes.data %>%
  filter(reason_no_dental_recommended == "15") %>%
  count()
r7 <- nhanes.data %>%
  filter(reason_no_dental_afraid == "16") %>%
  count()
r8 <- nhanes.data %>%
  filter(reason_no_dental_work == "17") %>%
  count()
r9 <- nhanes.data %>%
  filter(reason_no_dental_busy == "18") %>%
  count()
r10 <- nhanes.data %>%
  filter(reason_no_dental_dissapear == "19") %>%
  count()
r11 <- nhanes.data %>%
  filter(reason_no_dental_other == "20") %>%
  count()

reasoning.counts <- data.frame (
  Reason = c("couldn't afford cost", "didn't want to spend money", "insurance didn't cover", "distance", "office hours", "not recommended", "afraid", "work hours", "busy", "thought problem would dissapear", "other"),
  Count = c(r1[[1]], r2[[1]], r3[[1]], r4[[1]], r5[[1]], r6[[1]], r7[[1]], r8[[1]], r9[[1]], r10[[1]], r11[[1]])
)
knitr::kable(reasoning.counts)
```

Based on the data most people reported problems of cost, insurance, or business as reasons for not going to the dentist. This emphasizes the socio-economic factors that impact health. If a patient can't afford to visit the dentist or can't take off work to go to the appointment, their dental health will suffer. Thus, the co-variate could also consider income, however, I decided to leave it as last dental appointment, because it is measuring a more specific outcome of economic status. 

I created the plot for when the last time they went to the dentist was according to diabetes type. 

```{r}
ggplot(data = nhanes.never, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(last_dentist))) +
    geom_bar(position = "dodge") +
    facet_zoom(ylim = c(0, 2000)) +
    labs(x = 'diabetes type', y = 'count', fill = 'last dentist') +
    ggtitle("Relationship between Diabetes Type and Last Dentist Visit")

nhanes.data.last.dentist <- nhanes.data %>% 
  group_by(diabetes_type, last_dentist) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, last_dentist)

knitr::kable(nhanes.data.last.dentist, col.names = c("Percent  ",
                           "Diabetes type   ", "   Last Dentist"), align = "llr")


summary(glm(last_dentist ~ diabetes_type, data = nhanes.data, family = binomial(logit)))
```

More people with diabetes have not been to the dentist in a while so this could possibly be a co-variate. To test, I once again removed those who hadn't been to the dentist in a while and reran the boxplot and regression. 

```{r}
nhanes.dentist <- nhanes.data %>%
  dplyr::filter(last_dentist == "<6mo" | last_dentist == "6mo < x < 1yr")

ggplot(data = nhanes.dentist, aes(dmft2, diabetes_type)) +
    geom_boxplot() +
    ggtitle("Diabetes type to dmft score excluding >1yr since dental appt")+
    labs(y= "diabetes type", x = "dmft score") 

summary(glm(last_dentist ~ diabetes_type, data = nhanes.dentist, family = binomial(logit)))
```

With this new fit, only type 2 diabetes is shown to be significant. This could mean that the realtionship between type 1 diabetes and dmft score was masked by the amount of people who had not been to the dentist in a while. Or, the difference could one again be due to small amounts of data for people with type 1 diabetes. 

Three different regression models were compared for diabetes and last dentist as a co-variate.

```{r}

lm1 <- lm(dmft2 ~ diabetes_type, data = nhanes.data)
lm2 <- lm(dmft2 ~ diabetes_type + last_dentist, data = nhanes.data)
lm3 <- lm(dmft2 ~ diabetes_type + last_dentist + last_dentist:diabetes_type, data = nhanes.data)

modelsummary(list(lm1, lm2, lm3), coef_omit = "Intercept",
             statistic = c("p = {p.value}"),
             estimate = "{estimate} [{conf.low}, {conf.high}]")


```

Once again, it seems that the combined models do not categorize the data any better than the model without the last dentist factor. Thus, it can be concluded that the last dental visit is not a co-variate to the relationship between the diabetes type and dental health. 

# Conclusion

This report demonstrates that there is a significant relationship between dental health and diabetes. This exists across measures of dental health such as dmft score, gum disease, loose teeth, bone loss, and difficulty with daily tasks due to teeth aching. In all measured variables, both diabetes type 1 and type 2 were statistically significantly worse than for patients without diabetes. However, type 1 and type 2 were not statistically significant between each other. 

Next, possible co-variates of smoking, food insecurity, and last dental visit were explored. Although both smoking one hundred cigarettes, and not visiting the dentist in > 1 year proved to worsen dmft score statistically significantly, neither could be considered a co-variate. When the variables were accounted for in the data and dmft mean calculations underwent another regression, it was found that diabetes still contributed significantly to worse dental health. Additionally adjusted regression models did not show improvement when considering these factors as co-variates.

Limitations in the data were that fewer cases of type 1 diabetes and low and very low food insecurity could lead these factors to feel undue influence of outliers that could skew the data. In the case of food insecurity and last dental visit, it seemed that type 1 diabetes was significant when compared to type 2. However, because of the small data set, conclusions cannot be drawn about whether this comparison is true, or rather a misrepresentation of the population. 

Future directions of this research could focus on investigating the relationship between other health outcomes and diabetes type to see if there is a difference in the manifestation of the disease in common health outcomes.  

# References

(1) Rovner AJ, Nansel TR. Are children with type 1 diabetes consuming a healthful diet?: a review of the current evidence and strategies for dietary change. Diabetes Educ. 2009 Jan-Feb;35(1):97-107. doi: 10.1177/0145721708326699. PMID: 19244565; PMCID: PMC2772111.

(2) Husband AC, Crawford S, McCoy LA, Pacaud D. The effectiveness of glucose, sucrose, and fructose in treating hypoglycemia in children with type 1 diabetes. Pediatr Diabetes. 2010 May;11(3):154-8. doi: 10.1111/j.1399-5448.2009.00558.x. Epub 2009 Aug 3. PMID: 19663922.

(3) Centers for Disease Control and Prevention. (2021, May 7). Diabetes and Oral Health. Centers for Disease Control and Prevention. Retrieved November 1, 2022, from https://www.cdc.gov/diabetes/managing/diabetes-oral-health.html 

(4) https://www.henryford.com/blog/2017/12/type-1-type-2-diabetes-difference

(5) https://www.who.int/data/gho/indicator-metadata-registry/imr-details/3812#:~:text=Definition%3A,the%20sum%20of%20the%20population.

(6) Sheetal A, Hiremath VK, Patil AG, Sajjansetty S, Kumar SR. Malnutrition and its oral outcome - a review. J Clin Diagn Res. 2013 Jan;7(1):178-80. doi: 10.7860/JCDR/2012/5104.2702. Epub 2013 Jan 1. PMID: 23449967; PMCID: PMC3576783.

