---
title: "BMIN503/EPID600 Final Project Madeleine: The relationship between diabetes and dental health"
author: "Madeleine Salwen"
output: 
  html_document:
    theme: paper 
    highlight: tango
---
rm(list = ls()) 
is this working 
***
Use this template to complete your project throughout the course. Your Final Project presentation will be based on the contents of this document. Replace the title/name above and text below with your own, but keep the headers. Feel free to change the theme and other display settings, but this is not required.

### Overview
Give a brief a description of your project and its goal(s), what data you are using to complete it, and what two faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

The purpose of this project is to explore the relationship between dental health and Type 1 diabetes diagnosis in compairison to other factors affecting dental health. To do so, I will be using NHANES data from multiple years to gather enough data. My two advisors are Blanca Himes, PhD, Epidemiology, and Kira Nightingale from the epidemiology department who works in the dental school. Dr Himes has been very helpful in figuring out the question and how to use the NHANES data.  

https://github.com/msalwen19/BMIN503_Final_Project

### Introduction 
Describe the problem addressed, its significance, and some background to motivate the problem.

Explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

Diet is a vital tool in type 1 diabetes management in order to keep blood glucose levels near normal. Technological advancements in insulin therapies such as insulin pumps and flexible injection regiments have drastically improved the lifestyle of children and adults with diabetes. It is still necessary to calculate carbohydrate intake at each meal to account for the appropriate amount of insulin. A review by Rovner suggests that children with diabetes eat more processed foods because packaged items are appealing to facilitate carbohydrate counting. (1) In instances of hypoglycemia, fast acting carbohydrates are required to quickly raise glucose levels. Often, simple sugars like glucose tablets or skittles and other candy are used because they provide fast acting relief. (2) Overall, these dietary practices may affect dental health. Countless studies have shown the relationship between sugar intake and an increased risk of dental caries. Processed foods also tend to contain more sugar, or additives that can damage oral health. Lastly, the higher glucose levels in blood, is also true in saliva, creating an ideal breeding ground for bacteria in the mouth. (3) There is precedent for the relationship between diabetes and dental health, however, my research has only seen instances of Type 2 diabetes investigated. I am interested in specifically isolated Type 1 cases. 

This issue can be understood through an interdisciplinary approach. The issue must be investigated through a broader public health lens to account for factors such as access to dental care, or smoking status in addition to the clinical factors of dental outcomes. I will use the NHANES data set over multiple years, and practices of statistical models to investigate the data. Fields that can contribute to this understanding are epidemiological, statistical, dental, and endocrine. 

### Methods
Describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

```{r, eval = FALSE}
install.packages("nhanesA")
install.packages("plyr")
install.packages("rgdal")
install.packages("sf")
install.packages("tidycensus")
install.packages("ggsn")
install.packages("leaflet")
```
```{r}
library(nhanesA) 
library(plyr)
library(dplyr)
library(tidyverse)

#Loading all the data
varlist <- c("DEMO", "DIQ", "OHQ", "SMQ", "FSQ") 
varlist_years <- paste0(rep(varlist, each = 9), c("_B", "_C", "_D", "_E","_F","_G","_H","_I","_J"))
#Load everything from varlist_years in nhanes as a list
list_all <- sapply(varlist_years, function(x) {data.frame(nhanes(x))}) 
#Create a data.frame for each section of questions
for(i in 1:length(list_all)) {
  assign(names(list_all)[i], list_all[[i]])
} 
#Combine section questions from each year into one larger data frame and remove the year individual data frames
for (i in 1:length(varlist)) {
  assign(varlist[i], plyr::rbind.fill(mget(grep(varlist[i], ls(), value = T))))
} 
rm(list = grep("_[BCDEFGHIJ]", ls(), value = T)) 

nhanes.data <- full_join(get(varlist[1]), get(varlist[2]), by = "SEQN") #join the data frames

head(nhanes.data)
#for some reason I can't figure out OHQ is never added at this point. I looked this up and it's because only 2 data frames allowed for full_join unless you use reduce which then didn't work for other reasons. SO I will add OHQ later but it's nice that everything is loaded together.

#cleaning the data
nhanes.data <- nhanes.data %>%
  dplyr::rename(have_diabetes = DIQ010, age_when_diagnosed = DID040, 
                taking_insulin = DIQ050, how_long_insulin = DID060, A1C = DIQ280,
                take_metformin = DIQ070) %>%
  dplyr::rename(house_income = INDHHIN2, pregnant = RIDEXPRG) %>%
  dplyr::rename(sex = RIAGENDR, age = RIDAGEYR, 
           race = RIDRETH1, education = DMDEDUC2) %>% 
  dplyr::mutate(sex = factor(sex, levels = c(1, 2), 
                           labels = c("men", "women"))) %>%
  dplyr::mutate(race = factor(race, levels = c(3, 1, 2, 4, 5),
                         labels = c("White", "MexicanAmerican", 
                                    "Hispanic", "Black", "Other"))) %>%
  dplyr::mutate(education = factor(education, levels = c(1,2,3,4,5,7,9), 
                                   labels = c("< 9th grade", "9-11th", "HS or GED", 
                                              "some college or AA", ">= college graduate", 
                                              "refused", "don't know")))

nhanes.data <- nhanes.data %>% 
  dplyr::select(-contains(c("DIQ", "DID", "DMD", "IND", "DMQ", "RID", "WT"))) %>% #this was the smartest thing I've ever done it was taking me so long before to delete everything
  dplyr::select(-FIAINTRP, -FIALANG, - FIAPROXY,  -MIAINTRP, 
                -MIALANG, -MIAPROXY, -AIALANG, -AIALANGA,  
                -SDDSRVYR, -SDMVPSU, -SDMVSTRA, -SIAINTRP, -SIALANG, -SIAPROXY)

#OHQ data
OHQ <- OHQ %>%
  dplyr::rename(taste_affect = OHQ650, avoid_food = OHQ660, difficulty_eating = OHQ670) %>%
  dplyr::rename(tooth_loose = OHQ855, tooth_looks_wrong = OHQ865) %>%
  dplyr::rename(last_dentist = OHQ030, fluoride = OHQ566, aching = OHQ620, difficulty_bc_teeth = OHQ640,
           embarrassed_bc_teeth = OHQ680, not_recieve_dental = OHQ770,
           reason_no_dental_cost = OHQ780A, reason_no_dental_money = OHQ780B, 
           reason_no_dental_insurance = OHQ780C, reason_no_dental_distance = OHQ780D,
           reason_no_dental_open = OHQ780E, reason_no_dental_recommended = OHQ780F,
           reason_no_dental_afraid = OHQ780G, reason_no_dental_work = OHQ780H,
           reason_no_dental_busy = OHQ780I,reason_no_dental_dissapear = OHQ780J,
           reason_no_dental_other = OHQ780K,
           gum_disease = OHQ835, rate_dental_health = OHQ845, 
           gum_disease_treatment = OHQ850, lost_bone = OHQ860) 

OHQ <- OHQ %>%
  dplyr::mutate(gum_disease = factor(gum_disease, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(rate_dental_health = factor(rate_dental_health, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Excellent", "Very Good", "Good", 
                                              "Fair", "Poor", "Refused", "Don't know"))) %>%
  dplyr::mutate(gum_disease_treatment = factor(gum_disease_treatment, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(tooth_loose = factor(tooth_loose, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(lost_bone = factor(lost_bone, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  dplyr::mutate(tooth_looks_wrong = factor(tooth_looks_wrong, levels = c(1,2,7,9), 
                                   labels = c("Yes", "No", "Refused", "Don't know"))) %>%
  #2017
  dplyr::mutate(last_dentist = factor(last_dentist, levels = c(1,2,3, 4, 5, 6, 7, 77, 99), 
                                   labels = c("<6mo", "6mo < x < 1yr", "1yr < x < 2yr", 
                                              "2yr < x < 3yr", "3yr < x < 5yr", ">5yr",
                                              "Never", "Refused", "Don't know"))) %>%
  dplyr::mutate(aching = factor(aching, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(difficulty_bc_teeth = factor(difficulty_bc_teeth, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(embarrassed_bc_teeth = factor(embarrassed_bc_teeth, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  #2007
  dplyr::mutate(taste_affect = factor(taste_affect, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(avoid_food = factor(avoid_food, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(difficulty_eating = factor(difficulty_eating, levels = c(1,2,3, 4, 5, 7,9), 
                                   labels = c("Very Often", "Fairly Often", "Occasionally", 
                                              "Hardly Ever", "Never", "Refused", 
                                              "Don't know"))) 
  
  
OHQ <- OHQ %>% 
  dplyr::select(-contains(c("OHQ", "OHD")))
#join OHQ
nhanes.data <- nhanes.data %>%
    full_join(OHQ, by = "SEQN")

#SMQ data
SMQ <- SMQ %>%
  dplyr::select(SMQ020, SMD030, SMQ040, SMQ900, SEQN) %>%
  dplyr::rename(hundred_cigs = SMQ020, smoke_cigs = SMQ040, e_cigs = SMQ900, age_started_smoking = SMD030) %>%
  dplyr::mutate(hundred_cigs = factor(hundred_cigs, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know"))) %>%
  dplyr::mutate(smoke_cigs = factor(smoke_cigs, levels = c(1, 2, 3, 7,9), 
                           labels = c("everyday", "some days", "not at all", 
                                      "refused", "don't know"))) %>%
  dplyr::mutate(e_cigs = factor(e_cigs, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know")))
#join SMQ with the other data frame
nhanes.data <- nhanes.data %>%
    full_join(SMQ, by = "SEQN")  

#FSQ data
FSQ <- FSQ %>%
  dplyr::select(FSD032A, FSD032B, FSD032C, FSDAD, FSDCH, FSD041, FSD052, SEQN) %>%
  dplyr::rename(worried_run_out = FSD032A, food_didnt_last = FSD032B, 
                no_balanced_meals = FSD032C, adult_food_security = FSDAD, 
                child_food_security = FSDCH, skip_meals = FSD041, 
                how_often_skip_meals = FSD052)
FSQ <- FSQ %>%
  dplyr::mutate(worried_run_out = factor(worried_run_out, levels = c(1,2,3, 7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(food_didnt_last = factor(food_didnt_last, levels = c(1,2,3, 7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(no_balanced_meals = factor(no_balanced_meals, levels = c(1,2,3,7, 9), 
                                   labels = c("Often True", "Sometimes True", 
                                              "Never True", "Refused", 
                                              "Don't know"))) %>%
  dplyr::mutate(skip_meals = factor(skip_meals, levels = c(1, 2, 7,9), 
                           labels = c("yes", "no", "refused", "don't know"))) %>%
  dplyr::mutate(adult_food_security = factor(adult_food_security, levels = c(1,2,3,4), 
                           labels = c("full", "marginal", "low", "very low")))

#join FSQ with the other data frame
nhanes.data <- nhanes.data %>%
    full_join(FSQ, by = "SEQN")
 

#creating a new column for people who have diabetes and trying to categorize them into either type1 or type2 based on factors like if they take a blood sugar lowering drug  or if they aren't taking insulin then these people are likely type 2. With this method, no type 1 will be in type 2 categorization but some type 2 could possibly be in type 1.
nhanes.data1<- nhanes.data #for now I just made a new one becasaue I don't want to have to reload everything

nhanes.data1 <- nhanes.data1 %>%
     mutate(diabetes_type1 = ifelse(have_diabetes == 1 & 
           take_metformin == 2 & 
           taking_insulin == 1, "Type 1", ""))

nhanes.data1 <- nhanes.data1 %>%
  dplyr::mutate(diabetes_type2 = ifelse(have_diabetes == 1 & 
                                          diabetes_type1 != "Type 1", "Type 2", ""))

nhanes.data1 <- nhanes.data1 %>%
  dplyr::mutate(diabetes_type0 = ifelse(have_diabetes != 1, "No Diabetes", ""))

nhanes.data1 <- nhanes.data1 %>%
  dplyr::mutate(diabetes_type = paste(diabetes_type1, diabetes_type2, diabetes_type0)) %>%
  dplyr::mutate(diabetes_type = as.factor(diabetes_type))


class(nhanes.data1$diabetes_type)#made sure it's a factor

nhanes.data1 <- nhanes.data1 %>%
  dplyr::filter(diabetes_type != "NA NA " && diabetes_type != "NA NA NA")

#looking at my variables
head(nhanes.data1)

nhanes.data1 %>%
  count(diabetes_type) 


##creating a dmft score
#load the dentition data
dentition <- c("OHXDEN") 
dentition_years <- paste0(rep(dentition, each = 6), c("_B", "_C","_G","_H","_I","_J"))
list_all_dentition <- sapply(dentition_years, function(x) {data.frame(nhanes(x))}) 
#Create a data.frame for each section of questions
for(i in 1:length(list_all_dentition)) {
  assign(names(list_all_dentition)[i], list_all_dentition[[i]])
} 

OHXDEN_I <- OHXDEN_I %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3) #I saw that there is no missing data for this but the 2 and 3 status code means the data is incomplete
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_I)[i], "new")
  OHXDEN_I <- mutate(OHXDEN_I, !!newname := ifelse(!!as.name(names(OHXDEN_I)[i])
                              %in% c("A", "E", "F", "K", "P", "R", "T", "Z"), 1, 0))
} #Kira Nightingale helped me a ton with this step. Basically, this is counting the coronal carries status of the teeth. The E - Z codes given in the data correspond to the status of the teeth. For the dmft score a 1 means that the tooth is missing due to cavities and a zero means the tooth is not counted in the dmft score (it is healthy or gone for a different reason)
OHXDEN_I <- OHXDEN_I %>%
  dplyr::mutate(dmftI = rowSums(OHXDEN_I[,c(171:198)])) #here is summing them up and creating a new column


#Recreating this for the rest of the years. Ultimately I decided to do each year separately because some years included the 3rd molars which aren't included in the score or 2008 was called something different and order can be different so ultimately this felt easier. Should always not include the 3rd molars: tooth 1, 32, 16, 17

OHXDEN_B <- OHXDEN_B %>% 
  dplyr::filter(OHAEXSTS!=2 & OHAEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC", "DI", "TR")))
for (i in 38:65) {
  newname <- paste0(names(OHXDEN_B)[i], "dmft")
  OHXDEN_B <- mutate(OHXDEN_B, !!newname := ifelse(!!as.name(names(OHXDEN_B)[i])
                              %in% c("E", "K", "R", "Z"), 1, 0))
}
OHXDEN_B <- OHXDEN_B %>%
  dplyr::mutate(dmftB = rowSums(OHXDEN_B[,c(86:113)]))

OHXDEN_C <- OHXDEN_C %>% 
  dplyr::filter(OHAEXSTS!=2 & OHAEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC")))
for (i in 38:65) {
  newname <- paste0(names(OHXDEN_C)[i], "dmft")
  OHXDEN_C <- mutate(OHXDEN_C, !!newname := ifelse(!!as.name(names(OHXDEN_C)[i])
                              %in% c("E", "K", "R", "Z"), 1, 0))
}
OHXDEN_C <- OHXDEN_C %>%
  dplyr::mutate(dmftC = rowSums(OHXDEN_C[,c(122:149)]))
#OHXDEN doesn't work for D,E,F they didn't do it those years. I could just do missing teeth and do the tooth count


OHXDEN_G <- OHXDEN_G %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3)
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_G)[i], "new")
  OHXDEN_G <- mutate(OHXDEN_G, !!newname := ifelse(!!as.name(names(OHXDEN_G)[i])
                              %in% c("E", "K", "P", "R", "Z", "T"), 1, 0))
}
OHXDEN_G <- OHXDEN_G %>%
  dplyr::mutate(dmftG = rowSums(OHXDEN_G[,c(111:138)]))

OHXDEN_H <- OHXDEN_H %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3)
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_H)[i], "new")
  OHXDEN_H <- mutate(OHXDEN_H, !!newname := ifelse(!!as.name(names(OHXDEN_H)[i])
                              %in% c("E", "K", "P", "R", "Z", "T"), 1, 0))
}
OHXDEN_H <- OHXDEN_H %>%
  dplyr::mutate(dmftH = rowSums(OHXDEN_H[,c(111:138)]))


OHXDEN_J <- OHXDEN_J %>%
  dplyr::filter(OHDEXSTS!=2 & OHDEXSTS!=3) %>%
  dplyr::select(-contains(c("CSC", "RTC", "RSC")))
for (i in 37:64) {
  newname <- paste0(names(OHXDEN_J)[i], "new")
  OHXDEN_J <- mutate(OHXDEN_J, !!newname := ifelse(!!as.name(names(OHXDEN_J)[i])
                              %in% c("A", "E", "F", "K", "P", "R", "T", "Z"), 1, 0))
} 
OHXDEN_J <- OHXDEN_J %>%
  dplyr::mutate(dmftJ = rowSums(OHXDEN_J[,c(87:114)]))

OHXDEN_I <- OHXDEN_I %>% #I could for sure make a for loop for this later
  dplyr::select(SEQN, dmftI)
OHXDEN_B <- OHXDEN_B %>% 
  dplyr::select(SEQN, dmftB)
OHXDEN_C <- OHXDEN_C %>% 
  dplyr::select(SEQN, dmftC)
OHXDEN_G <- OHXDEN_G %>% 
  dplyr::select(SEQN, dmftG)
OHXDEN_H <- OHXDEN_H %>% 
  dplyr::select(SEQN, dmftH)
OHXDEN_J <- OHXDEN_J %>% 
  dplyr::select(SEQN, dmftJ)

#for (i in length(dentition_years)) {
  #nhanes.data1 <- nhanes.data1 %>%
  #  full_join(dentition_years[i], by = "SEQN")
#} can't get for loop for adding them in to work either

nhanes.data1 <- nhanes.data1 %>%
  full_join(OHXDEN_B, by = "SEQN")%>%
  full_join(OHXDEN_C, by = "SEQN")%>%
  full_join(OHXDEN_G, by = "SEQN")%>%
  full_join(OHXDEN_H, by = "SEQN")%>%
  full_join(OHXDEN_I, by = "SEQN")%>%
  full_join(OHXDEN_J, by = "SEQN")

nhanes.data1 <- nhanes.data1 %>%
  unite(., col = "dmft",  dmftB, dmftC, dmftG, dmftH, dmftI, dmftJ, na.rm=TRUE, sep = "")

nhanes.data1 <- nhanes.data1 %>%
  dplyr::mutate(dmft2 = as.numeric(dmft))

#note about the tooth data is that it is only relevent for people >30 so I have to exclude anyone under 30 in my report
#possibly have to just do BCGHIJ for the dentition ones becasue the other ones are weird
```
plans I have to do:
  - compare T1D and T2D by my calculations for the diff teeth stuff
  - see if this is statistically significant
  - look at factors of smoking
  - compare the effects of smoking to people with diabetes for a sense of scale
  - compare access to dental care (I will do this by the question that says haven't been to the dentist but exclude the scared and not recommended people)
  - compare results by gender and race 
  - add in the effect of food security --> does this change anything


things to consider
- what measures are availible for what age groups --> some might not be good for some of the questions
- the way they work with regressions is it will drop observation it will drop them. How will I handle this
- DMFT score, I can create the score from the data (and then treat as continous). I think I will first try with the questionnaire and then see
 
### Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.
``` {r}

library(ggplot2)
library(cowplot)
library(GGally)
library(gtsummary) #nice table
library(ggforce) #for the zoom on the graph

# a look into the overview of the diabetes data
nhanes.data1 %>%
  dplyr::select(c(age, sex, race, diabetes_type)) %>%
  tbl_summary(by = diabetes_type,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Patient Characteristics Grouped By Diabetes Type**") %>%
  bold_labels()
#from this it doesn't seem like there is that much difference within the groups which is good
```
```{r}
#comparing diabetes status with dmft score over the years: 
ggplot(data = nhanes.data1, aes(dmft2, diabetes_type)) +
    geom_boxplot()
# a preliminary look at the graphs indicates that diabetes type 1 and 2 seem to have an effect on the dmft score

#linear regressions of them
summary((lm(dmft2 ~ diabetes_type, data = nhanes.data1)))
#Also made a linear regression just comparing type 1 vs type 2
nhanes.diabetes <- nhanes.data1 %>% 
  dplyr::filter(diabetes_type != "  No Diabetes") 
summary((lm(dmft2 ~ diabetes_type, data = nhanes.diabetes))) #not statistically significant, which we can see in the boxplot



#another method to judge the dental health is through questionnaire data on oral health. 
ggplot(data = nhanes.data1, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(gum_disease))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 4000))
#this graph can show us the relative amounts of each, but more useful to our interpretation is understanding the percentages relative to diabetes type
nhanes.data.gumdisease <- nhanes.data1 %>% 
  group_by(diabetes_type, gum_disease) %>%
  filter(gum_disease != "NA" & gum_disease != "7" & gum_disease != "9") %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, gum_disease)

nhanes.data.gumdisease
# it looks like a greater percentage of people with diabetes answered that they had gum disease so check significance with logistic regression
summary(glm(gum_disease ~ diabetes_type, data = nhanes.data1, family = binomial(logit)))


#also same process for tooth looks wrong and lost bone
ggplot(data = nhanes.data1, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(difficulty_bc_teeth))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 2000))


nhanes.data.difficulty <- nhanes.data1 %>% 
  group_by(diabetes_type, difficulty_bc_teeth) %>%
  filter(difficulty_bc_teeth != "NA" & difficulty_bc_teeth != "7" & difficulty_bc_teeth != "9") %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, difficulty_bc_teeth)

nhanes.data.difficulty
summary(glm(difficulty_bc_teeth ~ diabetes_type, data = nhanes.data1, family = binomial(logit)))

nhanes.loose.tooth <- nhanes.data1 %>%
  filter(tooth_loose != "NA" & tooth_loose != 7 & tooth_loose != 9) # I just did this so that the graph would be less bc lots had NA
ggplot(data = nhanes.loose.tooth, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(tooth_loose))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 2000))


nhanes.data.loose.tooth <- nhanes.loose.tooth %>% 
  group_by(diabetes_type, tooth_loose) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, tooth_loose)

nhanes.data.loose.tooth
summary(glm(tooth_loose ~ diabetes_type, data = nhanes.data1, family = binomial(logit)))

nhanes.lost.bone <- nhanes.data1 %>%
  filter(lost_bone != "NA" & lost_bone != 7 & lost_bone != 9) # I just did this so that the graph would be less bc lots had NA
ggplot(data = nhanes.lost.bone, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(lost_bone))) +
    geom_bar(position = "dodge") + 
    facet_zoom(ylim = c(0, 2000)) +
    #geom_text(stat = 'count',
              #position = position_dodge(.9), 
              #vjust = -0.5, 
              #size = 3) + 
    #scale_y_continuous(labels = scales::percent) + 
    labs(x = 'diabetes type', y = 'count', fill = 'lost bone')


nhanes.data.lost.bone <- nhanes.lost.bone %>% 
  group_by(diabetes_type, lost_bone) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, lost_bone)

nhanes.data.lost.bone
#seems like a bit less of a difference but maybe more for Type 1 than Type 2
summary(glm(lost_bone ~ diabetes_type, data = nhanes.data1, family = binomial(logit)))
summary(glm(lost_bone ~ diabetes_type, data = nhanes.diabetes, family = binomial(logit)))#not quite stat significant
```


nhanes.data1 %>%
  filter(have_diabetes == 1) %>% 
  ggplot(aes(x = no_balanced_meals, fill = diabetes_type)) + 
  geom_bar(position = "dodge") +
  scale_fill_brewer(palette = "Set1")


```{r}
nhanes.data1 %>%
  group_by(diabetes_type) %>%
  count(hundred_cigs)
#so about half of each group have smoked 100 cigarretts

#considering smoking effects
nhanes.hundred.cigs <- nhanes.data1 %>%
  dplyr::filter(hundred_cigs == "yes" | hundred_cigs == "no")
ggplot(data = nhanes.hundred.cigs, aes(dmft2, hundred_cigs)) +
    geom_boxplot()

#Here smoking seems to increase dmft score let's check regression
summary((lm(dmft2 ~ hundred_cigs, data = nhanes.hundred.cigs))) #it is significant

#Now I will see if considering smoking status changes the linear regression that I had done previously

```

```{r}
#I will now explore the relationship between food security and dental health / diabetes
nhanes.data1 %>%
  dplyr::select(c(age, sex, race, adult_food_security)) %>%
  tbl_summary(by = adult_food_security,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Patient Characteristics Grouped By Adult Food Security**") %>%
  bold_labels() #I need to figure out how to not have NA NA and NA NA NA show up as categories

nhanes.data1 %>%
  dplyr::select(c(diabetes_type, adult_food_security)) %>%
  tbl_summary(by = diabetes_type,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
              all_categorical() ~ "{n} / {N} ({p}%)"),
              digits = all_continuous() ~ 2,
              missing_text = "(Missing)") %>%
  add_overall() %>%
  modify_header(label ~ "**Variable**") %>%
  modify_caption("**Food Security Categorized by Diabetes Type**") %>%
  bold_labels() 
#It looks like particularly with type 1, there could be more who experience food insecurity


ggplot(data = nhanes.data1, aes(dmft2, adult_food_security)) +
    geom_boxplot() #here it seeems like not much of a difference and in fact people with full food security have a higher dmft score. I believe that this is probably due to just having more people so there is a greater probability that they could experience food insecurity

ggplot(data = nhanes.data1, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(adult_food_security))) +
    geom_bar(position = "dodge") +
    facet_zoom(ylim = c(0, 10000)) 

#I want to compare food insecurity for people with diabetes and people without
ggplot(data = nhanes.data1, aes(as.numeric(adult_food_security), diabetes_type)) +
    geom_boxplot() #here I am dreating food security as a numeric so that it can be plot. However, it seems like there is not much of a difference as most people had good food security across the board.
#Based on this data I don't think food security has an impact on dental health or diabetes
```
A last factor could be last time they went to the dentist
```{r}
ggplot(data = nhanes.data1, aes(dmft2, last_dentist)) +
    geom_boxplot()
summary((lm(dmft2 ~ last_dentist, data = nhanes.data1)))
#based on this it does seem like a long time away from the dentist could affect dmft score
# I want to look more into the reasoning behind why not visiting the dentist
# to do this the reasons are inputted with a number that's different for each
#the problem with this information is that there are some people who have multiple columns

r1 <- nhanes.data1 %>%
  filter(reason_no_dental_cost == "10") %>%
  count(reason_no_dental_cost)
r2 <- nhanes.data1 %>%
  filter(reason_no_dental_money == "11") %>%
  count(reason_no_dental_cost)
r3 <- nhanes.data1 %>%
  filter(reason_no_dental_insurance == "12") %>%
  count(reason_no_dental_cost)
r4 <- nhanes.data1 %>%
  filter(reason_no_dental_distance == "13") %>%
  count(reason_no_dental_cost)
r5 <- nhanes.data1 %>%
  filter(reason_no_dental_open == "14") %>%
  count(reason_no_dental_cost)
r6 <- nhanes.data1 %>%
  filter(reason_no_dental_recommended == "15") %>%
  count(reason_no_dental_cost)
r7 <- nhanes.data1 %>%
  filter(reason_no_dental_afraid == "16") %>%
  count(reason_no_dental_cost)
r8 <- nhanes.data1 %>%
  filter(reason_no_dental_work == "17") %>%
  count(reason_no_dental_cost)
r9 <- nhanes.data1 %>%
  filter(reason_no_dental_busy == "18") %>%
  count(reason_no_dental_cost)
r10 <- nhanes.data1 %>%
  filter(reason_no_dental_dissapear == "19") %>%
  count(reason_no_dental_cost)
r11 <- nhanes.data1 %>%
  filter(reason_no_dental_other == "20") %>%
  count(reason_no_dental_cost)

ggplot(data = nhanes.data1, aes(x = factor(diabetes_type), 
                          y = stat(count), 
                          fill = factor(last_dentist))) +
    geom_bar(position = "dodge") +
    facet_zoom(ylim = c(0, 5000)) 

nhanes.data.last.dentist <- nhanes.data1 %>% 
  group_by(diabetes_type, last_dentist) %>%
  summarise(n = n()) %>% 
  mutate(percent_per_factor = n/sum(n) * 100) %>%
  select(percent_per_factor, diabetes_type, last_dentist)

nhanes.data.last.dentist
#more people with diabetes have not been to the dentist in a while so this could be a cofactor

summary(glm(last_dentist ~ diabetes_type, data = nhanes.data1, family = binomial(logit)))
```

###References

(1) Rovner AJ, Nansel TR. Are children with type 1 diabetes consuming a healthful diet?: a review of the current evidence and strategies for dietary change. Diabetes Educ. 2009 Jan-Feb;35(1):97-107. doi: 10.1177/0145721708326699. PMID: 19244565; PMCID: PMC2772111.

(2) Husband AC, Crawford S, McCoy LA, Pacaud D. The effectiveness of glucose, sucrose, and fructose in treating hypoglycemia in children with type 1 diabetes. Pediatr Diabetes. 2010 May;11(3):154-8. doi: 10.1111/j.1399-5448.2009.00558.x. Epub 2009 Aug 3. PMID: 19663922.

(3) Centers for Disease Control and Prevention. (2021, May 7). Diabetes and Oral Health. Centers for Disease Control and Prevention. Retrieved November 1, 2022, from https://www.cdc.gov/diabetes/managing/diabetes-oral-health.html 

